---
title: CentOS 6.7 安装 bind
date: 2018-01-02 10:00:00
category:
    - digest
tag: 
    - linux
---

###本机IP
* 192.168.1.11 

###测试机IP      
* 192.168.1.12 

###网关
* 192.168.1.1   

###解析域名
* www.hengxia.top

###CentOS 6.7上yum安装BIND,并启动

* [~]# service iptables stop        #关闭防火墙
* [~]# yum -y install bind          #yum安装bind
* [~]# rpm -ql bind                 #查看安装版本
* [~]# service named restart        #重启bind
* [~]# chkconfig named on           #设置成开机启动

###在CentOS 6.7配置BIND

* [~]# yum -y install telnet
* [~]# telnet 192.168.1.11 53   #测试本机IP能否访问端口53，端口53是BIND默认端口
* [~]# cp -p /etc/named.conf{,.bak} # 备份named.conf并修改 ，备份文件文件后缀为.bak
* [~]# vi /etc/named.conf       #编辑bind主配置文件

```bash
#listen-on port 53 { 127.0.0.1; }; 将此行注释掉
```
* [~]# service named restart    #重启bind服务，主要为了重新读取配置文件
* [~]# vi /etc/sysconfig/network-scripts/ifcfg-eth0 
```bash
#编辑网卡配置文件，编辑配置好静态IP的，只需修改下面这行，即DNS1
DNS1="127.0.0.1"        # 因为CentOS6.7自己为DNS服务器，所以设自己为DNS服务器
```
* [~]# service network restart
* [~]# cat /etc/resolv.conf  # 查看默认DNS
```bash
# Generated by NetworkManager
search top              # 搜索top域名，例如com、cn
nameserver 127.0.0.1
```
* [~]# vi /etc/named.conf
```bash
# allow-query { localhost; } #注释掉该行，即默认同意所有IP访问
```
* [~]# named-checkconf  # 检查配置文件named.conf,服务-checkconf命令检查服务的配置文件 
* [~]# service named restrart  #重启bind，重读配置文件

###在CentOS 6.7上DNS搭建自己的域，让当前DNS解析www.hengxia.top域

* [~]# vi /etc/named.rfc1912.zones   # 编辑区域解析库文件
```bash 
zone "hengxia.top" IN {                 # hengxia.top是域名
    type master;                # 表示权威DNS，即第一个
    file "hengxia.top.zone";        # 域数据库，默认位于/var/named/下面，只需告知文件名 hengxia.top.zone是库文件名
};
```
* [~]# cd /var/named
* [~]# ls
* [named]# cp -p named.localhost hengxia.top.zone         
* /# 注意cp -p 保持原有属性， 用cp 要用 chgrp named hengxia.top.zone
* /# 复制配置文件，
* [named]# cat hengxia.top.zone  
```bash                       
# 解析区域数据库格式，存放名字与IP的对应关系
$TTL 1D     # 统一定义TTL(过期时间、缓存时间）                   
@   IN SOA  @ rname.invalid. (                    # SOA记录   IN internet技术 IN第一条要写，后面可以省略，可继承第一条IN           rname.invalid.  资源的类型          
                    0   ; serial         
                    1D  ; refresh
                    1H  ; retry
                    1W  ; expire
                    3H )    ; minimum
    NS  @                                         # 代表当前配置域，例如配置hengxia.top，就代表hengxia.top
    A   127.0.0.1                                 # A记录 名字 到 IP   对应IPv4地址
    AAAA    ::1                                   # A记录 名字 到 IP   对应IPv6地址
```
* [named]# vi hengxia.top.zone #配置后文件如下
```bash
$TTL 1D
@   IN SOA  dns1.hengxia.top dnsadmin.hengxia.top. (
                    201707262051    ; serial
                    10M ; refresh
                    3M  ; retry
                    1D  ; expire
                    3D )    ; minimum
    NS  dns1
        NS      dns2
dns1    A   192.168.1.11                    # 本机IP
dns2    A       192.168.1.11                # 测试机IP
websrv  A   1.1.1.1
ftpsrv  A       2.2.2.2
```

* [named]# named-checkconf  # 检查/etc/下与named有关文件
* [named]# named-checkzone hengxia.top /var/named/hengxia.top.zone # 检查域数据库文件 
```bash
dns_rdata_fromtext: /var/named/hengxia.top.zone:2: near '201707262051': out of range                                      # 序列号超出范围
zone hengxia.top/IN: loading from master file /var/named/hengxia.top.zone failed: out of range
zone hengxia.top/IN: not loaded due to errors.
```
* [named]# vi hengxia.top.zone 
* [named]# named-checkzone hengxia.top /var/named/hengxia.top.zone
```bash
zone hengxia.top/IN: loaded serial 2017072601
[OK]
```
* [named]# service named restart

###在另一台CentOS 6.7上测试DNS

* [~]# yum -y install bind bind-utils   # 测试工具 dig host nslookup 来自 bind-utils包
* [~]# dig www.hengxia.top @192.168.1.11  # 本机IP
```bash
; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.62.rc1.el6 <<>> www.hengxia.top @192.168.1.11
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: SERVFAIL, id: 53941
;; flags: qr rd ra; QUERY: 1, ANSWER: 0, AUTHORITY: 0, ADDITIONAL: 0

;; QUESTION SECTION:
;www.hengxia.top.       IN  A

;; Query time: 7 msec
;; SERVER: 172.16.252.77#53(192.168.1.11)
;; WHEN: Wed Jul 26 19:13:37 2017
;; MSG SIZE  rcvd: 33
```

* [~]# dig websrv.hengxia.top @192.168.1.11           # 测试成功，说明CentOS 6.7上的域搭建成功
```bash
; <<>> DiG 9.8.2rc1-RedHat-9.8.2-0.62.rc1.el6 <<>> websrv.hengxia.top @192.168.1.11    
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 49446
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 2, ADDITIONAL: 2          # aa 说明是权威结果

;; QUESTION SECTION:
;websrv.hengxia.top.        IN  A

;; ANSWER SECTION:
websrv.hengxia.top. 86400   IN  A   1.1.1.1

;; AUTHORITY SECTION:
hengxia.top.        86400   IN  NS  dns1.hengxia.top.
hengxia.top.        86400   IN  NS  dns2.hengxia.top.

;; ADDITIONAL SECTION:
dns1.hengxia.top.   86400   IN  A   192.168.1.11
dns2.hengxia.top.   86400   IN  A   192.168.1.12   # 端口85400

;; Query time: 3 msec
;; SERVER: 172.16.252.77#53(192.168.1.11)
;; WHEN: Wed Jul 26 19:17:38 2017
;; MSG SIZE  rcvd: 122
```
---

### 参考链接
[CentOS 7.3使用BIND配置DNS服务器](http://blog.csdn.net/miouqi/article/details/76422700)

