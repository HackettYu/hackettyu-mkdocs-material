<!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=hackettyu.com><link href=https://hackettyu.com/archives/ABAP-guide-zh/ rel=canonical><meta name=author content=hackettyu><link rel="shortcut icon" href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.3.0"><title>ABAP guide zh - hackettyu'blog</title><link rel=stylesheet href=../../assets/stylesheets/main.545621a7.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.36d1b78f.min.css><meta name=theme-color content><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Noto+Sans+SC:300,400,400i,700%7CFira+Code&display=fallback"><style>body,input{font-family:"Noto Sans SC",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Fira Code",SFMono-Regular,Consolas,Menlo,monospace}</style><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-146236033-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview")})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme=preference data-md-color-primary=white data-md-color-accent=indigo> <script>matchMedia("(prefers-color-scheme: dark)").matches&&document.body.setAttribute("data-md-color-scheme","slate")</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#abap class=md-skip> 跳转至 </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://hackettyu.com title="hackettyu'blog" class="md-header-nav__button md-logo" aria-label="hackettyu'blog"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> hackettyu'blog </span> <span class="md-header-nav__topic md-ellipsis"> ABAP guide zh </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=搜索 placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/hackettyu/mkdocs-material/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> hackettyu/mkdocs-material </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class="md-tabs md-tabs--active" aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../2018/ class=md-tabs__link> 2018 </a> </li> <li class=md-tabs__item> <a href=../../2019/ class=md-tabs__link> 2019 </a> </li> <li class=md-tabs__item> <a href=../../2020/ class=md-tabs__link> 2020 </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Archives </a> </li> <li class=md-tabs__item> <a href=../../docs/backup/171216/ class=md-tabs__link> Docs </a> </li> <li class=md-tabs__item> <a href=../../weekly/weekly-2020-10-0x01/ class=md-tabs__link> Weekly </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://hackettyu.com title="hackettyu'blog" class="md-nav__button md-logo" aria-label="hackettyu'blog"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"><path d="M3.136 17.387v42.932l42.932 21.467L3.136 17.387z"/><path fill-opacity=.5 d="M21.91 8l42.933 64.398-18.775 9.388L3.136 17.387 21.91 8z"/><path d="M67.535 17.387L40.273 35.543l21.878 32.818 5.384 2.691V17.387z"/><path fill-opacity=.25 d="M67.535 17.387v53.666l18.774-9.388V8l-18.774 9.387z"/></svg> </a> hackettyu'blog </label> <div class=md-nav__source> <a href=https://github.com/hackettyu/mkdocs-material/ title="前往 GitHub 仓库" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> hackettyu/mkdocs-material </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../newsletter/ title=Newsletter class=md-nav__link> Newsletter </a> </li> <li class=md-nav__item> <a href=../../what-i-use/ title="What I use" class=md-nav__link> What I use </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> 2018 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2018 data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2018 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/ title=2018 class=md-nav__link> 2018 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-2 type=checkbox id=nav-4-2> <label class=md-nav__link for=nav-4-2> 0913 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0913 data-md-level=2> <label class=md-nav__title for=nav-4-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0913 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/0913/ubuntu-board/ title="解决 Ubuntu 16.04 没有 「在打字时停用触摸板」选项" class=md-nav__link> 解决 Ubuntu 16.04 没有 「在打字时停用触摸板」选项 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-3 type=checkbox id=nav-4-3> <label class=md-nav__link for=nav-4-3> 0927 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0927 data-md-level=2> <label class=md-nav__title for=nav-4-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0927 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/0927/code-cloc/ title=代码行统计 class=md-nav__link> 代码行统计 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-4 type=checkbox id=nav-4-4> <label class=md-nav__link for=nav-4-4> 1001 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1001 data-md-level=2> <label class=md-nav__title for=nav-4-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1001 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1001/chromium-google-api/ title="解决 chromium 缺少 google api 密钥无法登录问题" class=md-nav__link> 解决 chromium 缺少 google api 密钥无法登录问题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-5 type=checkbox id=nav-4-5> <label class=md-nav__link for=nav-4-5> 1004 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1004 data-md-level=2> <label class=md-nav__title for=nav-4-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1004 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1004/command-close-nvida/ title="命令行开启 | 关闭显卡" class=md-nav__link> 命令行开启 | 关闭显卡 </a> </li> <li class=md-nav__item> <a href=../../2018/1004/powershell-upper/ title="命令行下 powershell 提权" class=md-nav__link> 命令行下 powershell 提权 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-6 type=checkbox id=nav-4-6> <label class=md-nav__link for=nav-4-6> 1006 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1006 data-md-level=2> <label class=md-nav__title for=nav-4-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1006 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1006/linux-ln/ title="linux ln 命令之硬链接和软连接" class=md-nav__link> linux ln 命令之硬链接和软连接 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-7 type=checkbox id=nav-4-7> <label class=md-nav__link for=nav-4-7> 1008 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1008 data-md-level=2> <label class=md-nav__title for=nav-4-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1008 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1008/windows-media-play/ title="因为电脑缺少 windows media play 无法安装 windows 版本的 icloud" class=md-nav__link> 因为电脑缺少 windows media play 无法安装 windows 版本的 icloud </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-8 type=checkbox id=nav-4-8> <label class=md-nav__link for=nav-4-8> 1010 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1010 data-md-level=2> <label class=md-nav__title for=nav-4-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1010 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1010/windows-delete-icon/ title="Windows 下磁盘多余的图标删除" class=md-nav__link> Windows 下磁盘多余的图标删除 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-9 type=checkbox id=nav-4-9> <label class=md-nav__link for=nav-4-9> 1018 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1018 data-md-level=2> <label class=md-nav__title for=nav-4-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1018 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1018/java-swap-function/ title="关于 java swap 函数" class=md-nav__link> 关于 java swap 函数 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-10 type=checkbox id=nav-4-10> <label class=md-nav__link for=nav-4-10> 1025 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1025 data-md-level=2> <label class=md-nav__title for=nav-4-10> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1025 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1025/firewall-cmd/ title="centos 7 防火墙命令 firewall-cmd" class=md-nav__link> centos 7 防火墙命令 firewall-cmd </a> </li> <li class=md-nav__item> <a href=../../2018/1025/hexo-dns/ title="hexo 配置 dns 分流的问题" class=md-nav__link> hexo 配置 dns 分流的问题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-11 type=checkbox id=nav-4-11> <label class=md-nav__link for=nav-4-11> 1113 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1113 data-md-level=2> <label class=md-nav__title for=nav-4-11> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1113 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1113/ssh-login/ title="SSH 登录时出现如下错误：Disconnected:No supported authentication methods available" class=md-nav__link> SSH 登录时出现如下错误：Disconnected:No supported authentication methods available </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-12 type=checkbox id=nav-4-12> <label class=md-nav__link for=nav-4-12> 1202 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1202 data-md-level=2> <label class=md-nav__title for=nav-4-12> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1202 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1202/windows-git-bash/ title="windows git bash 配置颜色主题" class=md-nav__link> windows git bash 配置颜色主题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4-13 type=checkbox id=nav-4-13> <label class=md-nav__link for=nav-4-13> 1215 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1215 data-md-level=2> <label class=md-nav__title for=nav-4-13> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1215 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2018/1215/switch-eclipse-version/ title="切换 eclipse 编译版本" class=md-nav__link> 切换 eclipse 编译版本 </a> </li> <li class=md-nav__item> <a href=../../2018/1215/wtf/ title="Cannot find one or more componets. Please reinstall the application" class=md-nav__link> Cannot find one or more componets. Please reinstall the application </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> 2019 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2019 data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2019 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2019/ title=2019 class=md-nav__link> 2019 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> 0102 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0102 data-md-level=2> <label class=md-nav__title for=nav-5-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0102 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2019/0102/javascript-use/ title="JavaScript 作用域问题" class=md-nav__link> JavaScript 作用域问题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> 0216 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0216 data-md-level=2> <label class=md-nav__title for=nav-5-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0216 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2019/0216/javascript-error-msg/ title="JavaScript 错误参考" class=md-nav__link> JavaScript 错误参考 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> 0413 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0413 data-md-level=2> <label class=md-nav__title for=nav-5-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0413 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2019/0413/spring-framework-version/ title="获取 spring-framework 所有版本更新信息" class=md-nav__link> 获取 spring-framework 所有版本更新信息 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> 0414 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0414 data-md-level=2> <label class=md-nav__title for=nav-5-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0414 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2019/0414/tomcat-deploy-web/ title="Tomcat8/maven 部署 web 工程" class=md-nav__link> Tomcat8/maven 部署 web 工程 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-6 type=checkbox id=nav-5-6> <label class=md-nav__link for=nav-5-6> 0916 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0916 data-md-level=2> <label class=md-nav__title for=nav-5-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0916 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2019/0916/chrome-extention/ title="Chrome 解决第三方扩展安装的问题" class=md-nav__link> Chrome 解决第三方扩展安装的问题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-7 type=checkbox id=nav-5-7> <label class=md-nav__link for=nav-5-7> 1030 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1030 data-md-level=2> <label class=md-nav__title for=nav-5-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1030 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2019/1030/hexo-ogp/ title="hexo 博客添加 OGP" class=md-nav__link> hexo 博客添加 OGP </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5-8 type=checkbox id=nav-5-8> <label class=md-nav__link for=nav-5-8> 1104 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=1104 data-md-level=2> <label class=md-nav__title for=nav-5-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 1104 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2019/1104/hexo-kindle/ title="给 hexo 添加 send to kindle 链接" class=md-nav__link> 给 hexo 添加 send to kindle 链接 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> 2020 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=2020 data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 2020 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2020/ title=2020 class=md-nav__link> 2020 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-2 type=checkbox id=nav-6-2> <label class=md-nav__link for=nav-6-2> 0320 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0320 data-md-level=2> <label class=md-nav__title for=nav-6-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0320 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2020/0320/vscode-diff/ title="命令行下打开 Visual Studio Code" class=md-nav__link> 命令行下打开 Visual Studio Code </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-3 type=checkbox id=nav-6-3> <label class=md-nav__link for=nav-6-3> 0507 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0507 data-md-level=2> <label class=md-nav__title for=nav-6-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0507 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2020/0507/windows-scoop/ title="WINDOW 下使用 SCOOP 安装环境" class=md-nav__link> WINDOW 下使用 SCOOP 安装环境 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-4 type=checkbox id=nav-6-4> <label class=md-nav__link for=nav-6-4> 0617 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0617 data-md-level=2> <label class=md-nav__title for=nav-6-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0617 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2020/0617/mkdocs-material-turtorial/ title="Mkdocs 搭建博客指北" class=md-nav__link> Mkdocs 搭建博客指北 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-5 type=checkbox id=nav-6-5> <label class=md-nav__link for=nav-6-5> 0820 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0820 data-md-level=2> <label class=md-nav__title for=nav-6-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0820 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2020/0820/ABAP-code-indent/ title="ABAP code indentation" class=md-nav__link> ABAP code indentation </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-6 type=checkbox id=nav-6-6> <label class=md-nav__link for=nav-6-6> 0909 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0909 data-md-level=2> <label class=md-nav__title for=nav-6-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0909 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2020/0909/lightproxy-unofficial-document/ title="LightPorxy 非官方文档" class=md-nav__link> LightPorxy 非官方文档 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6-7 type=checkbox id=nav-6-7> <label class=md-nav__link for=nav-6-7> 0914 <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=0914 data-md-level=2> <label class=md-nav__title for=nav-6-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 0914 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../2020/0914/awosome-command-line-slide/ title="Command line interface" class=md-nav__link> Command line interface </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7 checked> <label class=md-nav__link for=nav-7> Archives <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Archives data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Archives </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> ABAP guide zh <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="ABAP guide zh" class="md-nav__link md-nav__link--active"> ABAP guide zh </a> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 目录 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 做法 </a> <nav class=md-nav aria-label=做法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 整洁代码入门之法 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 旧代码重构之法 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 自动检查之法 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 与其他指南互通之法 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 表示异议之法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 名称 </a> <nav class=md-nav aria-label=名称> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 使用描述性名称 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 首选解决方案域和问题域术语 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 使用复数形式 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 使用能读出来的名称 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 避免缩写 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 在各处使用相同缩写 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 用名词表示类而用动词表示方法 </a> </li> <li class=md-nav__item> <a href=#datainfoobject class=md-nav__link> 避免干扰词，如 "data"、"info"、"object" </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 每个概念选取一个词 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 仅在本意如此时使用模式名称 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 避免编码，特别是匈牙利表示法和前缀 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 语言 </a> <nav class=md-nav aria-label=语言> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 顾及传统 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 顾及性能 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 面向对象编程优于过程式编程 </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 函数式语言结构优于过程式语言结构 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 避免过时语言元素 </a> </li> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 明智地使用设计模式 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 常量 </a> <nav class=md-nav aria-label=常量> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 使用常量而非幻数 </a> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 枚举类优于常量接口 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 如果不使用枚举类，则对常量进行分组 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_30 class=md-nav__link> 变量 </a> <nav class=md-nav aria-label=变量> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_31 class=md-nav__link> 内联声明优于最前声明 </a> </li> <li class=md-nav__item> <a href=#_32 class=md-nav__link> 勿在可选分支中内联声明 </a> </li> <li class=md-nav__item> <a href=#_33 class=md-nav__link> 勿用链式最前声明 </a> </li> <li class=md-nav__item> <a href=#ref-to-field-symbol class=md-nav__link> REF TO 优于 FIELD-SYMBOL </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_34 class=md-nav__link> 表 </a> <nav class=md-nav aria-label=表> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_35 class=md-nav__link> 使用恰当的表类型 </a> </li> <li class=md-nav__item> <a href=#default-key class=md-nav__link> 避免 DEFAULT KEY </a> </li> <li class=md-nav__item> <a href=#insert-into-table-append-to class=md-nav__link> INSERT INTO TABLE 优于 APPEND TO </a> </li> <li class=md-nav__item> <a href=#line_exists-read-table-loop-at class=md-nav__link> LINE_EXISTS 优于 READ TABLE 或 LOOP AT </a> </li> <li class=md-nav__item> <a href=#read-table-loop-at class=md-nav__link> READ TABLE 优于 LOOP AT </a> </li> <li class=md-nav__item> <a href=#loop-at-where-if class=md-nav__link> LOOP AT WHERE 优于嵌套式 IF </a> </li> <li class=md-nav__item> <a href=#_36 class=md-nav__link> 避免不必要的表读取 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_37 class=md-nav__link> 字符串 </a> <nav class=md-nav aria-label=字符串> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_38 class=md-nav__link> 使用 ` 定义文字 </a> </li> <li class=md-nav__item> <a href=#_39 class=md-nav__link> 使用 | 汇集文本 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_40 class=md-nav__link> 布尔值 </a> <nav class=md-nav aria-label=布尔值> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_41 class=md-nav__link> 明智地使用布尔值 </a> </li> <li class=md-nav__item> <a href=#abap_bool class=md-nav__link> 用 ABAP_BOOL 表示布尔值 </a> </li> <li class=md-nav__item> <a href=#abap_true-abap_false class=md-nav__link> 使用 ABAP_TRUE 和 ABAP_FALSE 进行比较 </a> </li> <li class=md-nav__item> <a href=#xsdbool class=md-nav__link> 使用 XSDBOOL 设置布尔变量 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_42 class=md-nav__link> 条件 </a> <nav class=md-nav aria-label=条件> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_43 class=md-nav__link> 尽量使条件为正 </a> </li> <li class=md-nav__item> <a href=#is-not-not-is class=md-nav__link> IS NOT 优于 NOT IS </a> </li> <li class=md-nav__item> <a href=#_44 class=md-nav__link> 考虑分解复杂条件 </a> </li> <li class=md-nav__item> <a href=#_45 class=md-nav__link> 考虑提炼复杂条件 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#if class=md-nav__link> If 语句 </a> <nav class=md-nav aria-label="If 语句"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#if_1 class=md-nav__link> 无空的 IF 分支 </a> </li> <li class=md-nav__item> <a href=#case-else-if class=md-nav__link> 对于多个备选条件，CASE 优于 ELSE IF </a> </li> <li class=md-nav__item> <a href=#_46 class=md-nav__link> 保持低嵌套深度 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_47 class=md-nav__link> 正则表达式 </a> <nav class=md-nav aria-label=正则表达式> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_48 class=md-nav__link> 较简单的方法优于正则表达式 </a> </li> <li class=md-nav__item> <a href=#_49 class=md-nav__link> 基本检查优于正则表达式 </a> </li> <li class=md-nav__item> <a href=#_50 class=md-nav__link> 考虑汇集复杂的正则表达式 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_51 class=md-nav__link> 类 </a> <nav class=md-nav aria-label=类> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_52 class=md-nav__link> 类：面向对象 </a> <nav class=md-nav aria-label=类：面向对象> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_53 class=md-nav__link> 对象优于静态类 </a> </li> <li class=md-nav__item> <a href=#_54 class=md-nav__link> 组合优于继承 </a> </li> <li class=md-nav__item> <a href=#_55 class=md-nav__link> 勿在同一个类中混用有态和无态 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_56 class=md-nav__link> 作用域 </a> <nav class=md-nav aria-label=作用域> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_57 class=md-nav__link> 缺省情况下为全局，仅在适当位置为局部 </a> </li> <li class=md-nav__item> <a href=#final class=md-nav__link> 若非为继承而设计则为 FINAL </a> </li> <li class=md-nav__item> <a href=#private-protected class=md-nav__link> 缺省情况下为 PRIVATE，仅在需要时为 PROTECTED </a> </li> <li class=md-nav__item> <a href=#getter class=md-nav__link> 考虑使用不可变对象而非 getter </a> </li> <li class=md-nav__item> <a href=#read-only class=md-nav__link> 保守地使用 READ-ONLY </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_58 class=md-nav__link> 构造函数 </a> <nav class=md-nav aria-label=构造函数> <ul class=md-nav__list> <li class=md-nav__item> <a href=#new-create-object class=md-nav__link> NEW 优于 CREATE OBJECT </a> </li> <li class=md-nav__item> <a href=#create-private-constructor class=md-nav__link> 如果全局类为 CREATE PRIVATE，则保留 CONSTRUCTOR 为公有 </a> </li> <li class=md-nav__item> <a href=#_59 class=md-nav__link> 多个静态创建方法优于可选参数 </a> </li> <li class=md-nav__item> <a href=#_60 class=md-nav__link> 用描述性名称表示多个创建方法 </a> </li> <li class=md-nav__item> <a href=#_61 class=md-nav__link> 仅在多实例无意义的情况下变成单例 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_62 class=md-nav__link> 方法 </a> <nav class=md-nav aria-label=方法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_63 class=md-nav__link> 调用 </a> <nav class=md-nav aria-label=调用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_64 class=md-nav__link> 函数式调用优于过程式调用 </a> </li> <li class=md-nav__item> <a href=#receiving class=md-nav__link> 省略 RECEIVING </a> </li> <li class=md-nav__item> <a href=#exporting class=md-nav__link> 省略可选关键字 EXPORTING </a> </li> <li class=md-nav__item> <a href=#_65 class=md-nav__link> 在单参数调用中省略参数名称 </a> </li> <li class=md-nav__item> <a href=#me class=md-nav__link> 在调用实例方法时省略自我引用 me </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_66 class=md-nav__link> 方法：面向对象 </a> <nav class=md-nav aria-label=方法：面向对象> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_67 class=md-nav__link> 实例优于静态方法 </a> </li> <li class=md-nav__item> <a href=#_68 class=md-nav__link> 公共实例方法应为接口的一部分 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_69 class=md-nav__link> 参数数目 </a> <nav class=md-nav aria-label=参数数目> <ul class=md-nav__list> <li class=md-nav__item> <a href=#importing class=md-nav__link> 力图减少 IMPORTING 参数，最好少于三个 </a> </li> <li class=md-nav__item> <a href=#optional class=md-nav__link> 拆分方法而非添加 OPTIONAL 参数 </a> </li> <li class=md-nav__item> <a href=#preferred-parameter class=md-nav__link> 保守地使用 PREFERRED PARAMETER </a> </li> <li class=md-nav__item> <a href=#returnexport-change class=md-nav__link> RETURN、EXPORT 或 CHANGE 恰有一个参数 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_70 class=md-nav__link> 参数类型 </a> <nav class=md-nav aria-label=参数类型> <ul class=md-nav__list> <li class=md-nav__item> <a href=#returning-exporting class=md-nav__link> RETURNING 优于 EXPORTING </a> </li> <li class=md-nav__item> <a href=#returning class=md-nav__link> RETURNING 大表通常没有问题 </a> </li> <li class=md-nav__item> <a href=#returning-exporting-changing class=md-nav__link> 单独使用 RETURNING 或 EXPORTING 或 CHANGING，而不要组合使用 </a> </li> <li class=md-nav__item> <a href=#changing class=md-nav__link> 在合适时保守地使用 CHANGING </a> </li> <li class=md-nav__item> <a href=#_71 class=md-nav__link> 拆分方法而非使用布尔输入参数 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_72 class=md-nav__link> 参数名称 </a> <nav class=md-nav aria-label=参数名称> <ul class=md-nav__list> <li class=md-nav__item> <a href=#returning-result class=md-nav__link> 考虑调用 RETURNING 参数 RESULT </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_73 class=md-nav__link> 参数初始化 </a> <nav class=md-nav aria-label=参数初始化> <ul class=md-nav__list> <li class=md-nav__item> <a href=#exporting_1 class=md-nav__link> 清除或覆盖 EXPORTING 引用参数 </a> <nav class=md-nav aria-label="清除或覆盖 EXPORTING 引用参数"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_74 class=md-nav__link> 如果输入和输出可能相同则要当心 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#value class=md-nav__link> 勿清除 VALUE 参数 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_75 class=md-nav__link> 方法体 </a> <nav class=md-nav aria-label=方法体> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_76 class=md-nav__link> 做且仅做一件事，把它做好 </a> </li> <li class=md-nav__item> <a href=#_77 class=md-nav__link> 关注愉快路径或错误处理，但非两者兼顾 </a> </li> <li class=md-nav__item> <a href=#_78 class=md-nav__link> 将抽象降一级 </a> </li> <li class=md-nav__item> <a href=#_79 class=md-nav__link> 保持方法精简 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_80 class=md-nav__link> 控制流 </a> <nav class=md-nav aria-label=控制流> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_81 class=md-nav__link> 快速失败 </a> </li> <li class=md-nav__item> <a href=#check-return class=md-nav__link> CHECK 对 RETURN </a> </li> <li class=md-nav__item> <a href=#check class=md-nav__link> 避免在其他位置使用 CHECK </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_82 class=md-nav__link> 错误处理 </a> <nav class=md-nav aria-label=错误处理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_83 class=md-nav__link> 消息 </a> <nav class=md-nav aria-label=消息> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_84 class=md-nav__link> 使消息易于查找 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_85 class=md-nav__link> 返回代码 </a> <nav class=md-nav aria-label=返回代码> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_86 class=md-nav__link> 异常优于返回代码 </a> </li> <li class=md-nav__item> <a href=#_87 class=md-nav__link> 别让故障溜走 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_88 class=md-nav__link> 异常 </a> <nav class=md-nav aria-label=异常> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_89 class=md-nav__link> 异常针对的是错误，而不是正常情况 </a> </li> <li class=md-nav__item> <a href=#_90 class=md-nav__link> 使用基于类的异常 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_91 class=md-nav__link> 抛出 </a> <nav class=md-nav aria-label=抛出> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_92 class=md-nav__link> 使用各自的超类 </a> </li> <li class=md-nav__item> <a href=#_93 class=md-nav__link> 抛出一种类型的异常 </a> </li> <li class=md-nav__item> <a href=#_94 class=md-nav__link> 使用子类以便调用者能够区分错误情况 </a> </li> <li class=md-nav__item> <a href=#cx_static_check class=md-nav__link> 针对可应对的异常抛出 CX_STATIC_CHECK </a> </li> <li class=md-nav__item> <a href=#cx_no_check class=md-nav__link> 针对通常不可恢复的情况抛出 CX_NO_CHECK </a> </li> <li class=md-nav__item> <a href=#cx_dynamic_check class=md-nav__link> 针对可避免的异常考虑 CX_DYNAMIC_CHECK </a> </li> <li class=md-nav__item> <a href=#_95 class=md-nav__link> 针对完全不可恢复的情况进行转储 </a> </li> <li class=md-nav__item> <a href=#raise-exception-new-raise-exception-type class=md-nav__link> RAISE EXCEPTION NEW 优于 RAISE EXCEPTION TYPE </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_96 class=md-nav__link> 捕获 </a> <nav class=md-nav aria-label=捕获> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_97 class=md-nav__link> 包裹外来异常而非任其侵入代码 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_98 class=md-nav__link> 注释 </a> <nav class=md-nav aria-label=注释> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_99 class=md-nav__link> 用代码表达自己而不是靠注释 </a> </li> <li class=md-nav__item> <a href=#_100 class=md-nav__link> 注释绝非坏名称的借口 </a> </li> <li class=md-nav__item> <a href=#_101 class=md-nav__link> 使用方法而非注释来对代码分段 </a> </li> <li class=md-nav__item> <a href=#_102 class=md-nav__link> 写注释是要解释为什么而非是什么 </a> </li> <li class=md-nav__item> <a href=#_103 class=md-nav__link> 设计应放到设计文档里而不是代码里 </a> </li> <li class=md-nav__item> <a href=#_104 class=md-nav__link> 用 " 而非 * 加注释 </a> </li> <li class=md-nav__item> <a href=#_105 class=md-nav__link> 将注释放在与其相关的语句前面 </a> </li> <li class=md-nav__item> <a href=#_106 class=md-nav__link> 删除代码而非将其注释掉 </a> </li> <li class=md-nav__item> <a href=#fixmetodo-xxx class=md-nav__link> 使用 FIXME、TODO 和 XXX 并添加自己的标识 </a> </li> <li class=md-nav__item> <a href=#_107 class=md-nav__link> 勿添加方法签名和注释结尾 </a> </li> <li class=md-nav__item> <a href=#_108 class=md-nav__link> 勿复制消息文本作为注释 </a> </li> <li class=md-nav__item> <a href=#abap-api class=md-nav__link> ABAP 文档仅适用于公共 API </a> </li> <li class=md-nav__item> <a href=#_109 class=md-nav__link> 编译指示优于伪注释 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_110 class=md-nav__link> 格式化 </a> <nav class=md-nav aria-label=格式化> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_111 class=md-nav__link> 保持一致 </a> </li> <li class=md-nav__item> <a href=#_112 class=md-nav__link> 为阅读而不是书写进行优化 </a> </li> <li class=md-nav__item> <a href=#_113 class=md-nav__link> 激活前使用格式优化器 </a> </li> <li class=md-nav__item> <a href=#_114 class=md-nav__link> 使用格式优化器团队设置 </a> </li> <li class=md-nav__item> <a href=#_115 class=md-nav__link> 每行只有一条语句 </a> </li> <li class=md-nav__item> <a href=#_116 class=md-nav__link> 恪守合理的行长度 </a> </li> <li class=md-nav__item> <a href=#_117 class=md-nav__link> 紧缩代码 </a> </li> <li class=md-nav__item> <a href=#_118 class=md-nav__link> 添加单一空行来分隔内容，而不要添加多行 </a> </li> <li class=md-nav__item> <a href=#_119 class=md-nav__link> 勿因分隔空行产生困扰 </a> </li> <li class=md-nav__item> <a href=#_120 class=md-nav__link> 对齐同一对象而非不同对象的赋值 </a> </li> <li class=md-nav__item> <a href=#_121 class=md-nav__link> 在行尾关闭括号 </a> </li> <li class=md-nav__item> <a href=#_122 class=md-nav__link> 保持单参数调用于一行 </a> </li> <li class=md-nav__item> <a href=#_123 class=md-nav__link> 保持参数在调用后面 </a> </li> <li class=md-nav__item> <a href=#_124 class=md-nav__link> 如果换行，则在调用下缩进参数 </a> </li> <li class=md-nav__item> <a href=#_125 class=md-nav__link> 将多个参数换行 </a> </li> <li class=md-nav__item> <a href=#_126 class=md-nav__link> 对齐参数 </a> </li> <li class=md-nav__item> <a href=#_127 class=md-nav__link> 如果调用行过长则将其换行 </a> </li> <li class=md-nav__item> <a href=#_128 class=md-nav__link> 缩进并卡到制表位 </a> </li> <li class=md-nav__item> <a href=#_129 class=md-nav__link> 如同方法调用那样缩进内联声明 </a> </li> <li class=md-nav__item> <a href=#_130 class=md-nav__link> 勿对齐类型子句 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_131 class=md-nav__link> 测试 </a> <nav class=md-nav aria-label=测试> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_132 class=md-nav__link> 原则 </a> <nav class=md-nav aria-label=原则> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_133 class=md-nav__link> 编写可测试的代码 </a> </li> <li class=md-nav__item> <a href=#_134 class=md-nav__link> 让他人能够进行模拟 </a> </li> <li class=md-nav__item> <a href=#_135 class=md-nav__link> 可读性规则 </a> </li> <li class=md-nav__item> <a href=#_136 class=md-nav__link> 勿制作副本或写测试报告 </a> </li> <li class=md-nav__item> <a href=#_137 class=md-nav__link> 测试公共项而非私有内部项 </a> </li> <li class=md-nav__item> <a href=#_138 class=md-nav__link> 勿困扰于覆盖范围 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_139 class=md-nav__link> 测试类 </a> <nav class=md-nav aria-label=测试类> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_140 class=md-nav__link> 按用途调用局部测试类 </a> </li> <li class=md-nav__item> <a href=#_141 class=md-nav__link> 将测试放在局部类 </a> </li> <li class=md-nav__item> <a href=#_142 class=md-nav__link> 将帮助方法放在帮助类 </a> </li> <li class=md-nav__item> <a href=#_143 class=md-nav__link> 如何执行测试类 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_144 class=md-nav__link> 被测代码 </a> <nav class=md-nav aria-label=被测代码> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cut class=md-nav__link> 赋予被测代码有意义的名称，或使用缺省名称 CUT </a> </li> <li class=md-nav__item> <a href=#_145 class=md-nav__link> 测试接口而非类 </a> </li> <li class=md-nav__item> <a href=#_146 class=md-nav__link> 将被测代码的调用提取到自身的方法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_147 class=md-nav__link> 注入 </a> <nav class=md-nav aria-label=注入> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_148 class=md-nav__link> 使用依赖倒置注入测试替身 </a> </li> <li class=md-nav__item> <a href=#abap_1 class=md-nav__link> 考虑使用 ABAP 测试替身工具 </a> </li> <li class=md-nav__item> <a href=#_149 class=md-nav__link> 利用测试工具 </a> </li> <li class=md-nav__item> <a href=#_150 class=md-nav__link> 使用测试缝隙作为临时解决办法 </a> </li> <li class=md-nav__item> <a href=#local-friends class=md-nav__link> 使用 LOCAL FRIENDS 访问依赖倒置的构造函数 </a> </li> <li class=md-nav__item> <a href=#local-friends_1 class=md-nav__link> 勿滥用 LOCAL FRIENDS 侵入被测代码 </a> </li> <li class=md-nav__item> <a href=#_151 class=md-nav__link> 勿更改生产代码来使代码可测试 </a> </li> <li class=md-nav__item> <a href=#_152 class=md-nav__link> 勿子类化来模拟方法 </a> </li> <li class=md-nav__item> <a href=#_153 class=md-nav__link> 勿模拟不需要的东西 </a> </li> <li class=md-nav__item> <a href=#_154 class=md-nav__link> 勿构建测试框架 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_155 class=md-nav__link> 测试方法 </a> <nav class=md-nav aria-label=测试方法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_156 class=md-nav__link> 测试方法名称：反映出设想和预期的情形 </a> </li> <li class=md-nav__item> <a href=#given-when-then class=md-nav__link> 使用 given-when-then </a> </li> <li class=md-nav__item> <a href=#when class=md-nav__link> "When" 恰为一个调用 </a> </li> <li class=md-nav__item> <a href=#teardown class=md-nav__link> 除非真正需要否则勿添加 TEARDOWN </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_157 class=md-nav__link> 测试数据 </a> <nav class=md-nav aria-label=测试数据> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_158 class=md-nav__link> 使其易于辨明含义 </a> </li> <li class=md-nav__item> <a href=#_159 class=md-nav__link> 使其易于辨明差异 </a> </li> <li class=md-nav__item> <a href=#_160 class=md-nav__link> 使用常量描述测试数据的用途和重要性 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_161 class=md-nav__link> 断言 </a> <nav class=md-nav aria-label=断言> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_162 class=md-nav__link> 少而精的断言 </a> </li> <li class=md-nav__item> <a href=#_163 class=md-nav__link> 使用恰当的断言类型 </a> </li> <li class=md-nav__item> <a href=#_164 class=md-nav__link> 断言内容而非数量 </a> </li> <li class=md-nav__item> <a href=#_165 class=md-nav__link> 断言质量而非内容 </a> </li> <li class=md-nav__item> <a href=#fail class=md-nav__link> 使用 FAIL 检查是否出现预期异常 </a> </li> <li class=md-nav__item> <a href=#_166 class=md-nav__link> 转发意外异常而非捕获就失败 </a> </li> <li class=md-nav__item> <a href=#_167 class=md-nav__link> 编写自定义断言以缩短代码和避免重复 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../archives/ title=Archives class=md-nav__link> Archives </a> </li> <li class=md-nav__item> <a href=../lightproxy-unofficial-document/ title="LightPorxy 非官方文档" class=md-nav__link> LightPorxy 非官方文档 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> Docs <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Docs data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Docs </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-1 type=checkbox id=nav-8-1> <label class=md-nav__link for=nav-8-1> Backup <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Backup data-md-level=2> <label class=md-nav__title for=nav-8-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Backup </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/backup/171216/ title="CentOs 6.7 安装 owncloud" class=md-nav__link> CentOs 6.7 安装 owncloud </a> </li> <li class=md-nav__item> <a href=../../docs/backup/171231/ title=谷歌高级搜索 class=md-nav__link> 谷歌高级搜索 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/180102/ title="CentOS 6.7 安装 bind" class=md-nav__link> CentOS 6.7 安装 bind </a> </li> <li class=md-nav__item> <a href=../../docs/backup/180103/ title="CentOS 6.7 安装 redis" class=md-nav__link> CentOS 6.7 安装 redis </a> </li> <li class=md-nav__item> <a href=../../docs/backup/180510/ title="CentOS 6.7 开启 DHCP 服务" class=md-nav__link> CentOS 6.7 开启 DHCP 服务 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/180828_1/ title="180828 1" class=md-nav__link> 180828 1 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/180828_2/ title="命令行编译 Eclipse 创建的 Java 程序" class=md-nav__link> 命令行编译 Eclipse 创建的 Java 程序 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/180915/ title="mermaid.js 使用" class=md-nav__link> mermaid.js 使用 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/181001_1/ title="解决 git LF 和 CFLF 换行问题" class=md-nav__link> 解决 git LF 和 CFLF 换行问题 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/181003_1/ title="vscode 控制台输出编码问题" class=md-nav__link> vscode 控制台输出编码问题 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/181004_4/ title="vim 配置" class=md-nav__link> vim 配置 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/181208_1/ title="j2ee 的 jstl 找不到包" class=md-nav__link> j2ee 的 jstl 找不到包 </a> </li> <li class=md-nav__item> <a href=../../docs/backup/200206_1/ title="python Relative precedence of := 海象运算符 翻译" class=md-nav__link> python Relative precedence of := 海象运算符 翻译 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2 type=checkbox id=nav-8-2> <label class=md-nav__link for=nav-8-2> Command <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Command data-md-level=2> <label class=md-nav__title for=nav-8-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Command </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/command/bash-cheatsheet/ title="bash chaet sheet" class=md-nav__link> bash chaet sheet </a> </li> <li class=md-nav__item> <a href=../../docs/command/funny/ title=funny class=md-nav__link> funny </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-3 type=checkbox id=nav-8-2-3> <label class=md-nav__link for=nav-8-2-3> Cmd <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Cmd data-md-level=3> <label class=md-nav__title for=nav-8-2-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Cmd </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/command/cmd/about-wifi/ title=wifi class=md-nav__link> wifi </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/chcp/ title=chcp class=md-nav__link> chcp </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/clip/ title=clip class=md-nav__link> clip </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/fuck/ title=!! class=md-nav__link> !! </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/gcc/ title=gcc class=md-nav__link> gcc </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/javap/ title=javap class=md-nav__link> javap </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/netstat/ title=netstat class=md-nav__link> netstat </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/ping/ title=ping class=md-nav__link> ping </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/set/ title=set class=md-nav__link> set </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/shutdown/ title=shutdown class=md-nav__link> shutdown </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/taskkill/ title=taskkill class=md-nav__link> taskkill </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/wireshark/ title=wireshark class=md-nav__link> wireshark </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/wmic/ title=wmic class=md-nav__link> wmic </a> </li> <li class=md-nav__item> <a href=../../docs/command/cmd/wsl/ title=wsl class=md-nav__link> wsl </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-4 type=checkbox id=nav-8-2-4> <label class=md-nav__link for=nav-8-2-4> Linux <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Linux data-md-level=3> <label class=md-nav__title for=nav-8-2-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Linux </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/command/linux/cat/ title=cat class=md-nav__link> cat </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/csplit/ title=csplit class=md-nav__link> csplit </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/dd/ title=dd class=md-nav__link> dd </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/df/ title=df class=md-nav__link> df </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/dpkg/ title=dpkg class=md-nav__link> dpkg </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/ethtool/ title=ethtool class=md-nav__link> ethtool </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/find/ title=find class=md-nav__link> find </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/git/ title=git class=md-nav__link> git </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/grep/ title=grep class=md-nav__link> grep </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/history/ title=history class=md-nav__link> history </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/ifconfig/ title=ipconfig class=md-nav__link> ipconfig </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/last/ title=last class=md-nav__link> last </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/lsof/ title=lsof class=md-nav__link> lsof </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/mmv/ title=mmv class=md-nav__link> mmv </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/mv/ title=mv class=md-nav__link> mv </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/scp/ title=scp class=md-nav__link> scp </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/service/ title=service class=md-nav__link> service </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/shred/ title=shred class=md-nav__link> shred </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/split/ title=Split class=md-nav__link> Split </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/tail/ title=tail class=md-nav__link> tail </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/top/ title=top class=md-nav__link> top </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/w/ title=w class=md-nav__link> w </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/watch/ title=watch class=md-nav__link> watch </a> </li> <li class=md-nav__item> <a href=../../docs/command/linux/wget/ title=wget class=md-nav__link> wget </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-5 type=checkbox id=nav-8-2-5> <label class=md-nav__link for=nav-8-2-5> Service <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Service data-md-level=3> <label class=md-nav__title for=nav-8-2-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Service </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/command/service/docker/ title=docker class=md-nav__link> docker </a> </li> <li class=md-nav__item> <a href=../../docs/command/service/github/ title=github class=md-nav__link> github </a> </li> <li class=md-nav__item> <a href=../../docs/command/service/hexo/ title=hexo class=md-nav__link> hexo </a> </li> <li class=md-nav__item> <a href=../../docs/command/service/mysql/ title=mysql class=md-nav__link> mysql </a> </li> <li class=md-nav__item> <a href=../../docs/command/service/rsshub/ title=rsshub class=md-nav__link> rsshub </a> </li> <li class=md-nav__item> <a href=../../docs/command/service/sycnthing/ title=sycnthing class=md-nav__link> sycnthing </a> </li> <li class=md-nav__item> <a href=../../docs/command/service/ttrss/ title=ttrss class=md-nav__link> ttrss </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-2-6 type=checkbox id=nav-8-2-6> <label class=md-nav__link for=nav-8-2-6> Tools <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Tools data-md-level=3> <label class=md-nav__title for=nav-8-2-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Tools </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/command/tools/ title=tools class=md-nav__link> tools </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/ag/ title=ag class=md-nav__link> ag </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/aria2/ title=aria2 class=md-nav__link> aria2 </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/asciinema/ title=asciinema class=md-nav__link> asciinema </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/book/ title=book class=md-nav__link> book </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/bypy/ title=bypy class=md-nav__link> bypy </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/code/ title=code class=md-nav__link> code </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/curl/ title=curl class=md-nav__link> curl </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/diff2html/ title=diff2html class=md-nav__link> diff2html </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/docker/ title=docker class=md-nav__link> docker </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/fail2ban/ title=fail2ban class=md-nav__link> fail2ban </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/ffmepg/ title=ffmpeg class=md-nav__link> ffmpeg </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/jq/ title=jq class=md-nav__link> jq </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/mvn/ title=mvn class=md-nav__link> mvn </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/nativefier/ title=nativefier class=md-nav__link> nativefier </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/npm/ title=Npm class=md-nav__link> Npm </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/ossutil/ title=ossutil class=md-nav__link> ossutil </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/pandoc/ title=Pandoc class=md-nav__link> Pandoc </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/pdfminer.six/ title=pdfminer.six class=md-nav__link> pdfminer.six </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/pip/ title=Pip class=md-nav__link> Pip </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/poetry/ title=Poetry class=md-nav__link> Poetry </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/spotdl/ title=spotdl class=md-nav__link> spotdl </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/wkhtmltopdf/ title=wkhtmltopdf class=md-nav__link> wkhtmltopdf </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/ydict/ title=ydict class=md-nav__link> ydict </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/you-get/ title=you-get class=md-nav__link> you-get </a> </li> <li class=md-nav__item> <a href=../../docs/command/tools/z/ title=Z class=md-nav__link> Z </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-3 type=checkbox id=nav-8-3> <label class=md-nav__link for=nav-8-3> Digest <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Digest data-md-level=2> <label class=md-nav__title for=nav-8-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Digest </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/digest/180719/ title=编程词汇表 class=md-nav__link> 编程词汇表 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/180720_1/ title=中国程序员容易发音错误的单词 class=md-nav__link> 中国程序员容易发音错误的单词 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/180720_2/ title=把《编程珠玑》读薄 class=md-nav__link> 把《编程珠玑》读薄 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/180916/ title=提问的智慧 class=md-nav__link> 提问的智慧 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/180919/ title=中文文案排版指北 class=md-nav__link> 中文文案排版指北 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/180920/ title=文档体系 class=md-nav__link> 文档体系 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/180921/ title=英语技巧 class=md-nav__link> 英语技巧 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/180927_2/ title="synchronized 实现" class=md-nav__link> synchronized 实现 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/180927_3/ title="JSR 133 FAQ 翻译" class=md-nav__link> JSR 133 FAQ 翻译 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/181001_6/ title="m3u8 转 mp4" class=md-nav__link> m3u8 转 mp4 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/181004_1/ title=中文技术文档的写作规范 class=md-nav__link> 中文技术文档的写作规范 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/181016_1/ title="一段用 html 创建流程图的源码" class=md-nav__link> 一段用 html 创建流程图的源码 </a> </li> <li class=md-nav__item> <a href=../../docs/digest/190218_1/ title="markdownlint Rules(1)" class=md-nav__link> markdownlint Rules(1) </a> </li> <li class=md-nav__item> <a href=../../docs/digest/190218_2/ title="markdownlint Rules(2)" class=md-nav__link> markdownlint Rules(2) </a> </li> <li class=md-nav__item> <a href=../../docs/digest/190606_1/ title=Java调用WebService的几种方式 class=md-nav__link> Java调用WebService的几种方式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-4 type=checkbox id=nav-8-4> <label class=md-nav__link for=nav-8-4> Log <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Log data-md-level=2> <label class=md-nav__title for=nav-8-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Log </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/log/firefox-addon/ title="Firefox 临时加载扩展" class=md-nav__link> Firefox 临时加载扩展 </a> </li> <li class=md-nav__item> <a href=../../docs/log/fix-bugs/ title="FIX BUG" class=md-nav__link> FIX BUG </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-5 type=checkbox id=nav-8-5> <label class=md-nav__link for=nav-8-5> Note <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Note data-md-level=2> <label class=md-nav__title for=nav-8-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Note </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/note/ISO-8601/ title="ISO 8601" class=md-nav__link> ISO 8601 </a> </li> <li class=md-nav__item> <a href=../../docs/note/code-pushdown/ title="Code pusudown 准则" class=md-nav__link> Code pusudown 准则 </a> </li> <li class=md-nav__item> <a href=../../docs/note/code-pusudown/ title="Code pusudown 准则" class=md-nav__link> Code pusudown 准则 </a> </li> <li class=md-nav__item> <a href=../../docs/note/code-smell/ title=常见的代码异味 class=md-nav__link> 常见的代码异味 </a> </li> <li class=md-nav__item> <a href=../../docs/note/json-styleguide-note/ title="Json 风格指南笔记" class=md-nav__link> Json 风格指南笔记 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-6 type=checkbox id=nav-8-6> <label class=md-nav__link for=nav-8-6> Snippets <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Snippets data-md-level=2> <label class=md-nav__title for=nav-8-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Snippets </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/snippets/emoji-snippets/ title="Emoji Snippets" class=md-nav__link> Emoji Snippets </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-6-2 type=checkbox id=nav-8-6-2> <label class=md-nav__link for=nav-8-6-2> Abap <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Abap data-md-level=3> <label class=md-nav__title for=nav-8-6-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Abap </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/snippets/abap/abap-gui-shortcuts/ title="abap gui shortcuts" class=md-nav__link> abap gui shortcuts </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-6-3 type=checkbox id=nav-8-6-3> <label class=md-nav__link for=nav-8-6-3> Others <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Others data-md-level=3> <label class=md-nav__title for=nav-8-6-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Others </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/snippets/others/cons-function/ title="case function" class=md-nav__link> case function </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/others/function-prefix-words/ title="function prefix words" class=md-nav__link> function prefix words </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/others/markdown/ title="markdown snippets" class=md-nav__link> markdown snippets </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/others/my-todoist/ title="我的 Todoist 使用心得" class=md-nav__link> 我的 Todoist 使用心得 </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/others/regex/ title=Regex class=md-nav__link> Regex </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/others/test-if/ title="and operator 的妙用" class=md-nav__link> and operator 的妙用 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-6-4 type=checkbox id=nav-8-6-4> <label class=md-nav__link for=nav-8-6-4> Python <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Python data-md-level=3> <label class=md-nav__title for=nav-8-6-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Python </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/snippets/python/pytest/ title="Pytest snippets" class=md-nav__link> Pytest snippets </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/python/python-builder/ title="Python Builder" class=md-nav__link> Python Builder </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/python/python-decorator/ title="Python decorator" class=md-nav__link> Python decorator </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/python/python-logging/ title="Python logging" class=md-nav__link> Python logging </a> </li> <li class=md-nav__item> <a href=../../docs/snippets/python/python-mock/ title="Python Mock" class=md-nav__link> Python Mock </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7 type=checkbox id=nav-8-7> <label class=md-nav__link for=nav-8-7> Template <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Template data-md-level=2> <label class=md-nav__title for=nav-8-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Template </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-1 type=checkbox id=nav-8-7-1> <label class=md-nav__link for=nav-8-7-1> Css <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Css data-md-level=3> <label class=md-nav__title for=nav-8-7-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Css </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/template/css/focus-cursor-move/ title=CSS光标下划线跟随效果 class=md-nav__link> CSS光标下划线跟随效果 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-2 type=checkbox id=nav-8-7-2> <label class=md-nav__link for=nav-8-7-2> Javascript <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Javascript data-md-level=3> <label class=md-nav__title for=nav-8-7-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Javascript </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/template/javascript/fibonacci/ title=菲波那切数列 class=md-nav__link> 菲波那切数列 </a> </li> <li class=md-nav__item> <a href=../../docs/template/javascript/jquery/ title=jquery class=md-nav__link> jquery </a> </li> <li class=md-nav__item> <a href=../../docs/template/javascript/trim/ title=trim class=md-nav__link> trim </a> </li> <li class=md-nav__item> <a href=../../docs/template/javascript/url/ title="返回一个包含当前 URL 参数的对象" class=md-nav__link> 返回一个包含当前 URL 参数的对象 </a> </li> <li class=md-nav__item> <a href=../../docs/template/javascript/uuid/ title=UUID class=md-nav__link> UUID </a> </li> <li class=md-nav__item> <a href=../../docs/template/javascript/voice/ title="js 语音合成" class=md-nav__link> js 语音合成 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-7-3 type=checkbox id=nav-8-7-3> <label class=md-nav__link for=nav-8-7-3> Sql <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Sql data-md-level=3> <label class=md-nav__title for=nav-8-7-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Sql </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/template/sql/get-data-table-create-structure/ title=get-data-table-create-structure class=md-nav__link> get-data-table-create-structure </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8-8 type=checkbox id=nav-8-8> <label class=md-nav__link for=nav-8-8> Via <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Via data-md-level=2> <label class=md-nav__title for=nav-8-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Via </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../docs/via/ title=via class=md-nav__link> via </a> </li> <li class=md-nav__item> <a href=../../docs/via/LGTM/ title=LGTM class=md-nav__link> LGTM </a> </li> <li class=md-nav__item> <a href=../../docs/via/bilibili-rex/ title="bilibili 正则" class=md-nav__link> bilibili 正则 </a> </li> <li class=md-nav__item> <a href=../../docs/via/get_m3u8/ title="使用 Javascript 获取 m3u8" class=md-nav__link> 使用 Javascript 获取 m3u8 </a> </li> <li class=md-nav__item> <a href=../../docs/via/github_check/ title="获取 github 快速 IP" class=md-nav__link> 获取 github 快速 IP </a> </li> <li class=md-nav__item> <a href=../../docs/via/ubuntu/ title=UBUNTU class=md-nav__link> UBUNTU </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> Weekly <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Weekly data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Weekly </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../weekly/weekly-2020-10-0x01/ title="Weekly 2020-10-0x01" class=md-nav__link> Weekly 2020-10-0x01 </a> </li> <li class=md-nav__item> <a href=../../weekly/weekly-2020-10-0x02/ title=weekly-2020-10-0x02 class=md-nav__link> weekly-2020-10-0x02 </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label=目录> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> 目录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#_1 class=md-nav__link> 目录 </a> </li> <li class=md-nav__item> <a href=#_2 class=md-nav__link> 做法 </a> <nav class=md-nav aria-label=做法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_3 class=md-nav__link> 整洁代码入门之法 </a> </li> <li class=md-nav__item> <a href=#_4 class=md-nav__link> 旧代码重构之法 </a> </li> <li class=md-nav__item> <a href=#_5 class=md-nav__link> 自动检查之法 </a> </li> <li class=md-nav__item> <a href=#_6 class=md-nav__link> 与其他指南互通之法 </a> </li> <li class=md-nav__item> <a href=#_7 class=md-nav__link> 表示异议之法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_8 class=md-nav__link> 名称 </a> <nav class=md-nav aria-label=名称> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_9 class=md-nav__link> 使用描述性名称 </a> </li> <li class=md-nav__item> <a href=#_10 class=md-nav__link> 首选解决方案域和问题域术语 </a> </li> <li class=md-nav__item> <a href=#_11 class=md-nav__link> 使用复数形式 </a> </li> <li class=md-nav__item> <a href=#_12 class=md-nav__link> 使用能读出来的名称 </a> </li> <li class=md-nav__item> <a href=#_13 class=md-nav__link> 避免缩写 </a> </li> <li class=md-nav__item> <a href=#_14 class=md-nav__link> 在各处使用相同缩写 </a> </li> <li class=md-nav__item> <a href=#_15 class=md-nav__link> 用名词表示类而用动词表示方法 </a> </li> <li class=md-nav__item> <a href=#datainfoobject class=md-nav__link> 避免干扰词，如 "data"、"info"、"object" </a> </li> <li class=md-nav__item> <a href=#_16 class=md-nav__link> 每个概念选取一个词 </a> </li> <li class=md-nav__item> <a href=#_17 class=md-nav__link> 仅在本意如此时使用模式名称 </a> </li> <li class=md-nav__item> <a href=#_18 class=md-nav__link> 避免编码，特别是匈牙利表示法和前缀 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_19 class=md-nav__link> 语言 </a> <nav class=md-nav aria-label=语言> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_20 class=md-nav__link> 顾及传统 </a> </li> <li class=md-nav__item> <a href=#_21 class=md-nav__link> 顾及性能 </a> </li> <li class=md-nav__item> <a href=#_22 class=md-nav__link> 面向对象编程优于过程式编程 </a> </li> <li class=md-nav__item> <a href=#_23 class=md-nav__link> 函数式语言结构优于过程式语言结构 </a> </li> <li class=md-nav__item> <a href=#_24 class=md-nav__link> 避免过时语言元素 </a> </li> <li class=md-nav__item> <a href=#_25 class=md-nav__link> 明智地使用设计模式 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_26 class=md-nav__link> 常量 </a> <nav class=md-nav aria-label=常量> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_27 class=md-nav__link> 使用常量而非幻数 </a> </li> <li class=md-nav__item> <a href=#_28 class=md-nav__link> 枚举类优于常量接口 </a> </li> <li class=md-nav__item> <a href=#_29 class=md-nav__link> 如果不使用枚举类，则对常量进行分组 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_30 class=md-nav__link> 变量 </a> <nav class=md-nav aria-label=变量> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_31 class=md-nav__link> 内联声明优于最前声明 </a> </li> <li class=md-nav__item> <a href=#_32 class=md-nav__link> 勿在可选分支中内联声明 </a> </li> <li class=md-nav__item> <a href=#_33 class=md-nav__link> 勿用链式最前声明 </a> </li> <li class=md-nav__item> <a href=#ref-to-field-symbol class=md-nav__link> REF TO 优于 FIELD-SYMBOL </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_34 class=md-nav__link> 表 </a> <nav class=md-nav aria-label=表> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_35 class=md-nav__link> 使用恰当的表类型 </a> </li> <li class=md-nav__item> <a href=#default-key class=md-nav__link> 避免 DEFAULT KEY </a> </li> <li class=md-nav__item> <a href=#insert-into-table-append-to class=md-nav__link> INSERT INTO TABLE 优于 APPEND TO </a> </li> <li class=md-nav__item> <a href=#line_exists-read-table-loop-at class=md-nav__link> LINE_EXISTS 优于 READ TABLE 或 LOOP AT </a> </li> <li class=md-nav__item> <a href=#read-table-loop-at class=md-nav__link> READ TABLE 优于 LOOP AT </a> </li> <li class=md-nav__item> <a href=#loop-at-where-if class=md-nav__link> LOOP AT WHERE 优于嵌套式 IF </a> </li> <li class=md-nav__item> <a href=#_36 class=md-nav__link> 避免不必要的表读取 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_37 class=md-nav__link> 字符串 </a> <nav class=md-nav aria-label=字符串> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_38 class=md-nav__link> 使用 ` 定义文字 </a> </li> <li class=md-nav__item> <a href=#_39 class=md-nav__link> 使用 | 汇集文本 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_40 class=md-nav__link> 布尔值 </a> <nav class=md-nav aria-label=布尔值> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_41 class=md-nav__link> 明智地使用布尔值 </a> </li> <li class=md-nav__item> <a href=#abap_bool class=md-nav__link> 用 ABAP_BOOL 表示布尔值 </a> </li> <li class=md-nav__item> <a href=#abap_true-abap_false class=md-nav__link> 使用 ABAP_TRUE 和 ABAP_FALSE 进行比较 </a> </li> <li class=md-nav__item> <a href=#xsdbool class=md-nav__link> 使用 XSDBOOL 设置布尔变量 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_42 class=md-nav__link> 条件 </a> <nav class=md-nav aria-label=条件> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_43 class=md-nav__link> 尽量使条件为正 </a> </li> <li class=md-nav__item> <a href=#is-not-not-is class=md-nav__link> IS NOT 优于 NOT IS </a> </li> <li class=md-nav__item> <a href=#_44 class=md-nav__link> 考虑分解复杂条件 </a> </li> <li class=md-nav__item> <a href=#_45 class=md-nav__link> 考虑提炼复杂条件 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#if class=md-nav__link> If 语句 </a> <nav class=md-nav aria-label="If 语句"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#if_1 class=md-nav__link> 无空的 IF 分支 </a> </li> <li class=md-nav__item> <a href=#case-else-if class=md-nav__link> 对于多个备选条件，CASE 优于 ELSE IF </a> </li> <li class=md-nav__item> <a href=#_46 class=md-nav__link> 保持低嵌套深度 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_47 class=md-nav__link> 正则表达式 </a> <nav class=md-nav aria-label=正则表达式> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_48 class=md-nav__link> 较简单的方法优于正则表达式 </a> </li> <li class=md-nav__item> <a href=#_49 class=md-nav__link> 基本检查优于正则表达式 </a> </li> <li class=md-nav__item> <a href=#_50 class=md-nav__link> 考虑汇集复杂的正则表达式 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_51 class=md-nav__link> 类 </a> <nav class=md-nav aria-label=类> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_52 class=md-nav__link> 类：面向对象 </a> <nav class=md-nav aria-label=类：面向对象> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_53 class=md-nav__link> 对象优于静态类 </a> </li> <li class=md-nav__item> <a href=#_54 class=md-nav__link> 组合优于继承 </a> </li> <li class=md-nav__item> <a href=#_55 class=md-nav__link> 勿在同一个类中混用有态和无态 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_56 class=md-nav__link> 作用域 </a> <nav class=md-nav aria-label=作用域> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_57 class=md-nav__link> 缺省情况下为全局，仅在适当位置为局部 </a> </li> <li class=md-nav__item> <a href=#final class=md-nav__link> 若非为继承而设计则为 FINAL </a> </li> <li class=md-nav__item> <a href=#private-protected class=md-nav__link> 缺省情况下为 PRIVATE，仅在需要时为 PROTECTED </a> </li> <li class=md-nav__item> <a href=#getter class=md-nav__link> 考虑使用不可变对象而非 getter </a> </li> <li class=md-nav__item> <a href=#read-only class=md-nav__link> 保守地使用 READ-ONLY </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_58 class=md-nav__link> 构造函数 </a> <nav class=md-nav aria-label=构造函数> <ul class=md-nav__list> <li class=md-nav__item> <a href=#new-create-object class=md-nav__link> NEW 优于 CREATE OBJECT </a> </li> <li class=md-nav__item> <a href=#create-private-constructor class=md-nav__link> 如果全局类为 CREATE PRIVATE，则保留 CONSTRUCTOR 为公有 </a> </li> <li class=md-nav__item> <a href=#_59 class=md-nav__link> 多个静态创建方法优于可选参数 </a> </li> <li class=md-nav__item> <a href=#_60 class=md-nav__link> 用描述性名称表示多个创建方法 </a> </li> <li class=md-nav__item> <a href=#_61 class=md-nav__link> 仅在多实例无意义的情况下变成单例 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_62 class=md-nav__link> 方法 </a> <nav class=md-nav aria-label=方法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_63 class=md-nav__link> 调用 </a> <nav class=md-nav aria-label=调用> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_64 class=md-nav__link> 函数式调用优于过程式调用 </a> </li> <li class=md-nav__item> <a href=#receiving class=md-nav__link> 省略 RECEIVING </a> </li> <li class=md-nav__item> <a href=#exporting class=md-nav__link> 省略可选关键字 EXPORTING </a> </li> <li class=md-nav__item> <a href=#_65 class=md-nav__link> 在单参数调用中省略参数名称 </a> </li> <li class=md-nav__item> <a href=#me class=md-nav__link> 在调用实例方法时省略自我引用 me </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_66 class=md-nav__link> 方法：面向对象 </a> <nav class=md-nav aria-label=方法：面向对象> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_67 class=md-nav__link> 实例优于静态方法 </a> </li> <li class=md-nav__item> <a href=#_68 class=md-nav__link> 公共实例方法应为接口的一部分 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_69 class=md-nav__link> 参数数目 </a> <nav class=md-nav aria-label=参数数目> <ul class=md-nav__list> <li class=md-nav__item> <a href=#importing class=md-nav__link> 力图减少 IMPORTING 参数，最好少于三个 </a> </li> <li class=md-nav__item> <a href=#optional class=md-nav__link> 拆分方法而非添加 OPTIONAL 参数 </a> </li> <li class=md-nav__item> <a href=#preferred-parameter class=md-nav__link> 保守地使用 PREFERRED PARAMETER </a> </li> <li class=md-nav__item> <a href=#returnexport-change class=md-nav__link> RETURN、EXPORT 或 CHANGE 恰有一个参数 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_70 class=md-nav__link> 参数类型 </a> <nav class=md-nav aria-label=参数类型> <ul class=md-nav__list> <li class=md-nav__item> <a href=#returning-exporting class=md-nav__link> RETURNING 优于 EXPORTING </a> </li> <li class=md-nav__item> <a href=#returning class=md-nav__link> RETURNING 大表通常没有问题 </a> </li> <li class=md-nav__item> <a href=#returning-exporting-changing class=md-nav__link> 单独使用 RETURNING 或 EXPORTING 或 CHANGING，而不要组合使用 </a> </li> <li class=md-nav__item> <a href=#changing class=md-nav__link> 在合适时保守地使用 CHANGING </a> </li> <li class=md-nav__item> <a href=#_71 class=md-nav__link> 拆分方法而非使用布尔输入参数 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_72 class=md-nav__link> 参数名称 </a> <nav class=md-nav aria-label=参数名称> <ul class=md-nav__list> <li class=md-nav__item> <a href=#returning-result class=md-nav__link> 考虑调用 RETURNING 参数 RESULT </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_73 class=md-nav__link> 参数初始化 </a> <nav class=md-nav aria-label=参数初始化> <ul class=md-nav__list> <li class=md-nav__item> <a href=#exporting_1 class=md-nav__link> 清除或覆盖 EXPORTING 引用参数 </a> <nav class=md-nav aria-label="清除或覆盖 EXPORTING 引用参数"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_74 class=md-nav__link> 如果输入和输出可能相同则要当心 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#value class=md-nav__link> 勿清除 VALUE 参数 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_75 class=md-nav__link> 方法体 </a> <nav class=md-nav aria-label=方法体> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_76 class=md-nav__link> 做且仅做一件事，把它做好 </a> </li> <li class=md-nav__item> <a href=#_77 class=md-nav__link> 关注愉快路径或错误处理，但非两者兼顾 </a> </li> <li class=md-nav__item> <a href=#_78 class=md-nav__link> 将抽象降一级 </a> </li> <li class=md-nav__item> <a href=#_79 class=md-nav__link> 保持方法精简 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_80 class=md-nav__link> 控制流 </a> <nav class=md-nav aria-label=控制流> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_81 class=md-nav__link> 快速失败 </a> </li> <li class=md-nav__item> <a href=#check-return class=md-nav__link> CHECK 对 RETURN </a> </li> <li class=md-nav__item> <a href=#check class=md-nav__link> 避免在其他位置使用 CHECK </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_82 class=md-nav__link> 错误处理 </a> <nav class=md-nav aria-label=错误处理> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_83 class=md-nav__link> 消息 </a> <nav class=md-nav aria-label=消息> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_84 class=md-nav__link> 使消息易于查找 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_85 class=md-nav__link> 返回代码 </a> <nav class=md-nav aria-label=返回代码> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_86 class=md-nav__link> 异常优于返回代码 </a> </li> <li class=md-nav__item> <a href=#_87 class=md-nav__link> 别让故障溜走 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_88 class=md-nav__link> 异常 </a> <nav class=md-nav aria-label=异常> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_89 class=md-nav__link> 异常针对的是错误，而不是正常情况 </a> </li> <li class=md-nav__item> <a href=#_90 class=md-nav__link> 使用基于类的异常 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_91 class=md-nav__link> 抛出 </a> <nav class=md-nav aria-label=抛出> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_92 class=md-nav__link> 使用各自的超类 </a> </li> <li class=md-nav__item> <a href=#_93 class=md-nav__link> 抛出一种类型的异常 </a> </li> <li class=md-nav__item> <a href=#_94 class=md-nav__link> 使用子类以便调用者能够区分错误情况 </a> </li> <li class=md-nav__item> <a href=#cx_static_check class=md-nav__link> 针对可应对的异常抛出 CX_STATIC_CHECK </a> </li> <li class=md-nav__item> <a href=#cx_no_check class=md-nav__link> 针对通常不可恢复的情况抛出 CX_NO_CHECK </a> </li> <li class=md-nav__item> <a href=#cx_dynamic_check class=md-nav__link> 针对可避免的异常考虑 CX_DYNAMIC_CHECK </a> </li> <li class=md-nav__item> <a href=#_95 class=md-nav__link> 针对完全不可恢复的情况进行转储 </a> </li> <li class=md-nav__item> <a href=#raise-exception-new-raise-exception-type class=md-nav__link> RAISE EXCEPTION NEW 优于 RAISE EXCEPTION TYPE </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_96 class=md-nav__link> 捕获 </a> <nav class=md-nav aria-label=捕获> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_97 class=md-nav__link> 包裹外来异常而非任其侵入代码 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_98 class=md-nav__link> 注释 </a> <nav class=md-nav aria-label=注释> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_99 class=md-nav__link> 用代码表达自己而不是靠注释 </a> </li> <li class=md-nav__item> <a href=#_100 class=md-nav__link> 注释绝非坏名称的借口 </a> </li> <li class=md-nav__item> <a href=#_101 class=md-nav__link> 使用方法而非注释来对代码分段 </a> </li> <li class=md-nav__item> <a href=#_102 class=md-nav__link> 写注释是要解释为什么而非是什么 </a> </li> <li class=md-nav__item> <a href=#_103 class=md-nav__link> 设计应放到设计文档里而不是代码里 </a> </li> <li class=md-nav__item> <a href=#_104 class=md-nav__link> 用 " 而非 * 加注释 </a> </li> <li class=md-nav__item> <a href=#_105 class=md-nav__link> 将注释放在与其相关的语句前面 </a> </li> <li class=md-nav__item> <a href=#_106 class=md-nav__link> 删除代码而非将其注释掉 </a> </li> <li class=md-nav__item> <a href=#fixmetodo-xxx class=md-nav__link> 使用 FIXME、TODO 和 XXX 并添加自己的标识 </a> </li> <li class=md-nav__item> <a href=#_107 class=md-nav__link> 勿添加方法签名和注释结尾 </a> </li> <li class=md-nav__item> <a href=#_108 class=md-nav__link> 勿复制消息文本作为注释 </a> </li> <li class=md-nav__item> <a href=#abap-api class=md-nav__link> ABAP 文档仅适用于公共 API </a> </li> <li class=md-nav__item> <a href=#_109 class=md-nav__link> 编译指示优于伪注释 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_110 class=md-nav__link> 格式化 </a> <nav class=md-nav aria-label=格式化> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_111 class=md-nav__link> 保持一致 </a> </li> <li class=md-nav__item> <a href=#_112 class=md-nav__link> 为阅读而不是书写进行优化 </a> </li> <li class=md-nav__item> <a href=#_113 class=md-nav__link> 激活前使用格式优化器 </a> </li> <li class=md-nav__item> <a href=#_114 class=md-nav__link> 使用格式优化器团队设置 </a> </li> <li class=md-nav__item> <a href=#_115 class=md-nav__link> 每行只有一条语句 </a> </li> <li class=md-nav__item> <a href=#_116 class=md-nav__link> 恪守合理的行长度 </a> </li> <li class=md-nav__item> <a href=#_117 class=md-nav__link> 紧缩代码 </a> </li> <li class=md-nav__item> <a href=#_118 class=md-nav__link> 添加单一空行来分隔内容，而不要添加多行 </a> </li> <li class=md-nav__item> <a href=#_119 class=md-nav__link> 勿因分隔空行产生困扰 </a> </li> <li class=md-nav__item> <a href=#_120 class=md-nav__link> 对齐同一对象而非不同对象的赋值 </a> </li> <li class=md-nav__item> <a href=#_121 class=md-nav__link> 在行尾关闭括号 </a> </li> <li class=md-nav__item> <a href=#_122 class=md-nav__link> 保持单参数调用于一行 </a> </li> <li class=md-nav__item> <a href=#_123 class=md-nav__link> 保持参数在调用后面 </a> </li> <li class=md-nav__item> <a href=#_124 class=md-nav__link> 如果换行，则在调用下缩进参数 </a> </li> <li class=md-nav__item> <a href=#_125 class=md-nav__link> 将多个参数换行 </a> </li> <li class=md-nav__item> <a href=#_126 class=md-nav__link> 对齐参数 </a> </li> <li class=md-nav__item> <a href=#_127 class=md-nav__link> 如果调用行过长则将其换行 </a> </li> <li class=md-nav__item> <a href=#_128 class=md-nav__link> 缩进并卡到制表位 </a> </li> <li class=md-nav__item> <a href=#_129 class=md-nav__link> 如同方法调用那样缩进内联声明 </a> </li> <li class=md-nav__item> <a href=#_130 class=md-nav__link> 勿对齐类型子句 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_131 class=md-nav__link> 测试 </a> <nav class=md-nav aria-label=测试> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_132 class=md-nav__link> 原则 </a> <nav class=md-nav aria-label=原则> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_133 class=md-nav__link> 编写可测试的代码 </a> </li> <li class=md-nav__item> <a href=#_134 class=md-nav__link> 让他人能够进行模拟 </a> </li> <li class=md-nav__item> <a href=#_135 class=md-nav__link> 可读性规则 </a> </li> <li class=md-nav__item> <a href=#_136 class=md-nav__link> 勿制作副本或写测试报告 </a> </li> <li class=md-nav__item> <a href=#_137 class=md-nav__link> 测试公共项而非私有内部项 </a> </li> <li class=md-nav__item> <a href=#_138 class=md-nav__link> 勿困扰于覆盖范围 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_139 class=md-nav__link> 测试类 </a> <nav class=md-nav aria-label=测试类> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_140 class=md-nav__link> 按用途调用局部测试类 </a> </li> <li class=md-nav__item> <a href=#_141 class=md-nav__link> 将测试放在局部类 </a> </li> <li class=md-nav__item> <a href=#_142 class=md-nav__link> 将帮助方法放在帮助类 </a> </li> <li class=md-nav__item> <a href=#_143 class=md-nav__link> 如何执行测试类 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_144 class=md-nav__link> 被测代码 </a> <nav class=md-nav aria-label=被测代码> <ul class=md-nav__list> <li class=md-nav__item> <a href=#cut class=md-nav__link> 赋予被测代码有意义的名称，或使用缺省名称 CUT </a> </li> <li class=md-nav__item> <a href=#_145 class=md-nav__link> 测试接口而非类 </a> </li> <li class=md-nav__item> <a href=#_146 class=md-nav__link> 将被测代码的调用提取到自身的方法 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_147 class=md-nav__link> 注入 </a> <nav class=md-nav aria-label=注入> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_148 class=md-nav__link> 使用依赖倒置注入测试替身 </a> </li> <li class=md-nav__item> <a href=#abap_1 class=md-nav__link> 考虑使用 ABAP 测试替身工具 </a> </li> <li class=md-nav__item> <a href=#_149 class=md-nav__link> 利用测试工具 </a> </li> <li class=md-nav__item> <a href=#_150 class=md-nav__link> 使用测试缝隙作为临时解决办法 </a> </li> <li class=md-nav__item> <a href=#local-friends class=md-nav__link> 使用 LOCAL FRIENDS 访问依赖倒置的构造函数 </a> </li> <li class=md-nav__item> <a href=#local-friends_1 class=md-nav__link> 勿滥用 LOCAL FRIENDS 侵入被测代码 </a> </li> <li class=md-nav__item> <a href=#_151 class=md-nav__link> 勿更改生产代码来使代码可测试 </a> </li> <li class=md-nav__item> <a href=#_152 class=md-nav__link> 勿子类化来模拟方法 </a> </li> <li class=md-nav__item> <a href=#_153 class=md-nav__link> 勿模拟不需要的东西 </a> </li> <li class=md-nav__item> <a href=#_154 class=md-nav__link> 勿构建测试框架 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_155 class=md-nav__link> 测试方法 </a> <nav class=md-nav aria-label=测试方法> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_156 class=md-nav__link> 测试方法名称：反映出设想和预期的情形 </a> </li> <li class=md-nav__item> <a href=#given-when-then class=md-nav__link> 使用 given-when-then </a> </li> <li class=md-nav__item> <a href=#when class=md-nav__link> "When" 恰为一个调用 </a> </li> <li class=md-nav__item> <a href=#teardown class=md-nav__link> 除非真正需要否则勿添加 TEARDOWN </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_157 class=md-nav__link> 测试数据 </a> <nav class=md-nav aria-label=测试数据> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_158 class=md-nav__link> 使其易于辨明含义 </a> </li> <li class=md-nav__item> <a href=#_159 class=md-nav__link> 使其易于辨明差异 </a> </li> <li class=md-nav__item> <a href=#_160 class=md-nav__link> 使用常量描述测试数据的用途和重要性 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#_161 class=md-nav__link> 断言 </a> <nav class=md-nav aria-label=断言> <ul class=md-nav__list> <li class=md-nav__item> <a href=#_162 class=md-nav__link> 少而精的断言 </a> </li> <li class=md-nav__item> <a href=#_163 class=md-nav__link> 使用恰当的断言类型 </a> </li> <li class=md-nav__item> <a href=#_164 class=md-nav__link> 断言内容而非数量 </a> </li> <li class=md-nav__item> <a href=#_165 class=md-nav__link> 断言质量而非内容 </a> </li> <li class=md-nav__item> <a href=#fail class=md-nav__link> 使用 FAIL 检查是否出现预期异常 </a> </li> <li class=md-nav__item> <a href=#_166 class=md-nav__link> 转发意外异常而非捕获就失败 </a> </li> <li class=md-nav__item> <a href=#_167 class=md-nav__link> 编写自定义断言以缩短代码和避免重复 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/HackettYu/mkdocs-material/blob/master/docs/archives/ABAP-guide-zh.md title=编辑此页 class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <blockquote> <p>VIA: <a href=https://github.com/SAP/styleguides/blob/master/clean-abap/CleanABAP_zh>github.com/SAP/styleguides/blob/master/clean-abap/CleanABAP_zh</a> Translated from <a href=https://github.com/SAP/styleguides/tree/72ecf7fd7d41151d5bbca29020d4ec9de953db8c>English original on 14.11.2019</a>. Latest version <a href=CleanABAP>in English</a>.</p> </blockquote> <h1 id=abap>ABAP 整洁之道<a class=headerlink href=#abap title="Permanent link">&para;</a></h1> <blockquote> <p><a href=CleanABAP_zh><strong>中文</strong></a> &nbsp;·&nbsp; <a href=CleanABAP>English</a> &nbsp;·&nbsp; <a href=CleanABAP_fr>Français</a> &nbsp;·&nbsp; <a href=CleanABAP_de>Deutsch</a></p> </blockquote> <p>本指南针对 <a href=https://zh.wikipedia.org/wiki/ABAP>ABAP</a> 改编自 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a>。</p> <p><a href=cheat-sheet/CheatSheet>速查表</a>为打印优化版本。</p> <h2 id=_1>目录<a class=headerlink href=#_1 title="Permanent link">&para;</a></h2> <ul> <li><a href=#how-to>做法</a></li> <li><a href=#how-to-get-started-with-clean-code>整洁代码入门之法</a></li> <li><a href=#how-to-refactor-legacy-code>旧代码重构之法</a></li> <li><a href=#how-to-check-automatically>自动检查之法</a></li> <li><a href=#how-to-relate-to-other-guides>与其他指南互通之法</a></li> <li><a href=#how-to-disagree>表示异议之法</a></li> <li><a href=#names>名称</a></li> <li><a href=#use-descriptive-names>使用描述性名称</a></li> <li><a href=#prefer-solution-domain-and-problem-domain-terms>首选解决方案域和问题域术语</a></li> <li><a href=#use-plural>使用复数形式</a></li> <li><a href=#use-pronounceable-names>使用能读出来的名称</a></li> <li><a href=#avoid-abbreviations>避免缩写</a></li> <li><a href=#use-same-abbreviations-everywhere>在各处使用相同缩写</a></li> <li><a href=#use-nouns-for-classes-and-verbs-for-methods>用名词表示类而用动词表示方法</a></li> <li><a href=#avoid-noise-words-such-as-data-info-object>避免干扰词，如 "data"、"info"、"object"</a></li> <li><a href=#pick-one-word-per-concept>每个概念选取一个词</a></li> <li><a href=#use-pattern-names-only-if-you-mean-them>仅在本意如此时使用模式名称</a></li> <li><a href=#avoid-encodings-esp-hungarian-notation-and-prefixes>避免编码，特别是匈牙利表示法和前缀</a></li> <li><a href=#language>语言</a></li> <li><a href=#mind-the-legacy>顾及传统</a></li> <li><a href=#mind-the-performance>顾及性能</a></li> <li><a href=#prefer-object-orientation-to-procedural-programming>面向对象编程优于过程式编程</a></li> <li><a href=#prefer-functional-to-procedural-language-constructs>函数式语言结构优于过程式语言结构</a></li> <li><a href=#avoid-obsolete-language-elements>避免过时语言元素</a></li> <li><a href=#use-design-patterns-wisely>明智地使用设计模式</a></li> <li><a href=#constants>常量</a></li> <li><a href=#use-constants-instead-of-magic-numbers>使用常量而非幻数</a></li> <li><a href=#prefer-enumeration-classes-to-constants-interfaces>枚举类优于常量接口</a></li> <li><a href=#if-you-dont-use-enumeration-classes-group-your-constants>如果不使用枚举类，则对常量进行分组</a></li> <li><a href=#variables>变量</a></li> <li><a href=#prefer-inline-to-up-front-declarations>内联声明优于最前声明</a></li> <li><a href=#dont-declare-inline-in-optional-branches>勿在可选分支中内联声明</a></li> <li><a href=#do-not-chain-up-front-declarations>勿用链式最前声明</a></li> <li><a href=#prefer-ref-to-to-field-symbol>REF TO 优于 FIELD-SYMBOL</a></li> <li><a href=#tables>表</a></li> <li><a href=#use-the-right-table-type>使用恰当的表类型</a></li> <li><a href=#avoid-default-key>避免 DEFAULT KEY</a></li> <li><a href=#prefer-insert-into-table-to-append-to>INSERT INTO TABLE 优于 APPEND TO</a></li> <li><a href=#prefer-line_exists-to-read-table-or-loop-at>LINE_EXISTS 优于 READ TABLE 或 LOOP AT</a></li> <li><a href=#prefer-read-table-to-loop-at>READ TABLE 优于 LOOP AT</a></li> <li><a href=#prefer-loop-at-where-to-nested-if>LOOP AT WHERE 优于嵌套式 IF</a></li> <li><a href=#avoid-unnecessary-table-reads>避免不必要的表读取</a></li> <li><a href=#strings>字符串</a></li> <li><a href=#use--to-define-literals>使用 ` 定义文字</a></li> <li><a href=#use--to-assemble-text>使用 | 汇集文本</a></li> <li><a href=#booleans>布尔值</a></li> <li><a href=#use-booleans-wisely>明智地使用布尔值</a></li> <li><a href=#use-abap_bool-for-booleans>用 ABAP_BOOL 表示布尔值</a></li> <li><a href=#use-abap_true-and-abap_false-for-comparisons>使用 ABAP_TRUE 和 ABAP_FALSE 进行比较</a></li> <li><a href=#use-xsdbool-to-set-boolean-variables>使用 XSDBOOL 设置布尔变量</a></li> <li><a href=#conditions>条件</a></li> <li><a href=#try-to-make-conditions-positive>尽量使条件为正</a></li> <li><a href=#prefer-is-not-to-not-is>IS NOT 优于 NOT IS</a></li> <li><a href=#consider-decomposing-complex-conditions>考虑分解复杂条件</a></li> <li><a href=#consider-extracting-complex-conditions>考虑提炼复杂条件</a></li> <li><a href=#ifs>If 语句</a></li> <li><a href=#no-empty-if-branches>无空的 IF 分支</a></li> <li><a href=#prefer-case-to-else-if-for-multiple-alternative-conditions>对于多个备选条件，CASE 优于 ELSE IF</a></li> <li><a href=#keep-the-nesting-depth-low>保持低嵌套深度</a></li> <li><a href=#regular-expressions>正则表达式</a></li> <li><a href=#prefer-simpler-methods-to-regular-expressions>较简单的方法优于正则表达式</a></li> <li><a href=#prefer-basis-checks-to-regular-expressions>基本检查优于正则表达式</a></li> <li><a href=#consider-assembling-complex-regular-expressions>考虑汇集复杂的正则表达式</a></li> <li><a href=#classes>类</a></li> <li><a href=#classes-object-orientation>类：面向对象</a><ul> <li><a href=#prefer-objects-to-static-classes>对象优于静态类</a></li> <li><a href=#prefer-composition-to-inheritance>组合优于继承</a></li> <li><a href=#dont-mix-stateful-and-stateless-in-the-same-class>勿在同一个类中混用有态和无态</a></li> </ul> </li> <li><a href=#scope>作用域</a><ul> <li><a href=#global-by-default-local-only-where-appropriate>缺省情况下为全局，仅在适当位置为局部</a></li> <li><a href=#final-if-not-designed-for-inheritance>若非为继承而设计则为 FINAL</a></li> <li><a href=#members-private-by-default-protected-only-if-needed>缺省情况下为 PRIVATE，仅在需要时为 PROTECTED</a></li> <li><a href=#consider-using-immutable-instead-of-getter>考虑使用不可变对象而非 getter</a></li> <li><a href=#use-read-only-sparingly>保守地使用 READ-ONLY</a></li> </ul> </li> <li><a href=#constructors>构造函数</a><ul> <li><a href=#prefer-new-to-create-object>NEW 优于 CREATE OBJECT</a></li> <li><a href=#if-your-global-class-is-create-private-leave-the-constructor-public>如果全局类为 CREATE PRIVATE，则保留 CONSTRUCTOR 为公共</a></li> <li><a href=#prefer-multiple-static-creation-methods-to-optional-parameters>多个静态创建方法优于可选参数</a></li> <li><a href=#use-descriptive-names-for-multiple-creation-methods>用描述性名称表示多个创建方法</a></li> <li><a href=#make-singletons-only-where-multiple-instances-dont-make-sense>仅在多实例无意义的情况下变成单例</a></li> </ul> </li> <li><a href=#methods>方法</a></li> <li><a href=#calls>调用</a><ul> <li><a href=#prefer-functional-to-procedural-calls>函数式调用优于过程式调用</a></li> <li><a href=#omit-receiving>省略 RECEIVING</a></li> <li><a href=#omit-the-optional-keyword-exporting>省略可选关键字 EXPORTING</a></li> <li><a href=#omit-the-parameter-name-in-single-parameter-calls>在单参数调用中省略参数名称</a></li> <li><a href=#omit-the-self-reference-me-when-calling-an-instance-method>在调用实例方法时省略自我引用 me</a></li> </ul> </li> <li><a href=#methods-object-orientation>方法：面向对象</a><ul> <li><a href=#prefer-instance-to-static-methods>实例优于静态方法</a></li> <li><a href=#public-instance-methods-should-be-part-of-an-interface>公共实例方法应为接口的一部分</a></li> </ul> </li> <li><a href=#parameter-number>参数数目</a><ul> <li><a href=#aim-for-few-importing-parameters-at-best-less-than-three>力图减少 IMPORTING 参数，最好少于三个</a></li> <li><a href=#split-methods-instead-of-adding-optional-parameters>拆分方法而非添加 OPTIONAL 参数</a></li> <li><a href=#use-preferred-parameter-sparingly>保守地使用 PREFERRED PARAMETER</a></li> <li><a href=#return-export-or-change-exactly-one-parameter>RETURN、EXPORT 或 CHANGE 恰有一个参数</a></li> </ul> </li> <li><a href=#parameter-types>参数类型</a><ul> <li><a href=#prefer-returning-to-exporting>RETURNING 优于 EXPORTING</a></li> <li><a href=#returning-large-tables-is-usually-okay>RETURNING 大表通常没有问题</a></li> <li><a href=#use-either-returning-or-exporting-or-changing-but-not-a-combination>单独使用 RETURNING 或 EXPORTING 或 CHANGING，而不要组合使用</a></li> <li><a href=#use-changing-sparingly-where-suited>在合适时保守地使用 CHANGING</a></li> <li><a href=#split-method-instead-of-boolean-input-parameter>拆分方法而非使用布尔输入参数</a></li> </ul> </li> <li><a href=#parameter-names>参数名称</a><ul> <li><a href=#consider-calling-the-returning-parameter-result>考虑调用 RETURNING 参数 RESULT</a></li> </ul> </li> <li><a href=#parameter-initialization>参数初始化</a><ul> <li><a href=#clear-or-overwrite-exporting-reference-parameters>清除或覆盖 EXPORTING 引用参数</a><ul> <li><a href=#take-care-if-input-and-output-could-be-the-same>如果输入和输出可能相同则要当心</a></li> </ul> </li> <li><a href=#dont-clear-value-parameters>勿清除 VALUE 参数</a></li> </ul> </li> <li><a href=#method-body>方法体</a><ul> <li><a href=#do-one-thing-do-it-well-do-it-only>做且仅做一件事，把它做好</a></li> <li><a href=#focus-on-the-happy-path-or-error-handling-but-not-both>关注愉快路径或错误处理，但非两者兼顾</a></li> <li><a href=#descend-one-level-of-abstraction>将抽象降一级</a></li> <li><a href=#keep-methods-small>保持方法精简</a></li> </ul> </li> <li><a href=#control-flow>控制流</a><ul> <li><a href=#fail-fast>快速失败</a></li> <li><a href=#check-vs-return>CHECK 对 RETURN</a></li> <li><a href=#avoid-check-in-other-positions>避免在其他位置使用 CHECK</a></li> </ul> </li> <li><a href=#error-handling>错误处理</a></li> <li><a href=#messages>消息</a><ul> <li><a href=#make-messages-easy-to-find>使消息易于查找</a></li> </ul> </li> <li><a href=#return-codes>返回代码</a><ul> <li><a href=#prefer-exceptions-to-return-codes>异常优于返回代码</a></li> <li><a href=#dont-let-failures-slip-through>别让故障溜走</a></li> </ul> </li> <li><a href=#exceptions>异常</a><ul> <li><a href=#exceptions-are-for-errors-not-for-regular-cases>异常针对的是错误，而不是正常情况</a></li> <li><a href=#use-class-based-exceptions>使用基于类的异常</a></li> </ul> </li> <li><a href=#throwing>抛出</a><ul> <li><a href=#use-own-super-classes>使用各自的超类</a></li> <li><a href=#throw-one-type-of-exception>抛出一种类型的异常</a></li> <li><a href=#use-sub-classes-to-enable-callers-to-distinguish-error-situations>使用子类以便调用者能够区分错误情况</a></li> <li><a href=#throw-cx_static_check-for-manageable-exceptions>针对可应对的异常抛出 CX_STATIC_CHECK</a></li> <li><a href=#throw-cx_no_check-for-usually-unrecoverable-situations>针对通常不可恢复的情况抛出 CX_NO_CHECK</a></li> <li><a href=#consider-cx_dynamic_check-for-avoidable-exceptions>针对可避免的异常考虑 CX_DYNAMIC_CHECK</a></li> <li><a href=#dump-for-totally-unrecoverable-situations>针对完全不可恢复的情况进行转储</a></li> <li><a href=#prefer-raise-exception-new-to-raise-exception-type>RAISE EXCEPTION NEW 优于 RAISE EXCEPTION TYPE</a></li> </ul> </li> <li><a href=#catching>捕获</a><ul> <li><a href=#wrap-foreign-exceptions-instead-of-letting-them-invade-your-code>包裹外来异常而非任其侵入代码</a></li> </ul> </li> <li><a href=#comments>注释</a></li> <li><a href=#express-yourself-in-code-not-in-comments>用代码表达自己而不是靠注释</a></li> <li><a href=#comments-are-no-excuse-for-bad-names>注释绝非坏名称的借口</a></li> <li><a href=#use-methods-instead-of-comments-to-segment-your-code>使用方法而非注释来对代码分段</a></li> <li><a href=#write-comments-to-explain-the-why-not-the-what>写注释是要解释为什么而非是什么</a></li> <li><a href=#design-goes-into-the-design-documents-not-the-code>设计应放到设计文档里而不是代码里</a></li> <li><a href=#comment-with--not-with->用 " 而非 * 加注释</a></li> <li><a href=#put-comments-before-the-statement-they-relate-to>将注释放在与其相关的语句前面</a></li> <li><a href=#delete-code-instead-of-commenting-it>删除代码而非将其注释掉</a></li> <li><a href=#use-fixme-todo-and-xxx-and-add-your-id>使用 FIXME、TODO 和 XXX 并添加自己的标识</a></li> <li><a href=#dont-add-method-signature-and-end-of-comments>勿添加方法签名和注释结尾</a></li> <li><a href=#dont-duplicate-message-texts-as-comments>勿复制消息文本作为注释</a></li> <li><a href=#abap-doc-only-for-public-apis>ABAP 文档仅适用于公共 API</a></li> <li><a href=#prefer-pragmas-to-pseudo-comments>编译指示优于伪注释</a></li> <li><a href=#formatting>格式化</a></li> <li><a href=#be-consistent>保持一致</a></li> <li><a href=#optimize-for-reading-not-for-writing>为阅读而不是书写进行优化</a></li> <li><a href=#use-the-pretty-printer-before-activating>激活前使用格式优化器</a></li> <li><a href=#use-your-pretty-printer-team-settings>使用格式优化器团队设置</a></li> <li><a href=#no-more-than-one-statement-per-line>每行只有一条语句</a></li> <li><a href=#stick-to-a-reasonable-line-length>恪守合理的行长度</a></li> <li><a href=#condense-your-code>紧缩代码</a></li> <li><a href=#add-a-single-blank-line-to-separate-things-but-not-more>添加单一空行来分隔内容，而不要添加多行</a></li> <li><a href=#dont-obsess-with-separating-blank-lines>勿因分隔空行产生困扰</a></li> <li><a href=#align-assignments-to-the-same-object-but-not-to-different-ones>对齐同一对象而非不同对象的赋值</a></li> <li><a href=#close-brackets-at-line-end>在行尾关闭括号</a></li> <li><a href=#keep-single-parameter-calls-on-one-line>保持单参数调用于一行</a></li> <li><a href=#keep-parameters-behind-the-call>保持参数在调用后面</a></li> <li><a href=#if-you-break-indent-parameters-under-the-call>如果换行，则在调用下缩进参数</a></li> <li><a href=#line-break-multiple-parameters>将多个参数换行</a></li> <li><a href=#align-parameters>对齐参数</a></li> <li><a href=#break-the-call-to-a-new-line-if-the-line-gets-too-long>如果调用行过长则将其换行</a></li> <li><a href=#indent-and-snap-to-tab>缩进并卡到制表位</a></li> <li><a href=#indent-in-line-declarations-like-method-calls>如同方法调用那样缩进内联声明</a></li> <li><a href=#dont-align-type-clauses>勿对齐类型子句</a></li> <li><a href=#testing>测试</a></li> <li><a href=#principles>原则</a><ul> <li><a href=#write-testable-code>编写可测试的代码</a></li> <li><a href=#enable-others-to-mock-you>让他人能够进行模拟</a></li> <li><a href=#readability-rules>可读性规则</a></li> <li><a href=#dont-make-copies-or-write-test-reports>勿制作副本或写测试报告</a></li> <li><a href=#test-publics-not-private-internals>测试公共项而非私有内部项</a></li> <li><a href=#dont-obsess-about-coverage>勿困扰于覆盖范围</a></li> </ul> </li> <li><a href=#test-classes>测试类</a><ul> <li><a href=#call-local-test-classes-by-their-purpose>按用途调用局部测试类</a></li> <li><a href=#put-tests-in-local-classes>将测试放在局部类</a></li> <li><a href=#put-help-methods-in-help-classes>将帮助方法放在帮助类</a></li> <li><a href=#how-to-execute-test-classes>如何执行测试类</a></li> </ul> </li> <li><a href=#code-under-test>被测代码</a><ul> <li><a href=#name-the-code-under-test-meaningfully-or-default-to-cut>赋予被测代码有意义的名称，或使用缺省名称 CUT</a></li> <li><a href=#test-interfaces-not-classes>测试接口而非类</a></li> <li><a href=#extract-the-call-to-the-code-under-test-to-its-own-method>将被测代码的调用提取到自身的方法</a></li> </ul> </li> <li><a href=#injection>注入</a><ul> <li><a href=#use-dependency-inversion-to-inject-test-doubles>使用依赖倒置注入测试替身</a></li> <li><a href=#consider-to-use-the-tool-abap-test-double>考虑使用 ABAP 测试替身工具</a></li> <li><a href=#exploit-the-test-tools>利用测试工具</a></li> <li><a href=#use-test-seams-as-temporary-workaround>使用测试缝隙作为临时解决办法</a></li> <li><a href=#use-local-friends-to-access-the-dependency-inverting-constructor>使用 LOCAL FRIENDS 访问依赖倒置的构造函数</a></li> <li><a href=#dont-misuse-local-friends-to-invade-the-tested-code>勿滥用 LOCAL FRIENDS 侵入被测代码</a></li> <li><a href=#dont-change-the-productive-code-to-make-the-code-testable>勿更改生产代码来使代码可测试</a></li> <li><a href=#dont-sub-class-to-mock-methods>勿子类化来模拟方法</a></li> <li><a href=#dont-mock-stuff-thats-not-needed>勿模拟不需要的东西</a></li> <li><a href=#dont-build-test-frameworks>勿构建测试框架</a></li> </ul> </li> <li><a href=#test-methods>测试方法</a><ul> <li><a href=#test-method-names-reflect-whats-given-and-expected>测试方法名称：反映出设想和预期的情形</a></li> <li><a href=#use-given-when-then>使用 given-when-then</a></li> <li><a href=#when-is-exactly-one-call>"When" 恰为一个调用</a></li> <li><a href=#dont-add-a-teardown-unless-you-really-need-it>除非真正需要否则勿添加 TEARDOWN</a></li> </ul> </li> <li><a href=#test-data>测试数据</a><ul> <li><a href=#make-it-easy-to-spot-meaning>使其易于辨明含义</a></li> <li><a href=#make-it-easy-to-spot-differences>使其易于辨明差异</a></li> <li><a href=#use-constants-to-describe-purpose-and-importance-of-test-data>使用常量描述测试数据的用途和重要性</a></li> </ul> </li> <li><a href=#assertions>断言</a><ul> <li><a href=#few-focused-assertions>少而精的断言</a></li> <li><a href=#use-the-right-assert-type>使用恰当的断言类型</a></li> <li><a href=#assert-content-not-quantity>断言内容而非数量</a></li> <li><a href=#assert-quality-not-content>断言质量而非内容</a></li> <li><a href=#use-fail-to-check-for-expected-exceptions>使用 FAIL 检查是否出现预期异常</a></li> <li><a href=#forward-unexpected-exceptions-instead-of-catching-and-failing>转发意外异常而非捕获就失败</a></li> <li><a href=#write-custom-asserts-to-shorten-code-and-avoid-duplication>编写自定义断言以缩短代码和避免重复</a></li> </ul> </li> </ul> <h2 id=_2>做法<a class=headerlink href=#_2 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#how-to>本节</a></p> </blockquote> <h3 id=_3>整洁代码入门之法<a class=headerlink href=#_3 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#how-to>做法</a> &gt; <a href=#how-to-get-started-with-clean-code>本节</a></p> </blockquote> <p>如果您初识整洁代码，应首先阅读 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a>。借助 <a href=https://clean-code-developer.com/ >Clean Code Developer initiative</a>，您可以从头学起，循序渐进地对该主题有一般性的了解。</p> <p>建议从容易理解且广为接受的方面入手，如<a href=#booleans>布尔值</a>、<a href=#conditions>条件</a>和 <a href=#ifs>If 语句</a>。</p> <p>您可能将会从<a href=#methods>方法</a>一节获得最大受益，特别是<a href=#do-one-thing-do-it-well-do-it-only>做且仅做一件事，把它做好</a>和<a href=#keep-methods-small>方法精简</a>，因为这些会极大地改善代码的总体结构。</p> <p>对于有行事经验但初识整洁代码的团队，本文的某些主题可能会引起团队内激烈的讨论；这些主题绝对“有益健康”，但人们可能刚开始不太适应。</p> <p>后面会再继续探讨这些颇具争议的主题，特别是<a href=#comments>注释</a>、<a href=#names>名称</a>和<a href=#formatting>格式化</a>，它们可能会引起孜孜不倦的争论，只有认识到整洁代码积极效应的团队才知道它的好处。</p> <h3 id=_4>旧代码重构之法<a class=headerlink href=#_4 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#how-to>做法</a> &gt; <a href=#how-to-refactor-legacy-code>本节</a></p> </blockquote> <p>如果正在遗留项目上工作，其中含有大量无法或不想更改的代码，因为它们可以无冲突地运行在新代码环境，这种情况下， 更改<a href=#booleans>布尔值</a>、<a href=#conditions>条件</a>、<a href=#ifs>If 语句</a>和<a href=#methods>方法</a>方面的主题最有价值。</p> <p>对于遗留项目而言， <a href=#names>名称</a> 主题改进太费劲了，它可能会在新旧代码之间产生差异，在某种程度上，其中的诸如<a href=#avoid-encodings-esp-hungarian-notation-and-prefixes>避免编码，特别是匈牙利表示法和前缀</a>等节忽略为宜。</p> <p>我们发现采用四步计划进行重构，结果比较好：</p> <ol> <li> <p>先让团队上道。沟通并解释新的风格，使项目团队的每个人对此达成一致意见。不用一下子就推行所有指导原则，只需从小部分没有争议的子集入手，然后由此拓展。</p> </li> <li> <p>按照_童子军规则_开展每日的例行工作：<em>每次修改代码都比原先更整洁</em>。不要因此而困扰，好几个小时沉湎于“清理整个营地”，只需花几分钟，思考如何持续不断地改进。</p> </li> <li> <p>构筑_整洁小岛_：时不时挑选小的对象或组件，试着进行全方位的清洁。这些小岛印证了现在所做事情的好处，为进一步重构形成了经得起考验的坚强堡垒。</p> </li> <li> <p>谈经论道。不管是设立老派的<a href=https://en.wikipedia.org/wiki/Fagan_inspection>范根代码评审</a>，还是举办宣讲会，抑或是在自己喜爱的聊天工具中组建讨论板：需要讲出自己的经验和体会，以使团队逐渐达成共识。</p> </li> </ol> <h3 id=_5>自动检查之法<a class=headerlink href=#_5 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#how-to>做法</a> &gt; <a href=#how-to-check-automatically>本节</a></p> </blockquote> <p>没有一整套全面的静态代码检查方法可以自动检测本文所述的我们这里所描述的反面模式。</p> <p>ABAP 测试主控室、代码分析器、扩展检查和检查管理器提供了一些检查方法，这些方法可能有助于发现某些问题。</p> <p><a href=https://github.com/larshp/abapOpenChecks>abapOpenChecks</a> 是一个开源的代码分析器检查集，也涵盖了所述的某些反面模式。</p> <p><a href=https://github.com/abaplint/abaplint>abaplint</a> 是 一个ABAP 解析器的开源的实现重写。它不需要SAP系统就可以运行，旨在用 abapGit 使代码串行化。它提供了多个集成（GitHub Actions、Jenkins、文本编辑器...），涵盖了某些反面模式，也可用来检查格式化和代码规范。</p> <h3 id=_6>与其他指南互通之法<a class=headerlink href=#_6 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#how-to>做法</a> &gt; <a href=#how-to-relate-to-other-guides>本节</a></p> </blockquote> <p>本指南秉承整洁代码的_精神_，这意味着我们对 ABAP 编程语言进行了一些调整，例如，<a href=#throw-cx_static_check-for-manageable-exceptions>针对可管理的异常抛出 CX_STATIC_CHECK</a>。</p> <p>某些论据来自 <a href="https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/index.htm?file=abenabap_pgl.htm">ABAP Programming Guidelines</a> 与本指南大多是兼容的；背离之处予以指明，务求符合整洁代码的精神。</p> <p>本指南也遵循 <a href=https://www.dsag.de/sites/default/files/dsag_recommendation_abap_development.pdf>DSAG's Recommendations for ABAP Development</a>，不过我们在大多数细节上更加精确。</p> <h3 id=_7>表示异议之法<a class=headerlink href=#_7 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#how-to>做法</a> &gt; <a href=#how-to-disagree>本节</a></p> </blockquote> <p>编写本风格指南的目标读者已通晓整洁代码或目前正致力于此，且对如何将整洁代码_具体应用于 ABAP_ 极为关注。</p> <p>因此，请注意，我们没有以原书同样的篇幅和深度介绍所有概念及相关资源：那些内容仍值得一读，特别是，如果您只是因为我们没解释太详细而不同意本文的观点。可使用各节中的链接延伸阅读我们给出指导的背景。</p> <p>您尽可以讨论文本讲述的任何内容并表示异议。整洁代码的支柱之一是_团队规则_。在您放弃异议之前，一定要给它们一个公平的机会。</p> <p><a href=../CONTRIBUTING>CONTRIBUTING</a> 就如何变通本指南或在小的细节上另辟蹊径，给出了建议。</p> <h2 id=_8>名称<a class=headerlink href=#_8 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>本节</a></p> </blockquote> <h3 id=_9>使用描述性名称<a class=headerlink href=#_9 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#use-descriptive-names>本节</a></p> </blockquote> <p>使用可以传达事物内容和含义的名称。</p> <div class=highlight><pre><span></span><code><span class=k>CONSTANTS</span> <span class=nv>max_wait_time_in_seconds</span> <span class=k>TYPE </span><span class=nv>i</span> <span class=p>...</span>
<span class=k>DATA</span> <span class=nv>customizing_entries</span> <span class=k>TYPE </span><span class=nv>STANDARD</span> <span class=k>TABLE</span> <span class=p>...</span>
<span class=k>METHODS</span> <span class=nv>read_user_preferences</span> <span class=p>...</span>
<span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>user_preference_reader</span> <span class=p>...</span>
</code></pre></div> <p>不要只把注意力放在数据类型和技术编码上。它们对理解代码几乎没什么贡献。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>CONSTANTS</span> <span class=nv>sysubrc_04</span> <span class=k>TYPE </span><span class=nv>sysubrc</span> <span class=p>...</span>
<span class=k>DATA</span> <span class=nv>iso3166tab</span> <span class=k>TYPE </span><span class=nv>STANDARD</span> <span class=k>TABLE</span> <span class=p>...</span>
<span class=k>METHODS</span> <span class=nv>read_t005</span> <span class=p>...</span>
<span class=k>CLASS</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>t005_reader</span> <span class=p>...</span>
</code></pre></div> <p><a href=#comments-are-no-excuse-for-bad-names>不要试图通过注释来弥补坏的名称。</a></p> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Use Intention-Revealing Names</em>。</p> </blockquote> <h3 id=_10>首选解决方案域和问题域术语<a class=headerlink href=#_10 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#prefer-solution-domain-and-problem-domain-terms>本节</a></p> </blockquote> <p>在解决方案域（即计算机科学术语，如 "queue" 或 "tree"）和问题域（即业务领域术语，如 "account" 或 "ledger"）中搜索好的名称。</p> <p>按问题域命名时，业务层的命名最好听。对于采用域驱动设计而设计的组件（如 API 和业务对象）尤为如此。</p> <p>按解决方案域命名时，提供大多数技术功能（如工厂类和抽象算法）层的命名最好听。</p> <p>在任何情况下都不要试图加进自己的语言。需能够在开发人员、产品负责人、合作伙伴和客户之间交换信息，因此要选择所有人不用查定制词典就能理解的名称。</p> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Use Solution Domain Names</em> and <em>[...]: &gt; Use Problem Domain Names</em>。</p> </blockquote> <h3 id=_11>使用复数形式<a class=headerlink href=#_11 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#use-plural>本节</a></p> </blockquote> <p>在 SAP 有一种传统习惯，那就是用单数形式命名事物的表，例如，<code>country</code> 表示“国家表”。外界普遍倾向于使用复数形式表示事物的列表。因此，建议最好改用 <code>countries</code>。</p> <blockquote> <p>这条建议主要针对诸如变量和属性等事物。&gt; 对于开发对象，可能存在同样&gt; 也有意义的模式，例如，有一种广泛使用的规范，&gt; 以单数形式命名数据库表（“透明表”）。</p> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Use Intention-Revealing Names</em>。</p> </blockquote> <h3 id=_12>使用能读出来的名称<a class=headerlink href=#_12 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#use-pronounceable-names>本节</a></p> </blockquote> <p>关于对象会有很多思考和讨论，因此要使用能读出来的名称，例如，<code>detection_object_types</code> 优于诸如 <code>dobjt</code> 这种晦涩的名称。</p> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Use Pronounceable Names</em>。</p> </blockquote> <h3 id=_13>避免缩写<a class=headerlink href=#_13 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#avoid-abbreviations>本节</a></p> </blockquote> <p>如果有足够空间，那就完整地写出名称。仅当超过长度限制时才使用缩写。</p> <p>如果不得不缩写，首先考虑_不重要_的词。</p> <p>采用缩写，可能第一眼看起来很高效，但很快就会变得含糊不清。例如，<code>cust</code> 中的 "cust" 究竟是指 "customizing"、"customer" 还是 "custom"？三者在 SAP 应用程序中都很常见。</p> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Make Meaningful Distinctions</em>。</p> </blockquote> <h3 id=_14>在各处使用相同缩写<a class=headerlink href=#_14 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#use-same-abbreviations-everywhere>本节</a></p> </blockquote> <p>人们会搜索关键字来查找相关代码。为此，应对相同事物使用相同缩写。例如，始终将 "detection object type" 缩写为 "dobjt"，而不是混合使用 "dot"、"dotype"、"detobjtype" 等等。</p> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Use Searchable Names</em>。</p> </blockquote> <h3 id=_15>用名词表示类而用动词表示方法<a class=headerlink href=#_15 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#use-nouns-for-classes-and-verbs-for-methods>本节</a></p> </blockquote> <p>使用名词或名词词组命名类、接口和对象：</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>account</span>
<span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>user_preferences</span>
<span class=k>INTERFACE</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>customizing_reader</span>
</code></pre></div> <p>使用动词或动词词组命名方法：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>withdraw</span>
<span class=k>METHODS</span> <span class=nv>add_message</span>
<span class=k>METHODS</span> <span class=nv>read_entries</span>
</code></pre></div> <p>用诸如 <code>is_</code> 和 <code>has_</code> 之类的动词作为布尔方法的开头，读起来会很流畅：</p> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>is_empty</span><span class=p>(</span> <span class=k>table</span> <span class=p>).</span>
</code></pre></div> <p>建议也像方法一样给函数命名：</p> <div class=highlight><pre><span></span><code><span class=k>FUNCTION</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>read_alerts</span>
</code></pre></div> <h3 id=datainfoobject>避免干扰词，如 "data"、"info"、"object"<a class=headerlink href=#datainfoobject title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#avoid-noise-words-such-as-data-info-object>本节</a></p> </blockquote> <p>省略干扰词</p> <div class=highlight><pre><span></span><code><span class=nv>account</span>  <span class=c1>&quot; instead of account_data</span>
<span class=nv>alert</span>    <span class=c1>&quot; instead of alert_object</span>
</code></pre></div> <p>或将其替换为某些确实更有价值的特定字眼</p> <div class=highlight><pre><span></span><code><span class=nv>user_preferences</span>          <span class=c1>&quot; instead of user_info</span>
<span class=nv>response_time_in_seconds</span>  <span class=c1>&quot; instead of response_time_variable</span>
</code></pre></div> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Make Meaningful Distinctions</em></p> </blockquote> <h3 id=_16>每个概念选取一个词<a class=headerlink href=#_16 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#pick-one-word-per-concept>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>read_this</span><span class=p>.</span>
<span class=k>METHODS</span> <span class=nv>read_that</span><span class=p>.</span>
<span class=k>METHODS</span> <span class=nv>read_those</span><span class=p>.</span>
</code></pre></div> <p>为一个概念选择一个术语并坚持使用；不要混合使用其他同义词。同义词会使读者浪费时间查找本不存在的差异。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>read_this</span><span class=p>.</span>
<span class=k>METHODS</span> <span class=nv>retrieve_that</span><span class=p>.</span>
<span class=k>METHODS</span> <span class=nv>query_those</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Pick One Word per Concept</em></p> </blockquote> <h3 id=_17>仅在本意如此时使用模式名称<a class=headerlink href=#_17 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#use-pattern-names-only-if-you-mean-them>本节</a></p> </blockquote> <p>不要对类和接口使用软件设计模式的名称，除非本意真的如此。例如，不要将类称为 <code>file_factory</code>，除非它的确实施了工厂设计模式。最常见的模式包括：<a href=https://en.wikipedia.org/wiki/Singleton_pattern>singleton</a>、<a href=https://en.wikipedia.org/wiki/Factory_method_pattern>factory</a>、<a href=https://en.wikipedia.org/wiki/Facade_pattern>facade</a>、<a href=https://en.wikipedia.org/wiki/Composite_pattern>composite</a>、<a href=https://en.wikipedia.org/wiki/Decorator_pattern>decorator</a>、<a href=https://en.wikipedia.org/wiki/Iterator_pattern>iterator</a>、<a href=https://en.wikipedia.org/wiki/Observer_pattern>observer</a> 和 <a href=https://en.wikipedia.org/wiki/Strategy_pattern>strategy</a>。</p> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 2: Meaningful Names: Avoid Disinformation</em></p> </blockquote> <h3 id=_18>避免编码，特别是匈牙利表示法和前缀<a class=headerlink href=#_18 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#names>名称</a> &gt; <a href=#avoid-encodings-esp-hungarian-notation-and-prefixes>本节</a></p> </blockquote> <p>鼓励丢掉_所有_编码前缀。</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>add_two_numbers</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>a</span> <span class=o>+</span> <span class=nv>b</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>add_two_numbers</span><span class=p>.</span>
  <span class=nv>rv_result</span> <span class=o>=</span> <span class=nv>iv_a</span> <span class=o>+</span> <span class=nv>iv_b</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <blockquote> <p><a href=sub-sections/AvoidEncodings>Avoid Encodings</a> &gt; 深入介绍了这样做的理由。</p> </blockquote> <h2 id=_19>语言<a class=headerlink href=#_19 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#language>本节</a></p> </blockquote> <h3 id=_20>顾及传统<a class=headerlink href=#_20 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#language>语言</a> &gt; <a href=#mind-the-legacy>本节</a></p> </blockquote> <p>如果是针对较早的 ABAP 版本进行编码，则应谨慎采纳本指南中的建议：下文的许多建议利用了相对较新的语法和结构，这些在较早的 ABAP 版本中可能不受支持。在必须支持的最早版本上验证欲遵循的指导原则。不要简单地整个抛弃整洁代码 - 绝大多数规则（例如，命名、注释）在_任何_ ABAP 版本中都行得通。</p> <h3 id=_21>顾及性能<a class=headerlink href=#_21 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#language>语言</a> &gt; <a href=#mind-the-performance>本节</a></p> </blockquote> <p>如果是为高性能组件编码，则应谨慎采纳本指南中的建议：整洁代码在某些方面可能会降低速度（更多方法调用）或消耗更多内存（更多对象）。ABAP 的某些特点可能会加剧这种情况，例如，在调用方法时，它会比较数据类型，这样一来，将单个大方法拆分成多个子方法，可能会降低代码速度。</p> <p>然而，强烈建议不要因为模糊的恐惧就过早地悲观失望。绝大多数规则（例如，命名、注释）根本不会产生任何负面影响。尽力采用整洁的面向对象的方式做事情。如果有什么过慢，就做一个性能测量。只有这样做之后，才应根据事实作出决策，放弃所选规则。</p> <p>一些更深入的思考，部分取自 <a href=https://martinfowler.com/books/refactoring.html>Martin Fowler 所著的 <em>Refactoring</em></a> 中的第 2 章：</p> <p>在典型的应用程序中，大部分运行时间都花在很小比例的代码中。小到 10% 的代码会占到 90% 的运行时间，特别是在 ABAP 中，很大比例的运行时间可能都是数据库时间。</p> <p>因此，花大力气试图使_所有_代码都一直保持超高效率，并非最好的资源安排方式。不主张忽视性能，但在初始开发阶段，应该更关注代码的整洁性和条理分明的程度，然后使用剖析器找出关键区域进行优化。</p> <p>事实上，我们有理由证明，这种方式对性能的正面影响更大，因为优化努力更有针对性，更容易找出性能瓶颈，而且条理分明的代码更容易进行重构和调优。</p> <h3 id=_22>面向对象编程优于过程式编程<a class=headerlink href=#_22 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#language>语言</a> &gt; <a href=#prefer-object-orientation-to-procedural-programming>本节</a></p> </blockquote> <p>面向对象的程序（类、接口）比过程式代码（函数、程序）分段更清晰，并且可以更加容易地进行重构和测试。尽管在某些情况下必须提供过程式对象（对 RFC 用函数、对事务用程序），但这些对象除了调用提供实际功能的相应类之外，不应该再干别的：</p> <div class=highlight><pre><span></span><code><span class=k>FUNCTION</span> <span class=nv>check_business_partner</span> <span class=p>[...].</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>validator</span><span class=p>)</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>biz_partner_validator</span><span class=p>(</span> <span class=p>).</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>validator</span><span class=o>-&gt;</span><span class=nf>validate</span><span class=p>(</span> <span class=nv>business_partners</span> <span class=p>).</span>
<span class=k>ENDFUNCTION</span><span class=p>.</span>
</code></pre></div> <blockquote> <p><a href=sub-sections/FunctionGroupsVsClasses>Function Groups vs. Classes</a> &gt; 详细描述了两者的差异。</p> </blockquote> <h3 id=_23>函数式语言结构优于过程式语言结构<a class=headerlink href=#_23 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#language>语言</a> &gt; <a href=#prefer-functional-to-procedural-language-constructs>本节</a></p> </blockquote> <p>它们通常更加简短，而且更容易为现代程序员所接受。</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>variable</span><span class=p>)</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
<span class=c1>&quot; MOVE &#39;A&#39; TO variable.</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>uppercase</span><span class=p>)</span> <span class=o>=</span> <span class=nv>to_upper</span><span class=p>(</span> <span class=nv>lowercase</span> <span class=p>).</span>
<span class=c1>&quot; TRANSLATE lowercase TO UPPER CASE.</span>

<span class=k>index</span> <span class=o>+=</span> <span class=mi>1</span><span class=p>.</span>         <span class=c1>&quot; &gt;= NW 7.54</span>
<span class=k>index</span> <span class=o>=</span> <span class=k>index</span> <span class=o>+</span> <span class=mi>1</span><span class=p>.</span>  <span class=c1>&quot; &lt; NW 7.54</span>
<span class=c1>&quot; ADD 1 TO index.</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>object</span><span class=p>)</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>my_class</span><span class=p>(</span> <span class=p>).</span>
<span class=c1>&quot; CREATE OBJECT object TYPE /dirty/my_class.</span>

<span class=nv>result</span> <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=k>FOR</span> <span class=nv>row</span> <span class=k>IN</span> <span class=nv>input</span> <span class=p>(</span> <span class=nv>row</span><span class=o>-</span><span class=nv>text</span> <span class=p>)</span> <span class=p>).</span>
<span class=c1>&quot; LOOP AT input INTO DATA(row).</span>
<span class=c1>&quot;  INSERT row-text INTO TABLE result.</span>
<span class=c1>&quot; ENDLOOP.</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>line</span><span class=p>)</span> <span class=o>=</span> <span class=nv>value_pairs</span><span class=p>[</span> <span class=nv>name</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span> <span class=p>].</span>
<span class=c1>&quot; READ TABLE value_pairs INTO DATA(line) WITH KEY name = &#39;A&#39;.</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>exists</span><span class=p>)</span> <span class=o>=</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>line_exists</span><span class=p>(</span> <span class=nv>value_pairs</span><span class=p>[</span> <span class=nv>name</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span> <span class=p>]</span> <span class=p>)</span> <span class=p>).</span>
<span class=k>IF</span> <span class=nv>line_exists</span><span class=p>(</span> <span class=nv>value_pairs</span><span class=p>[</span> <span class=nv>name</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span> <span class=p>]</span> <span class=p>).</span>
<span class=c1>&quot; READ TABLE value_pairs TRANSPORTING NO FIELDS WITH KEY name = &#39;A&#39;.</span>
<span class=c1>&quot; DATA(exists) = xsdbool( sy-subrc = 0 ).</span>
</code></pre></div> <p>下文的许多详细规则只不过是具体重申了这条通用的建议。</p> <h3 id=_24>避免过时语言元素<a class=headerlink href=#_24 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#language>语言</a> &gt; <a href=#avoid-obsolete-language-elements>本节</a></p> </blockquote> <p>在升级 ABAP 版本时，务必要检查是否有过时的语言元素，避免再使用它们。</p> <p>例如，以下语句中 <code>@</code> 转义的 "host" 变量更清楚地表明了什么是程序变量、什么是数据库中的列，</p> <div class=highlight><pre><span></span><code><span class=k>SELECT</span> <span class=o>*</span>
  <span class=k>FROM</span> <span class=nv>spfli</span>
  <span class=k>WHERE</span> <span class=nv>carrid</span> <span class=o>=</span> <span class=err>@</span><span class=nv>carrid</span> <span class=ow>AND</span>
        <span class=nv>connid</span> <span class=o>=</span> <span class=err>@</span><span class=nv>connid</span>
  <span class=k>INTO</span> <span class=k>TABLE</span> <span class=err>@</span><span class=nv>itab</span><span class=p>.</span>
</code></pre></div> <p>相较于<a href=https://help.sap.com/doc/abapdocu_750_index_htm/7.50/en-US/abenopen_sql_hostvar_obsolete.htm>过时的转义形式</a></p> <div class=highlight><pre><span></span><code><span class=k>SELECT</span> <span class=o>*</span>
  <span class=k>FROM</span> <span class=nv>spfli</span>
  <span class=k>WHERE</span> <span class=nv>carrid</span> <span class=o>=</span> <span class=nv>carrid</span> <span class=ow>AND</span>
        <span class=nv>connid</span> <span class=o>=</span> <span class=nv>connid</span>
  <span class=k>INTO</span> <span class=k>TABLE</span> <span class=nv>itab</span><span class=p>.</span>
</code></pre></div> <p>较新的可选方案倾向于提高代码的可读性，减少与现代编程范式的设计冲突，这样切换到这些方案时就会自动使代码更整洁。</p> <p>如果继续使用旧代码编写方式，过时元素可能在处理速度和内存消耗方面无法再从优化中受益。</p> <p>使用现代语言元素，可以更轻松地将年轻的 ABAP 程序员带上道，由于在 SAP 的培训中不再教授过时内容，他们可能不再熟悉过时的结构。</p> <p>SAP NetWeaver 文档固定包含一部分，其中列出了过时的语言元素，例如，<a href="https://help.sap.com/doc/abapdocu_750_index_htm/7.50/en-US/index.htm?file=abenabap_obsolete.htm">NW 7.50</a>、<a href="https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/index.htm?file=abenabap_obsolete.htm">NW 7.51</a>、<a href="https://help.sap.com/doc/abapdocu_752_index_htm/7.52/en-US/index.htm?file=abenabap_obsolete.htm">NW 7.52</a>、<a href="https://help.sap.com/doc/abapdocu_753_index_htm/7.53/en-US/index.htm?file=abenabap_obsolete.htm">NW 7.53</a>。</p> <h3 id=_25>明智地使用设计模式<a class=headerlink href=#_25 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#language>语言</a> &gt; <a href=#use-design-patterns-wisely>本节</a></p> </blockquote> <p>仅在合适且有明显好处的地方使用。不要为了使用而到处用设计模式。</p> <h2 id=_26>常量<a class=headerlink href=#_26 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#constants>本节</a></p> </blockquote> <h3 id=_27>使用常量而非幻数<a class=headerlink href=#_27 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#constants>常量</a> &gt; <a href=#use-constants-instead-of-magic-numbers>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>abap_type</span> <span class=o>=</span> <span class=nv>cl_abap_typedescr</span><span class=o>=&gt;</span><span class=nv>typekind_date</span><span class=p>.</span>
</code></pre></div> <p>在清晰方面好于</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>abap_type</span> <span class=o>=</span> <span class=s1>&#39;D&#39;</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 17: Smells and Heuristics: G25: &gt; Replace Magic Numbers with Named Constants</em>。</p> </blockquote> <h3 id=_28>枚举类优于常量接口<a class=headerlink href=#_28 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#constants>常量</a> &gt; <a href=#prefer-enumeration-classes-to-constants-interfaces>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>message_severity</span> <span class=k>DEFINITION</span> <span class=k>PUBLIC</span> <span class=k>ABSTRACT</span> <span class=nv>FINAL</span><span class=p>.</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>CONSTANTS</span><span class=p>:</span>
      <span class=nv>warning</span> <span class=k>TYPE </span><span class=nv>symsgty</span> <span class=k>VALUE</span> <span class=s1>&#39;W&#39;</span><span class=p>,</span>
      <span class=nv>error</span>   <span class=k>TYPE </span><span class=nv>symsgty</span> <span class=k>VALUE</span> <span class=s1>&#39;E&#39;</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <p>或</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>message_severity</span> <span class=k>DEFINITION</span> <span class=k>PUBLIC</span> <span class=k>CREATE PRIVATE</span> <span class=nv>FINAL</span><span class=p>.</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>CLASS-DATA</span><span class=p>:</span>
      <span class=nv>warning</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>message_severity</span> <span class=k>READ</span><span class=o>-</span><span class=nv>ONLY</span><span class=p>,</span>
      <span class=nv>error</span>   <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>message_severity</span> <span class=k>READ</span><span class=o>-</span><span class=nv>ONLY</span><span class=p>.</span>
  <span class=c1>&quot; ...</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <p>而不是将不相关的东西混在一起</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>INTERFACE</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>common_constants</span><span class=p>.</span>
  <span class=k>CONSTANTS</span><span class=p>:</span>
    <span class=nv>warning</span>      <span class=k>TYPE </span><span class=nv>symsgty</span> <span class=k>VALUE</span> <span class=s1>&#39;W&#39;</span><span class=p>,</span>
    <span class=nv>transitional</span> <span class=k>TYPE </span><span class=nv>i</span>       <span class=k>VALUE</span> <span class=mi>1</span><span class=p>,</span>
    <span class=nv>error</span>        <span class=k>TYPE </span><span class=nv>symsgty</span> <span class=k>VALUE</span> <span class=s1>&#39;E&#39;</span><span class=p>,</span>
    <span class=nv>persisted</span>    <span class=k>TYPE </span><span class=nv>i</span>       <span class=k>VALUE</span> <span class=mi>2</span><span class=p>.</span>
<span class=k>ENDINTERFACE</span><span class=p>.</span>
</code></pre></div> <blockquote> <p><a href=sub-sections/Enumerations>Enumerations</a> &gt; 描述了常见的枚举模式&gt; 并讨论了它们的优缺点。</p> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 17: Smells and Heuristics: J3: Constants versus Enums</em>。</p> </blockquote> <h3 id=_29>如果不使用枚举类，则对常量进行分组<a class=headerlink href=#_29 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#constants>常量</a> &gt; <a href=#if-you-dont-use-enumeration-classes-group-your-constants>本节</a></p> </blockquote> <p>如果以松散方式集合常量，例如，在接口中，则应将其分组：</p> <div class=highlight><pre><span></span><code><span class=k>CONSTANTS</span><span class=p>:</span>
  <span class=k>BEGIN OF</span> <span class=nv>message_severity</span><span class=p>,</span>
    <span class=nv>warning</span> <span class=k>TYPE </span><span class=nv>symsgty</span> <span class=k>VALUE</span> <span class=s1>&#39;W&#39;</span><span class=p>,</span>
    <span class=nv>error</span>   <span class=k>TYPE </span><span class=nv>symsgty</span> <span class=k>VALUE</span> <span class=s1>&#39;E&#39;</span><span class=p>,</span>
  <span class=k>END OF</span> <span class=nv>message_severity</span><span class=p>,</span>
  <span class=k>BEGIN OF</span> <span class=nv>message_lifespan</span><span class=p>,</span>
    <span class=nv>transitional</span> <span class=k>TYPE </span><span class=nv>i</span> <span class=k>VALUE</span> <span class=mi>1</span><span class=p>,</span>
    <span class=nv>persisted</span>    <span class=k>TYPE </span><span class=nv>i</span> <span class=k>VALUE</span> <span class=mi>2</span><span class=p>,</span>
  <span class=k>END OF</span> <span class=nv>message_lifespan</span><span class=p>.</span>
</code></pre></div> <p>使关系更清晰，好于：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; Anti-pattern</span>
<span class=k>CONSTANTS</span><span class=p>:</span>
  <span class=nv>warning</span>      <span class=k>TYPE </span><span class=nv>symsgty</span> <span class=k>VALUE</span> <span class=s1>&#39;W&#39;</span><span class=p>,</span>
  <span class=nv>transitional</span> <span class=k>TYPE </span><span class=nv>i</span>       <span class=k>VALUE</span> <span class=mi>1</span><span class=p>,</span>
  <span class=nv>error</span>        <span class=k>TYPE </span><span class=nv>symsgty</span> <span class=k>VALUE</span> <span class=s1>&#39;E&#39;</span><span class=p>,</span>
  <span class=nv>persisted</span>    <span class=k>TYPE </span><span class=nv>i</span>       <span class=k>VALUE</span> <span class=mi>2</span><span class=p>,</span>
</code></pre></div> <p>利用组还可以成组进行访问，例如，进行输入验证：</p> <div class=highlight><pre><span></span><code><span class=k>DO</span> <span class=nv>number_of_constants</span> <span class=k>TIMES</span><span class=p>.</span>
  <span class=k>ASSIGN</span> <span class=k>COMPONENT</span> <span class=nv>sy</span><span class=o>-</span><span class=nv>index</span> <span class=k>OF STRUCTURE</span> <span class=nv>message_severity</span> <span class=k>TO</span> <span class=k>FIELD</span><span class=o>-</span><span class=nv>SYMBOL</span><span class=p>(</span><span class=nv>&lt;constant&gt;</span><span class=p>).</span>
  <span class=k>IF</span> <span class=nv>&lt;constant&gt;</span> <span class=o>=</span> <span class=nv>input</span><span class=p>.</span>
    <span class=nv>is_valid</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
    <span class=k>RETURN</span><span class=p>.</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDWHILE</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 17: Smells and Heuristics: G27: Structure over Convention</em>。</p> </blockquote> <h2 id=_30>变量<a class=headerlink href=#_30 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#variables>本节</a></p> </blockquote> <h3 id=_31>内联声明优于最前声明<a class=headerlink href=#_31 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#variables>变量</a> &gt; <a href=#prefer-inline-to-up-front-declarations>本节</a></p> </blockquote> <p>如果遵循本文的指导原则，在首次出现的地方内联式声明变量显得更加自然，方法体也会变得很精短（3-5 条语句）。</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>name</span><span class=p>)</span> <span class=o>=</span> <span class=s1>&#39;something&#39;</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>reader</span><span class=p>)</span> <span class=o>=</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>reader</span><span class=o>=&gt;</span><span class=nf>get_instance_for</span><span class=p>(</span> <span class=nv>name</span> <span class=p>).</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>reader</span><span class=o>-&gt;</span><span class=nf>read_it</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>好过在方法开头单独的 <code>DATA</code> 部分声明变量</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>:</span>
    <span class=nv>name</span>   <span class=k>TYPE </span><span class=nv>seoclsname</span><span class=p>,</span>
    <span class=nv>reader</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>reader</span><span class=p>.</span>
  <span class=nv>name</span> <span class=o>=</span> <span class=s1>&#39;something&#39;</span><span class=p>.</span>
  <span class=nv>reader</span> <span class=o>=</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>reader</span><span class=o>=&gt;</span><span class=nf>get_instance_for</span><span class=p>(</span> <span class=nv>name</span> <span class=p>).</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>reader</span><span class=o>-&gt;</span><span class=nf>read_it</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 5: Formatting: Vertical Distance: Variable Declarations</em>。</p> </blockquote> <h3 id=_32>勿在可选分支中内联声明<a class=headerlink href=#_32 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#variables>变量</a> &gt; <a href=#dont-declare-inline-in-optional-branches>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>value</span><span class=p>)</span> <span class=o>=</span> <span class=mi>1</span><span class=p>.</span>
<span class=k>ELSE</span><span class=p>.</span>
  <span class=k>value</span> <span class=o>=</span> <span class=mi>2</span><span class=p>.</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <p>这样可以正常运行，因为 ABAP 会像声明位于方法开头那样来处理内联式声明。然而，这会令读者感到极其迷惑，特别是方法体较长而又没当场发现声明的话。在此情况下，不要使用内联式声明而将声明放在最前面：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=k>value</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>
<span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
  <span class=k>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>.</span>
<span class=k>ELSE</span><span class=p>.</span>
  <span class=k>value</span> <span class=o>=</span> <span class=mi>2</span><span class=p>.</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 5: Formatting: Vertical Distance: Variable Declarations</em>。</p> </blockquote> <h3 id=_33>勿用链式最前声明<a class=headerlink href=#_33 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#variables>变量</a> &gt; <a href=#do-not-chain-up-front-declarations>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>name</span> <span class=k>TYPE </span><span class=nv>seoclsname</span><span class=p>.</span>
<span class=k>DATA</span> <span class=nv>reader</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>reader</span><span class=p>.</span>
</code></pre></div> <p>链式处理主张在逻辑层级关联定义的变量。为了一致性，必须确保所有链式变量结成一体，要添加变量，就得另外引入链组。尽管这种方法可行，但通常不值得花这个功夫。</p> <p>另外，链式处理也毫无必要地使重新格式化和重构变得复杂，因为每行看起来都不同，改起来需要四处挪动冒号、句号和逗号，根本不值得花功夫。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>:</span>
  <span class=nv>name</span>   <span class=k>TYPE </span><span class=nv>seoclsname</span><span class=p>,</span>
  <span class=nv>reader</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>reader</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>另请参阅 <a href=#dont-align-type-clauses>Don't align type clauses</a> 如果使用链式数据声明，则每组结成一体的变量各用一个链。</p> </blockquote> <h3 id=ref-to-field-symbol>REF TO 优于 FIELD-SYMBOL<a class=headerlink href=#ref-to-field-symbol title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#variables>变量</a> &gt; <a href=#prefer-ref-to-to-field-symbol>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>LOOP AT components</span> <span class=k>REFERENCE INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>component</span><span class=p>).</span>
</code></pre></div> <p>而非等效形式</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>LOOP AT components</span> <span class=k>ASSIGNING</span> <span class=k>FIELD</span><span class=o>-</span><span class=nv>SYMBOL</span><span class=p>(</span><span class=nv>&lt;component&gt;</span><span class=p>).</span>
</code></pre></div> <p>需要指针的地方除外</p> <div class=highlight><pre><span></span><code><span class=k>ASSIGN</span> <span class=nv>generic-&gt;*</span> <span class=k>TO</span> <span class=k>FIELD</span><span class=o>-</span><span class=nv>SYMBOL</span><span class=p>(</span><span class=nv>&lt;generic&gt;</span><span class=p>).</span>
<span class=k>ASSIGN</span> <span class=k>COMPONENT</span> <span class=nv>name</span> <span class=k>OF STRUCTURE</span> <span class=nv>structure</span> <span class=k>TO</span> <span class=k>FIELD</span><span class=o>-</span><span class=nv>SYMBOL</span><span class=p>(</span><span class=nv>&lt;component&gt;</span><span class=p>).</span>
<span class=k>ASSIGN</span> <span class=p>(</span><span class=nv>class_name</span><span class=p>)</span><span class=o>=&gt;</span><span class=p>(</span><span class=nv>static_member</span><span class=p>)</span> <span class=k>TO</span> <span class=k>FIELD</span><span class=o>-</span><span class=nv>SYMBOL</span><span class=p>(</span><span class=nv>&lt;member&gt;</span><span class=p>).</span>
</code></pre></div> <p>从代码评审的经验表明人们往往会随心所欲地做出选择：“就是因为”、“因为我们总是采用那种循环方式”，或者“没特殊原因”。随意选择会令读者把时间浪费在毫无意义的问题上：为什么用这个而不用那个，因此应代之以有理有据、准确无误的决策。我们的建议基于这种理由：</p> <ul> <li> <p>指针能做一些引用做不了的事情，比如动态访问结构的组成部分。同样，引用也能做指针做不了的事情，比如构造动态类型的数据结构。总之，单独指望一个是不行的。</p> </li> <li> <p>在面向对象的 ABAP 中，引用到处都有并且无法避免，因为任何对象皆是 <code>REF TO &lt;class-name&gt;</code>。相反，指针仅在涉及动态类型的少数特殊情况下才绝对需要。因此，引用自然成为任何面向对象程序中的首选。</p> </li> <li> <p>指针比引用短，但结果节省的内存却微不足道，尽可以忽略不计。同样，速度也不是问题。因此，在性能方面没理由厚此薄彼。</p> </li> </ul> <blockquote> <p>更多信息参阅 &gt; <a href="https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/index.htm?file=abendyn_access_data_obj_guidl.htm">ABAP Programming Guidelines 中的篇章 <em>Accessing Data Objects Dynamically</em></a>。</p> </blockquote> <h2 id=_34>表<a class=headerlink href=#_34 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#tables>本节</a></p> </blockquote> <h3 id=_35>使用恰当的表类型<a class=headerlink href=#_35 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#tables>表</a> &gt; <a href=#use-the-right-table-type>本节</a></p> </blockquote> <ul> <li> <p><code>HASHED</code> 表通常用来表示**单步填充**、<strong>永不修改**且**常按键值读取**的**大表</strong>。其固有的内存和处理开销使得散列表仅在数据量很大且读访问次数很多的情况下才有价值。每次对表内容进行更改，均需要大量重新计算散列值，因此修改过于频繁的表不要使用此种类型。</p> </li> <li> <p><code>SORTED</code> 表通常用于表示需要**时时排序**、<strong>逐位填充**或**需要修改**并且**常按一个或多个完整或部分键值读取**或**以某种特定顺序**处理的**大表</strong>。添加、更改或移除内容，需要找到恰当的插入点，但不需要调整表索引的其余部分。仅对读访问次数很多的情况，有序表才有价值。</p> </li> <li> <p><code>STANDARD</code> 表用于表示索引开销大于索引受益的**小表**，以及或是毫不在乎行顺序或是就想完全按追加顺序进行处理的**“数组”**。另外，也适用于需要对表进行不同访问的情况，例如，通过 <code>SORT</code> 和 <code>BINARY SEARCH</code> 进行索引访问和排序访问。</p> </li> </ul> <blockquote> <p>这些只是粗略的指导原则。&gt; 更多细节参见 <a href=https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/abenitab_kind.htm>ABAP Language Help 中的篇章 <em>Selection of Table Category</em></a>。</p> </blockquote> <h3 id=default-key>避免 DEFAULT KEY<a class=headerlink href=#default-key title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#tables>表</a> &gt; <a href=#avoid-default-key>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span> <span class=nv>itab</span> <span class=k>TYPE STANDARD TABLE OF</span> <span class=nv>row_type</span> <span class=k>WITH</span> <span class=k>DEFAULT</span> <span class=k>KEY</span><span class=p>.</span>
</code></pre></div> <p>添加缺省键值常常只是为了让具有较新功能的语句得以正常工作。事实上，这些键值本身通常是多余的，除了耗费资源，别无它用。由于它们会忽略数值数据类型，因此甚至可能会导致隐蔽的错误。不含显式字段列表的 <code>SORT</code> 和 <code>DELETE ADJACENT</code> 语句将会转而采用内部表的主键，在使用 <code>DEFAULT KEY</code> 的情况下，这可能会导致十分意想不到的结果，例如，当以数值字段作为键值的分量时，特别是当与 <code>READ TABLE ... BINARY</code> 等结合使用时。</p> <p>要么显式指定键值</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>itab2</span> <span class=k>TYPE STANDARD TABLE OF</span> <span class=nv>row_type</span> <span class=k>WITH NON-UNIQUE KEY</span> <span class=nv>comp1</span> <span class=nv>comp2</span><span class=p>.</span>
</code></pre></div> <p>如果根本不需要键值的话，则采用 <code>EMPTY KEY</code>。。</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>itab1</span> <span class=k>TYPE STANDARD TABLE OF</span> <span class=nv>row_type</span> <span class=k>WITH</span> <span class=nv>EMPTY</span> <span class=k>KEY</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>参照 <a href=https://blogs.sap.com/2013/06/27/abap-news-for-release-740-internal-tables-with-empty-key/ >Horst Keller 的博客文章 <em>Internal Tables with Empty Key</em></a> **注意：**具有 <code>EMPTY KEY</code> 的内部表上的 <code>SORT</code> 根本不会进行排序，&gt; 但假如能静态确定键值为空，就会发出语法警告。</p> </blockquote> <h3 id=insert-into-table-append-to>INSERT INTO TABLE 优于 APPEND TO<a class=headerlink href=#insert-into-table-append-to title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#tables>表</a> &gt; <a href=#prefer-insert-into-table-to-append-to>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>INSERT</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=p>...</span> <span class=p>)</span> <span class=k>INTO</span> <span class=k>TABLE</span> <span class=nv>itab</span><span class=p>.</span>
</code></pre></div> <p><code>INSERT INTO TABLE</code> 对所有表和键值类型都起作用，因而更便于在性能需求发生变化时重构表的类型和键值定义。</p> <p>仅当以类似数组的方式使用 <code>STANDARD</code> 表时才使用 <code>APPEND TO</code>，如果想要强调所添加的条目应为最后一行的话。</p> <h3 id=line_exists-read-table-loop-at>LINE_EXISTS 优于 READ TABLE 或 LOOP AT<a class=headerlink href=#line_exists-read-table-loop-at title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#tables>表</a> &gt; <a href=#prefer-line_exists-to-read-table-or-loop-at>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>line_exists</span><span class=p>(</span> <span class=nv>my_table</span><span class=p>[</span> <span class=k>key</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span> <span class=p>]</span> <span class=p>).</span>
</code></pre></div> <p>更清楚简洁地表明意图，好于</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>READ</span> <span class=k>TABLE</span> <span class=nv>my_table</span> <span class=k>TRANSPORTING NO FIELDS</span> <span class=k>WITH</span> <span class=k>KEY</span> <span class=k>key</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
<span class=k>IF</span> <span class=nv>sy</span><span class=o>-</span><span class=nv>subrc</span> <span class=o>=</span> <span class=mi>0</span><span class=p>.</span>
</code></pre></div> <p>或者甚至是</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>LOOP AT </span><span class=nv>my_table</span> <span class=k>REFERENCE INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>line</span><span class=p>)</span> <span class=k>WHERE</span> <span class=k>key</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
  <span class=nv>line_exists</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
  <span class=k>EXIT</span><span class=p>.</span>
<span class=k>ENDLOOP</span><span class=p>.</span>
</code></pre></div> <h3 id=read-table-loop-at>READ TABLE 优于 LOOP AT<a class=headerlink href=#read-table-loop-at title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#tables>表</a> &gt; <a href=#prefer-read-table-to-loop-at>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>READ</span> <span class=k>TABLE</span> <span class=nv>my_table</span> <span class=k>REFERENCE INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>line</span><span class=p>)</span> <span class=k>WITH</span> <span class=k>KEY</span> <span class=k>key</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
</code></pre></div> <p>更清楚简洁地表明意图，好于</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>LOOP AT </span><span class=nv>my_table</span> <span class=k>REFERENCE INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>line</span><span class=p>)</span> <span class=k>WHERE</span> <span class=k>key</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
  <span class=k>EXIT</span><span class=p>.</span>
<span class=k>ENDLOOP</span><span class=p>.</span>
</code></pre></div> <p>或者甚至是</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>LOOP AT </span><span class=nv>my_table</span> <span class=k>REFERENCE INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>line</span><span class=p>).</span>
  <span class=k>IF</span> <span class=nv>line</span><span class=o>-&gt;</span><span class=nv>key</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
    <span class=k>EXIT</span><span class=p>.</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDLOOP</span><span class=p>.</span>
</code></pre></div> <h3 id=loop-at-where-if>LOOP AT WHERE 优于嵌套式 IF<a class=headerlink href=#loop-at-where-if title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#tables>表</a> &gt; <a href=#prefer-loop-at-where-to-nested-if>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>LOOP AT </span><span class=nv>my_table</span> <span class=k>REFERENCE INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>line</span><span class=p>)</span> <span class=k>WHERE</span> <span class=k>key</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
</code></pre></div> <p>更清楚简洁地表明意图，好于</p> <div class=highlight><pre><span></span><code><span class=k>LOOP AT </span><span class=nv>my_table</span> <span class=k>REFERENCE INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>line</span><span class=p>).</span>
  <span class=k>IF</span> <span class=nv>line</span><span class=o>-&gt;</span><span class=nv>key</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
    <span class=k>EXIT</span><span class=p>.</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDLOOP</span><span class=p>.</span>
</code></pre></div> <h3 id=_36>避免不必要的表读取<a class=headerlink href=#_36 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#tables>表</a> &gt; <a href=#avoid-unnecessary-table-reads>本节</a></p> </blockquote> <p>若你_预期_某一行就在表里，那就读取一次并对异常作出处理就够了，</p> <div class=highlight><pre><span></span><code><span class=k>TRY</span><span class=p>.</span>
    <span class=k>DATA</span><span class=p>(</span><span class=nv>row</span><span class=p>)</span> <span class=o>=</span> <span class=nv>my_table</span><span class=p>[</span> <span class=k>key</span> <span class=o>=</span> <span class=nv>input</span> <span class=p>].</span>
  <span class=k>CATCH</span> <span class=nv>cx_sy_itab_line_not_found</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>my_data_not_found</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDTRY</span><span class=p>.</span>
</code></pre></div> <p>而不是用两次读取打乱并减慢主控制流</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=ow>NOT</span> <span class=nv>line_exists</span><span class=p>(</span> <span class=nv>my_table</span><span class=p>[</span> <span class=k>key</span> <span class=o>=</span> <span class=nv>input</span> <span class=p>]</span> <span class=p>).</span>
  <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>my_data_not_found</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDTRY</span><span class=p>.</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>row</span><span class=p>)</span> <span class=o>=</span> <span class=nv>my_table</span><span class=p>[</span> <span class=k>key</span> <span class=o>=</span> <span class=nv>input</span> <span class=p>].</span>
</code></pre></div> <blockquote> <p>除了提高性能以外，这还是更一般性的<a href=#focus-on-the-happy-path-or-error-handling-but-not-both>关注愉快路径或错误处理，但非两者兼顾</a>的一种特殊变化形式。</p> </blockquote> <h2 id=_37>字符串<a class=headerlink href=#_37 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#strings>本节</a></p> </blockquote> <h3 id=_38>使用 ` 定义文字<a class=headerlink href=#_38 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#strings>字符串</a> &gt; <a href=#use--to-define-literals>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CONSTANTS</span> <span class=nv>some_constant</span> <span class=k>TYPE </span><span class=nv>string</span> <span class=k>VALUE</span> <span class=s1>`ABC`</span><span class=p>.</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>some_string</span><span class=p>)</span> <span class=o>=</span> <span class=s1>`ABC`</span><span class=p>.</span>  <span class=c1>&quot; --&gt; TYPE string</span>
</code></pre></div> <p>避免使用 <code>'</code>，因为它会增加多余的类型转换，并且会令读者困惑于处理的究竟是 <code>CHAR</code> 还是 <code>STRING</code>：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span> <span class=nv>some_string</span> <span class=k>TYPE </span><span class=nv>string</span><span class=p>.</span>
<span class=nv>some_string</span> <span class=o>=</span> <span class=s1>&#39;ABC&#39;</span><span class=p>.</span>
</code></pre></div> <p><code>|</code> 一般都适用，但无法用于 <code>CONSTANTS</code>，而且在指定固定值时会增加不必要的开销：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>some_string</span><span class=p>)</span> <span class=o>=</span> <span class=p>|</span><span class=s1>ABC</span><span class=p>|.</span>
</code></pre></div> <h3 id=_39>使用 | 汇集文本<a class=headerlink href=#_39 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#strings>字符串</a> &gt; <a href=#use--to-assemble-text>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>message</span><span class=p>)</span> <span class=o>=</span> <span class=p>|</span><span class=s1>Received HTTP code </span><span class=p>{</span> <span class=nv>status_code</span> <span class=p>}</span><span class=s1> with message </span><span class=p>{</span> <span class=nv>text</span> <span class=p>}|.</span>
</code></pre></div> <p>字符串模板更加突出地表明何为文字、何为变量，特别是如果在文本中嵌入多个变量的话。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>message</span><span class=p>)</span> <span class=o>=</span> <span class=s1>`Received an unexpected HTTP `</span> <span class=o>&amp;&amp;</span> <span class=nv>status_code</span> <span class=o>&amp;&amp;</span> <span class=s1>` with message `</span> <span class=o>&amp;&amp;</span> <span class=nv>text</span><span class=p>.</span>
</code></pre></div> <h2 id=_40>布尔值<a class=headerlink href=#_40 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#booleans>本节</a></p> </blockquote> <h3 id=_41>明智地使用布尔值<a class=headerlink href=#_41 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#booleans>布尔值</a> &gt; <a href=#use-booleans-wisely>本节</a></p> </blockquote> <p>经常会遇到下面这种情况，布尔值似乎是自然的选择</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>is_archived</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
</code></pre></div> <p>而换个视角才发现本应选择枚举</p> <div class=highlight><pre><span></span><code><span class=nv>archiving_status</span> <span class=o>=</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>archivation_status</span><span class=o>=&gt;</span><span class=nv>archiving_in_process</span><span class=p>.</span>
</code></pre></div> <p>一般来说，用布尔值区分事物的类型是一种坏的选择，因为几乎总会遇到并非彼此排斥的情况</p> <div class=highlight><pre><span></span><code><span class=nv>assert_true</span><span class=p>(</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>document</span><span class=o>-&gt;</span><span class=nf>is_archived</span><span class=p>(</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=ow>AND</span>
                      <span class=nv>document</span><span class=o>-&gt;</span><span class=nf>is_partially_archived</span><span class=p>(</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <p>此外，<a href=#split-method-instead-of-boolean-input-parameter>拆分方法而非使用布尔输入参数</a>还解释了为何应始终回避布尔参数。</p> <blockquote> <p>更多信息参阅 <a href=http://www.beyondcode.org/articles/booleanVariables.html>1</a></p> </blockquote> <h3 id=abap_bool>用 ABAP_BOOL 表示布尔值<a class=headerlink href=#abap_bool title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#booleans>布尔值</a> &gt; <a href=#use-abap_bool-for-booleans>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>has_entries</span> <span class=k>TYPE </span><span class=nv>abap_bool</span><span class=p>.</span>
</code></pre></div> <p>不要使用普通类型 <code>char1</code>。尽管在技术上兼容，但它会掩盖处理的是布尔变量这个事实。</p> <p>也要避免其他布尔类型，因为它们常常会产生奇怪的副作用，例如，<code>boolean</code> 支持第三个值 "undefined"，它会导致难以觉察的编程错误。</p> <p>在某些情况下，例如，对于 DynPro 字段，可能需要数据字典元素。此时无法使用 <code>abap_bool</code>，因为它是在类型池 <code>abap</code> 中而不是在数据字典中定义的。在此情况下，转而采用 <code>boole_d</code> 或 <code>xfeld</code>。如果需要自定义描述，那就创建自己的数据元素。</p> <blockquote> <p>ABAP 可能是唯一不带通用布尔数据类型的编程语言。然而，设立一个是大势所趋。本建议基于 ABAP Programming Guidelines。</p> </blockquote> <h3 id=abap_true-abap_false>使用 ABAP_TRUE 和 ABAP_FALSE 进行比较<a class=headerlink href=#abap_true-abap_false title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#booleans>布尔值</a> &gt; <a href=#use-abap_true-and-abap_false-for-comparisons>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
<span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_false</span><span class=p>.</span>
</code></pre></div> <p>不要使用等效字符 <code>'X'</code> 和 <code>' '</code> 或 <code>space</code>；用它们很难看出这是一个布尔表达式：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>has_entries</span> <span class=o>=</span> <span class=s1>&#39;X&#39;</span><span class=p>.</span>
<span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>space</span><span class=p>.</span>
</code></pre></div> <p>避免与 <code>INITIAL</code> 进行比较 - 这会迫使读者去回想 <code>abap_bool</code> 的缺省值为 <code>abap_false</code>：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>has_entries</span> <span class=ow>IS NOT INITIAL</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>ABAP 可能是唯一不带表示真假的内置“常量”的编程语言。然而，设立它们是大势所趋。本建议基于 ABAP Programming Guidelines。</p> </blockquote> <h3 id=xsdbool>使用 XSDBOOL 设置布尔变量<a class=headerlink href=#xsdbool title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#booleans>布尔值</a> &gt; <a href=#use-xsdbool-to-set-boolean-variables>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>has_entries</span><span class=p>)</span> <span class=o>=</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>line</span> <span class=ow>IS NOT INITIAL</span> <span class=p>).</span>
</code></pre></div> <p>等效的 <code>IF</code>-<code>THEN</code>-<code>ELSE</code> 除了长得多之外，别无它用：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>line</span> <span class=ow>IS INITIAL</span><span class=p>.</span>
  <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_false</span><span class=p>.</span>
<span class=k>ELSE</span><span class=p>.</span>
  <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <p><code>xsdbool</code> 是最合乎本来目的的方法，因为它直接产生 <code>char1</code>，该类型最适合布尔类型 <code>abap_bool</code>。等效函数 <code>boolc</code> 和 <code>boolx</code> 会产生不同的类型并增加不必要的隐式类型转换。</p> <p>我们同意名称 <code>xsdbool</code> 不巧会产生误导；毕竟，我们对 "xsd" 前缀暗示的 "XML Schema Definition" 部分毫无兴趣。</p> <p><code>xsdbool</code> 的一种可行的备选方案是 <code>COND</code> 三元形式。其语法直接明了，但是有点长，因为它会不必要地重复 <code>THEN abap_true</code> 段，而且还需要知道隐式缺省值 <code>abap_false</code> - 这就是为什么我们建议只将其作为第二解决方案。</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>has_entries</span><span class=p>)</span> <span class=o>=</span> <span class=nv>COND</span> <span class=nv>abap_bool</span><span class=p>(</span> <span class=k>WHEN</span> <span class=nv>line</span> <span class=ow>IS NOT INITIAL</span> <span class=nv>THEN</span> <span class=nv>abap_true</span> <span class=p>).</span>
</code></pre></div> <h2 id=_42>条件<a class=headerlink href=#_42 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#conditions>本节</a></p> </blockquote> <h3 id=_43>尽量使条件为正<a class=headerlink href=#_43 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#conditions>条件</a> &gt; <a href=#try-to-make-conditions-positive>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
</code></pre></div> <p>反之，比较时看看同样的语句会变得多难理解：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>has_no_entries</span> <span class=o>=</span> <span class=nv>abap_false</span><span class=p>.</span>
</code></pre></div> <p>节标题中的“尽量”意味着事先不用强行这样做，直到在某一点要以诸如<a href=#no-empty-if-branches>空的 IF 分支</a>之类的语句结束时才应如此：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
<span class=k>ELSE</span><span class=p>.</span>
  <span class=c1>&quot; only do something in the ELSE block, IF remains empty</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 17: Smells and Heuristics: G29: Avoid Negative Conditionals</em>。</p> </blockquote> <h3 id=is-not-not-is>IS NOT 优于 NOT IS<a class=headerlink href=#is-not-not-is title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#conditions>条件</a> &gt; <a href=#prefer-is-not-to-not-is>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>variable</span> <span class=ow>IS NOT INITIAL</span><span class=p>.</span>
<span class=k>IF</span> <span class=nv>variable</span> <span class=ow>NP</span> <span class=s1>&#39;TODO*&#39;</span><span class=p>.</span>
<span class=k>IF</span> <span class=nv>variable</span> <span class=o>&lt;&gt;</span> <span class=mi>42</span><span class=p>.</span>
</code></pre></div> <p>否定在逻辑上是等效的，但需要“脑筋转弯”，从而加大了理解难度。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=ow>NOT</span> <span class=nv>variable</span> <span class=ow>IS INITIAL</span><span class=p>.</span>
<span class=k>IF</span> <span class=ow>NOT</span> <span class=nv>variable</span> <span class=ow>CP</span> <span class=s1>&#39;TODO*&#39;</span><span class=p>.</span>
<span class=k>IF</span> <span class=ow>NOT</span> <span class=nv>variable</span> <span class=o>=</span> <span class=mi>42</span><span class=p>.</span>
</code></pre></div> <blockquote> <p><a href=#try-to-make-conditions-positive>尽量使条件为正</a>的一个更加具体的变化形式。另请参见 ABAP programming guidelines 中的 <a href="https://help.sap.com/doc/abapdocu_753_index_htm/7.53/en-US/index.htm?file=abenalternative_langu_guidl.htm">Alternative Language Constructs</a> 一节。</p> </blockquote> <h3 id=_44>考虑分解复杂条件<a class=headerlink href=#_44 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#conditions>条件</a> &gt; <a href=#consider-decomposing-complex-conditions>本节</a></p> </blockquote> <p>将条件分解成若干基本组成部分，条件就会变得更加简单：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>example_provided</span><span class=p>)</span> <span class=o>=</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>example_a</span> <span class=ow>IS NOT INITIAL</span> <span class=ow>OR</span>
                                  <span class=nv>example_b</span> <span class=ow>IS NOT INITIAL</span> <span class=p>).</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>one_example_fits</span><span class=p>)</span> <span class=o>=</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>applies</span><span class=p>(</span> <span class=nv>example_a</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=ow>OR</span>
                                  <span class=nv>applies</span><span class=p>(</span> <span class=nv>example_b</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=ow>OR</span>
                                  <span class=nv>fits</span><span class=p>(</span> <span class=nv>example_b</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=p>).</span>

<span class=k>IF</span> <span class=nv>example_provided</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=ow>AND</span>
   <span class=nv>one_example_fits</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
</code></pre></div> <p>而不是全都掺和在一起：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=p>(</span> <span class=nv>example_a</span> <span class=ow>IS NOT INITIAL</span> <span class=ow>OR</span>
     <span class=nv>example_b</span> <span class=ow>IS NOT INITIAL</span> <span class=p>)</span> <span class=ow>AND</span>
   <span class=p>(</span> <span class=nv>applies</span><span class=p>(</span> <span class=nv>example_a</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=ow>OR</span>
     <span class=nv>applies</span><span class=p>(</span> <span class=nv>example_b</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=ow>OR</span>
     <span class=nv>fits</span><span class=p>(</span> <span class=nv>example_b</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=p>).</span>
</code></pre></div> <blockquote> <p>使用 ABAP 开发工具的快速修复功能，可以很快提取条件并创建如上所示的变量。</p> </blockquote> <h3 id=_45>考虑提炼复杂条件<a class=headerlink href=#_45 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#conditions>条件</a> &gt; <a href=#consider-extracting-complex-conditions>本节</a></p> </blockquote> <p>将复杂条件提炼成各自的方法是一个好主意：</p> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>is_provided</span><span class=p>(</span> <span class=nv>example</span> <span class=p>).</span>

<span class=k>METHOD</span> <span class=nf>is_provided</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>is_filled</span><span class=p>)</span> <span class=o>=</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>example</span> <span class=ow>IS NOT INITIAL</span> <span class=p>).</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>is_working</span><span class=p>)</span> <span class=o>=</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>applies</span><span class=p>(</span> <span class=nv>example</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=ow>OR</span>
                              <span class=nv>fits</span><span class=p>(</span> <span class=nv>example</span> <span class=p>)</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=p>).</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>is_filled</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=ow>AND</span>
                    <span class=nv>is_working</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h2 id=if>If 语句<a class=headerlink href=#if title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#ifs>本节</a></p> </blockquote> <h3 id=if_1>无空的 IF 分支<a class=headerlink href=#if_1 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#ifs>If 语句</a> &gt; <a href=#no-empty-if-branches>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_false</span><span class=p>.</span>
  <span class=c1>&quot; do some magic</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <p>更加简明，好于</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
<span class=k>ELSE</span><span class=p>.</span>
  <span class=c1>&quot; do some magic</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <h3 id=case-else-if>对于多个备选条件，CASE 优于 ELSE IF<a class=headerlink href=#case-else-if title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#ifs>If 语句</a> &gt; <a href=#prefer-case-to-else-if-for-multiple-alternative-conditions>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CASE</span> <span class=nv>type</span><span class=p>.</span>
  <span class=k>WHEN</span> <span class=nv>type</span><span class=o>-</span><span class=nv>some_type</span><span class=p>.</span>
    <span class=c1>&quot; ...</span>
  <span class=k>WHEN</span> <span class=nv>type</span><span class=o>-</span><span class=nv>some_other_type</span><span class=p>.</span>
    <span class=c1>&quot; ...</span>
  <span class=k>WHEN</span> <span class=k>OTHERS</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>unknown_type_failure</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDCASE</span><span class=p>.</span>
</code></pre></div> <p>采用 <code>CASE</code> 更容易看出来是一组互斥的选择。它比一连串 <code>IF</code> 执行起来更快，因为它可以转化为另一种不同的微处理器命令，而不是一连串顺序评估的条件。不必到处重复判别变量，就可以快速引入新的情况。该语句甚至可以防止无意中嵌套 <code>IF</code>-<code>ELSEIF</code> 时可能出现的一些错误。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>type</span> <span class=o>=</span> <span class=nv>type</span><span class=o>-</span><span class=nv>some_type</span><span class=p>.</span>
  <span class=c1>&quot; ...</span>
<span class=k>ELSEIF</span> <span class=nv>type</span> <span class=o>=</span> <span class=nv>type</span><span class=o>-</span><span class=nv>some_other_type</span><span class=p>.</span>
  <span class=c1>&quot; ...</span>
<span class=k>ELSE</span><span class=p>.</span>
  <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>unknown_type_failure</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <h3 id=_46>保持低嵌套深度<a class=headerlink href=#_46 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#ifs>If 语句</a> &gt; <a href=#keep-the-nesting-depth-low>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; ani-pattern</span>
<span class=k>IF</span> <span class=nv>&lt;this&gt;</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>&lt;that&gt;</span><span class=p>.</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ELSE</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>&lt;other&gt;</span><span class=p>.</span>
  <span class=k>ELSE</span><span class=p>.</span>
    <span class=k>IF</span> <span class=nv>&lt;something&gt;</span><span class=p>.</span>
    <span class=k>ENDIF</span><span class=p>.</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <p>嵌套的 <code>IF</code> 不仅难于快速理解，而且需要指数级的测试用例才能完全覆盖。</p> <p>通常可以通过形成子方法并引入辅助布尔变量来拆分决策树。</p> <p>其他情况可以通过合并 IF 进行简化，比如</p> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>&lt;this&gt;</span> <span class=ow>AND</span> <span class=nv>&lt;that&gt;</span><span class=p>.</span>
</code></pre></div> <p>而不是毫无必要地嵌套</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>&lt;this&gt;</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>&lt;that&gt;</span><span class=p>.</span>
</code></pre></div> <h2 id=_47>正则表达式<a class=headerlink href=#_47 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#regular-expressions>本节</a></p> </blockquote> <h3 id=_48>较简单的方法优于正则表达式<a class=headerlink href=#_48 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#regular-expressions>正则表达式</a> &gt; <a href=#prefer-simpler-methods-to-regular-expressions>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>IF</span> <span class=nv>input</span> <span class=ow>IS NOT INITIAL</span><span class=p>.</span>
<span class=c1>&quot; IF matches( val = input  regex = &#39;.+&#39; ).</span>

<span class=k>WHILE</span> <span class=nv>contains</span><span class=p>(</span> <span class=nv>val</span> <span class=o>=</span> <span class=nv>input</span>  <span class=nv>sub</span> <span class=o>=</span> <span class=s1>&#39;abc&#39;</span> <span class=p>).</span>
<span class=c1>&quot; WHILE contains( val = input  regex = &#39;abc&#39; ).</span>
</code></pre></div> <p>正则表达式难以快速理解。没有它们，简单情况通常反而更加容易。</p> <p>正则表达式通常也会消耗更多内存和处理时间，因为需要将其解析成表达式树并在运行时编译成可执行的匹配程序。直接使用循环和临时变量，简单就可以解决。</p> <h3 id=_49>基本检查优于正则表达式<a class=headerlink href=#_49 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#regular-expressions>正则表达式</a> &gt; <a href=#prefer-basis-checks-to-regular-expressions>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CALL FUNCTION</span> <span class=s1>&#39;SEO_CLIF_CHECK_NAME&#39;</span>
  <span class=k>EXPORTING</span>
    <span class=nv>cls_name</span> <span class=o>=</span> <span class=nv>class_name</span>
  <span class=k>EXCEPTIONS</span>
    <span class=p>...</span>
</code></pre></div> <p>而不用费事改成</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>is_valid</span><span class=p>)</span> <span class=o>=</span> <span class=nv>matches</span><span class=p>(</span> <span class=nv>val</span>     <span class=o>=</span> <span class=nv>class_name</span>
                          <span class=nv>pattern</span> <span class=o>=</span> <span class=s1>&#39;[A-Z][A-Z0-9_]{0,29}&#39;</span> <span class=p>).</span>
</code></pre></div> <blockquote> <p>当正则表达式无处不在时，，对不重复自己 (DRY) 的原则视而不见似乎变成一种自然的倾向，请对照 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 17: Smells and Heuristics: General: G5: Duplication</em>。</p> </blockquote> <h3 id=_50>考虑汇集复杂的正则表达式<a class=headerlink href=#_50 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#regular-expressions>正则表达式</a> &gt; <a href=#consider-assembling-complex-regular-expressions>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CONSTANTS</span> <span class=nv>class_name</span> <span class=k>TYPE </span><span class=nv>string</span> <span class=k>VALUE</span> <span class=s1>`CL\_.*`</span><span class=p>.</span>
<span class=k>CONSTANTS</span> <span class=nv>interface_name</span> <span class=k>TYPE </span><span class=nv>string</span> <span class=k>VALUE</span> <span class=s1>`IF\_.*`</span><span class=p>.</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>object_name</span><span class=p>)</span> <span class=o>=</span> <span class=p>|{</span> <span class=nv>class_name</span> <span class=p>}</span><span class=s1>\</span><span class=p>|</span><span class=err>{</span> <span class=nv>interface_name</span> <span class=p>}|.</span>
</code></pre></div> <p>有一些复杂的正则表达式，当您向读者展示它们是如何从更基本的片段构成时，就会变得更加容易。</p> <h2 id=_51>类<a class=headerlink href=#_51 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>本节</a></p> </blockquote> <h3 id=_52>类：面向对象<a class=headerlink href=#_52 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#classes-object-orientation>本节</a></p> </blockquote> <h4 id=_53>对象优于静态类<a class=headerlink href=#_53 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#classes-object-orientation>类：面向对象</a> &gt; <a href=#prefer-objects-to-static-classes>本节</a></p> </blockquote> <p>首先，静态类失去了面向对象所具备的全部优势。特别是，有了它们，几乎无法在单元测试中用测试替身替换生产中的相关依赖。</p> <p>如果您在考虑是否该使类或方法变成静态的，答案几乎总是：不。</p> <p>对于这条规则，有一种例外情况可以接受，那就是简单的实用工具类。其方法使其更容易与某些 ABAP 类型进行交互。它们不仅完全无态，而且相当初级，看起来就像是 ABAP 语句或内置函数。辨别因素是，其调用 者会将它们紧紧捆绑到各自的代码中，从而真的没法在单元测试中对其进行模拟。</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>string_utils</span> <span class=k>DEFINITION</span> <span class=p>[...].</span>
  <span class=k>CLASS-METHODS</span> <span class=nv>trim</span>
   <span class=k>IMPORTING</span>
     <span class=nv>string</span>        <span class=k>TYPE </span><span class=nv>string</span>
   <span class=k>RETURNING</span>
     <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>string</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>retrieve</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>trimmed_name</span><span class=p>)</span> <span class=o>=</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>string_utils</span><span class=o>=&gt;</span><span class=nf>trim</span><span class=p>(</span> <span class=nv>name</span> <span class=p>).</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=k>read</span><span class=p>(</span> <span class=nv>trimmed_name</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h4 id=_54>组合优于继承<a class=headerlink href=#_54 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#classes-object-orientation>类：面向对象</a> &gt; <a href=#prefer-composition-to-inheritance>本节</a></p> </blockquote> <p>避免构建具有继承性的类层次结构，应该选择组合。</p> <p>很难设计出完美的继承，因为需要遵守规则，如 <a href=https://en.wikipedia.org/wiki/Liskov_substitution_principle>Liskov substitution principle</a>。另外，也很难理解，因为人们需要认识并领会层次结构背后的指导原则。继承会降低重用性，因为方法往往仅对子类才可用。它还会使重构复杂化，因为移动或更改成员往往需要对整个层次结构树进行更改。</p> <p>组合意味着要设计小的独立对象，每个对象只服务于一个特定目的。通过简单的代理和外观模式，就可以将这些对象重新组合成更复杂的对象。组合可能会产生更多的类，但除此之外再无其他缺点。</p> <p>莫因这条规则而丧失在恰当之处使用继承的信心。有一些应用场合很适合使用继承，例如，<a href=https://en.wikipedia.org/wiki/Composite_pattern>Composite design pattern</a>。只需中肯地问问自己，在所处情况下，继承是否确实利大于弊。如有怀疑，一般来说，选择组合更稳妥。</p> <blockquote> <p><a href=sub-sections/InterfacesVsAbstractClasses>Interfaces vs. abstract classes</a> 对此做了一些详细比较。</p> </blockquote> <h4 id=_55>勿在同一个类中混用有态和无态<a class=headerlink href=#_55 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#classes-object-orientation>类：面向对象</a></p> </blockquote> <p>不要在同一个类中混用无态和有态编程范式。</p> <p>在无态编程中，方法获取输入并产生输出，<em>而不会有任何副作用</em>，因此无论何时、以何顺序调用，方法都会产生相同的结果。</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>xml_converter</span> <span class=k>DEFINITION</span> <span class=k>PUBLIC</span> <span class=nv>FINAL</span> <span class=k>CREATE PUBLIC</span><span class=p>.</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>METHODS</span> <span class=nv>convert</span>
      <span class=k>IMPORTING</span>
        <span class=nv>file_content</span>  <span class=k>TYPE </span><span class=nv>xstring</span>
      <span class=k>RETURNING</span>
        <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_inbound_message</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>

<span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>xml_converter</span> <span class=k>IMPLEMENTATION</span><span class=p>.</span>
  <span class=k>METHOD</span> <span class=nf>convert</span><span class=p>.</span>
    <span class=nv>cl_proxy_xml_transform</span><span class=o>=&gt;</span><span class=nf>xml_xstring_to_abap</span><span class=p>(</span>
      <span class=k>EXPORTING</span>
        <span class=nv>xml</span>       <span class=o>=</span> <span class=nv>file_content</span>
        <span class=nv>ext_xml</span>   <span class=o>=</span> <span class=nv>abap_true</span>
        <span class=nv>svar_name</span> <span class=o>=</span> <span class=s1>&#39;ROOT_NODE&#39;</span>
      <span class=k>IMPORTING</span>
        <span class=nv>abap_data</span> <span class=o>=</span> <span class=nv>result</span> <span class=p>).</span>
   <span class=k>ENDMETHOD</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <p>在有态编程中，通过对象的方法操控其内部状态，这意味着_满是副作用_。</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>log</span> <span class=k>DEFINITION</span> <span class=k>PUBLIC</span> <span class=k>CREATE PUBLIC</span><span class=p>.</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>METHODS</span> <span class=nv>add_message</span> <span class=k>IMPORTING</span> <span class=k>message</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>message</span><span class=p>.</span>
  <span class=k>PRIVATE SECTION</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>messages</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>message_table</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>

<span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>log</span> <span class=k>IMPLEMENTATION</span><span class=p>.</span>
  <span class=k>METHOD</span> <span class=nf>add_message</span><span class=p>.</span>
    <span class=k>INSERT</span> <span class=k>message</span> <span class=k>INTO</span> <span class=k>TABLE</span> <span class=nv>messages</span><span class=p>.</span>
  <span class=k>ENDMETHOD</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <p>两种范式都不错，有各自的应用场合。然而，在同一个对象中_混用_会使代码难以理解，并且由于携带着的隐蔽错误以及同步性问题，注定会失败。切勿这样做。</p> <h3 id=_56>作用域<a class=headerlink href=#_56 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#scope>本节</a></p> </blockquote> <h4 id=_57>缺省情况下为全局，仅在适当位置为局部<a class=headerlink href=#_57 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#scope>作用域</a> &gt; <a href=#global-by-default-local-only-where-appropriate>本节</a></p> </blockquote> <p>默认情况下运用全局类。只有在适当位置使用局部类。</p> <blockquote> <p>全局类在数据字典中可见。局部类存在于另一个开发对象的 include 内，仅对这个另外的对象可见。</p> </blockquote> <p>局部类适用</p> <ul> <li> <p>用于非常特定的私有数据结构，例如全局类数据的迭代器，仅此处需要这些数据结构，</p> </li> <li> <p>用于提取复杂的私有部分算法，例如从其余类代码算法中提取出特殊用途的多方法的排序聚合算法，</p> </li> <li> <p>用于模拟全局类的特定方面，例如，通过将所有数据库访问提取到可在单元测试中使用测试替身替换的单独局部类。</p> </li> </ul> <p>局部类将阻碍重用，因为它们无法在其他位置使用。尽管局部类易于提取，但人们通常甚至无法找到它们，从而导致不希望的代码重复。在极长的局部类中进行定向、导航和调试非常乏味且令人讨厌。由于 ABAP 锁是在包含文件级别上的，人们将无法同时在本地包含文件的不同部分上工作（只有在它们是不同的全局类的情况下，才能执行此操作）。</p> <p>在以下情况下，重新考虑局部类的使用：</p> <ul> <li>您的本地包含文件可以包含数十个类和数千行代码，</li> <li>您将全局类视为包含其他类的“包”，</li> <li>您的全局类退化为空壳，</li> <li>您发现单独的本地包含文件中有重复代码，</li> <li>您的开发人员开始互相锁定，无法并行工作，</li> <li>由于您的团队无法理解彼此的本地子树，因此您的工作项估计会变得很多。</li> </ul> <h4 id=final>若非为继承而设计则为 FINAL<a class=headerlink href=#final title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#scope>作用域</a> &gt; <a href=#final-if-not-designed-for-inheritance>本节</a></p> </blockquote> <p>将并非针对继承而明确设计的类构建为 <code>FINAL</code>。</p> <p>在设计类的合作能力时，您的首选应该是<a href=#prefer-composition-to-inheritance>组合而不是继承</a>。实现继承不是一件容易的事，因为需要您考虑 <code>PROTECTED</code> 与 <code>PRIVATE</code> 等属性以及 <a href=https://en.wikipedia.org/wiki/Liskov_substitution_principle>Liskov substitution principle</a>，并且冻结了许多设计内部功能。如果您在类设计中没有考虑这些问题，那么应该通过将类构建为 <code>FINAL</code> 来防止意外继承。</p> <p>当然，继承_有_一些很好的应用程序，例如设计模式<a href=https://en.wikipedia.org/wiki/Composite_pattern>复合</a>。通过允许使用子类，业务加载项也可以变得更加有用，客户能够重用大多数原始代码。但是，请注意，所有这些情况下，从一开始就通过设计内置了继承。</p> <p>未<a href=#public-instance-methods-should-be-part-of-an-interface>实施接口</a>的不整洁类应保持非 <code>FINAL</code>，这样使用者才能在单元测试中对其进行模拟。</p> <h4 id=private-protected>缺省情况下为 PRIVATE，仅在需要时为 PROTECTED<a class=headerlink href=#private-protected title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#scope>作用域</a> &gt; <a href=#members-private-by-default-protected-only-if-needed>本节</a></p> </blockquote> <p>默认情况下，将属性、方法和其他类成员设置为 <code>PRIVATE</code>。</p> <p>只有在您要启用子类覆盖它们时才将它们设置为 <code>PROTECTED</code>。</p> <p>只有需要的情况下，才应让类的内部元素供其他成员或程序使用。这不仅包括外部调用者，还包括子类。信息过度可用可能会因意外重新定义而导致细微错误，并阻碍重构，因为外部调用将冻结原本应流动的成员。</p> <h4 id=getter>考虑使用不可变对象而非 getter<a class=headerlink href=#getter title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#scope>作用域</a> &gt; <a href=#consider-using-immutable-instead-of-getter>本节</a></p> </blockquote> <p>不可变对象是在构造后永不改变的对象。对于此类对象，请考虑使用公有只读属性而不是 getter 方法。</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_data_container</span> <span class=k>DEFINITION</span><span class=p>.</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>METHODS</span> <span class=nv>constructor</span>
      <span class=k>IMPORTING</span>
        <span class=nv>a</span> <span class=k>TYPE </span><span class=nv>i</span>
        <span class=nv>b</span> <span class=k>TYPE </span><span class=nv>c</span>
        <span class=nv>c</span> <span class=k>TYPE </span><span class=nv>d</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>a</span> <span class=k>TYPE </span><span class=nv>i</span> <span class=k>READ</span><span class=o>-</span><span class=nv>ONLY</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>b</span> <span class=k>TYPE </span><span class=nv>c</span> <span class=k>READ</span><span class=o>-</span><span class=nv>ONLY</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>c</span> <span class=k>TYPE </span><span class=nv>d</span> <span class=k>READ</span><span class=o>-</span><span class=nv>ONLY</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <p>而不是</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>some_data_container</span> <span class=k>DEFINITION</span><span class=p>.</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>METHODS</span> <span class=nv>get_a</span> <span class=p>...</span>
    <span class=k>METHODS</span> <span class=nv>get_b</span> <span class=p>...</span>
    <span class=k>METHODS</span> <span class=nv>get_c</span> <span class=p>...</span>
  <span class=k>PRIVATE SECTION</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>a</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>b</span> <span class=k>TYPE </span><span class=nv>c</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>c</span> <span class=k>TYPE </span><span class=nv>d</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <blockquote> <p><strong>警告</strong>：对于**具有**变化值的对象，请勿使用公有只读属性。否则，此属性必须始终保持最新状态，无论其他任何代码是否需要它们的值。</p> </blockquote> <h4 id=read-only>保守地使用 READ-ONLY<a class=headerlink href=#read-only title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#scope>作用域</a> &gt; <a href=#use-read-only-sparingly>本节</a></p> </blockquote> <p>许多现代编程语言（尤其是 Java）建议尽量将类成员设置为只读，以防止产生意外的不良影响。</p> <p>尽管 ABAP _确实_为数据声明提供了 <code>READ-ONLY</code> 加载项，但我们建议您谨慎使用。</p> <p>首先，仅在 <code>PUBLIC SECTION</code> 中提供了加载项，从而大大降低了其适用范围。您既不能将其添加到受保护的成员或私有成员，也不能将其添加到方法中的局部变量。</p> <p>其次，加载项的执行结果与人们对其他编程语言的期望行为略有不同：仍然可以通过类本身、其友元类及其子类中的任何方法自由地修改 READ-ONLY 数据。这与其他语言中普遍采用的“一次写入，永远不会修改”行为相矛盾。这种差异可能会导致令人惊讶的意外。</p> <blockquote> <p>为了避免误解：保护变量以防意外修改是一种很好的做法。如果是一个合适的语句，我们也建议将其应用于 ABAP中。</p> </blockquote> <h3 id=_58>构造函数<a class=headerlink href=#_58 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#constructors>本节</a></p> </blockquote> <h4 id=new-create-object>NEW 优于 CREATE OBJECT<a class=headerlink href=#new-create-object title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#constructors>构造函数</a> &gt; <a href=#prefer-new-to-create-object>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=k>object</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_number_range</span><span class=p>.</span>
<span class=k>object</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=err>#</span><span class=p>(</span> <span class=s1>&#39;/CLEAN/CXTGEN&#39;</span> <span class=p>)</span>
<span class=p>...</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>object</span><span class=p>)</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_number_range</span><span class=p>(</span> <span class=s1>&#39;/CLEAN/CXTGEN&#39;</span> <span class=p>).</span>
<span class=p>...</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>object</span><span class=p>)</span> <span class=o>=</span> <span class=nv>CAST</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>number_range</span><span class=p>(</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_number_range</span><span class=p>(</span> <span class=s1>&#39;/CLEAN/CXTGEN&#39;</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span> <span class=k>object</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>some_number_range</span><span class=p>.</span>
<span class=k>CREATE OBJECT</span> <span class=k>object</span>
  <span class=k>EXPORTING</span>
    <span class=nv>number_range</span> <span class=o>=</span> <span class=s1>&#39;/DIRTY/CXTGEN&#39;</span><span class=p>.</span>
</code></pre></div> <p>当然，除非需要动态类型</p> <div class=highlight><pre><span></span><code><span class=k>CREATE OBJECT</span> <span class=nv>number_range</span> <span class=nv>TYPE</span> <span class=p>(</span><span class=nv>dynamic_type</span><span class=p>)</span>
  <span class=k>EXPORTING</span>
    <span class=nv>number_range</span> <span class=o>=</span> <span class=s1>&#39;/CLEAN/CXTGEN&#39;</span><span class=p>.</span>
</code></pre></div> <h4 id=create-private-constructor>如果全局类为 CREATE PRIVATE，则保留 CONSTRUCTOR 为公有<a class=headerlink href=#create-private-constructor title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#constructors>构造函数</a> &gt; <a href=#if-your-global-class-is-create-private-leave-the-constructor-public>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_api</span> <span class=k>DEFINITION</span> <span class=k>PUBLIC</span> <span class=nv>FINAL</span> <span class=k>CREATE PRIVATE</span><span class=p>.</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>METHODS</span> <span class=nv>constructor</span><span class=p>.</span>
</code></pre></div> <p>我们同意这是自相矛盾的。但根据文章 <a href=https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/abeninstance_constructor_guidl.htm>ABAP 帮助的 <em>Instance Constructor</em></a>，需要在 <code>PUBLIC SECTION</code> 中指定 <code>CONSTRUCTOR</code> 以确保正确的编译和语法验证。</p> <p>这仅适用于全局类。在局部类中，应将构造函数设置为私有。</p> <h4 id=_59>多个静态创建方法优于可选参数<a class=headerlink href=#_59 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#constructors>构造函数</a> &gt; <a href=#prefer-multiple-static-factory-methods-to-optional-parameters>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CLASS-METHODS</span> <span class=nv>describe_by_data</span> <span class=k>IMPORTING</span> <span class=k>data</span> <span class=k>TYPE </span><span class=nv>any</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>describe_by_name</span> <span class=k>IMPORTING</span> <span class=nv>name</span> <span class=k>TYPE </span><span class=nv>any</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>describe_by_object_ref</span> <span class=k>IMPORTING</span> <span class=nv>object_ref</span> <span class=k>TYPE REF TO</span> <span class=k>object</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>describe_by_data_ref</span> <span class=k>IMPORTING</span> <span class=nv>data_ref</span> <span class=k>TYPE REF TO</span> <span class=k>data</span> <span class=p>[...]</span>
</code></pre></div> <p>ABAP 不支持<a href=https://en.wikipedia.org/wiki/Function_overloading>过载</a>。使用名称变式而不是可选参数来实现所需的语义。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>constructor</span>
  <span class=k>IMPORTING</span>
    <span class=k>data</span>       <span class=k>TYPE </span><span class=nv>any</span> <span class=nv>OPTIONAL</span>
    <span class=nv>name</span>       <span class=k>TYPE </span><span class=nv>any</span> <span class=nv>OPTIONAL</span>
    <span class=nv>object_ref</span> <span class=k>TYPE REF TO</span> <span class=k>object</span> <span class=nv>OPTIONAL</span>
    <span class=nv>data_ref</span>   <span class=k>TYPE REF TO</span> <span class=k>data</span> <span class=nv>OPTIONAL</span>
  <span class=p>[...]</span>
</code></pre></div> <p><a href=#split-methods-instead-of-adding-optional-parameters><em>拆分方法而非添加 OPTIONAL 参数</em></a>通用指南介绍了根本原因。</p> <p>考虑使用<a href=https://en.wikipedia.org/wiki/Builder_pattern>构建器设计模式</a>将复杂构造解析为多步构造。</p> <h4 id=_60>用描述性名称表示多个创建方法<a class=headerlink href=#_60 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#constructors>构造函数</a> &gt; <a href=#use-descriptive-names-for-multiple-creation-methods>本节</a></p> </blockquote> <p>用于创建方法的有效单词为 <code>new_</code>、<code>create_</code> 和 <code>construct_</code>。人们凭直觉就可以将它们与对象构造联系起来。还可以将这些单词连用构成动词短语，如 <code>new_from_template</code>、<code>create_as_copy</code> 或 <code>create_by_name</code>。</p> <div class=highlight><pre><span></span><code><span class=k>CLASS-METHODS</span> <span class=nv>new_describe_by_data</span> <span class=k>IMPORTING</span> <span class=nv>p_data</span> <span class=k>TYPE </span><span class=nv>any</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>new_describe_by_name</span> <span class=k>IMPORTING</span> <span class=nv>p_name</span> <span class=k>TYPE </span><span class=nv>any</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>new_describe_by_object_ref</span> <span class=k>IMPORTING</span> <span class=nv>p_object_ref</span> <span class=k>TYPE REF TO</span> <span class=k>object</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>new_describe_by_data_ref</span> <span class=k>IMPORTING</span> <span class=nv>p_data_ref</span> <span class=k>TYPE REF TO</span> <span class=k>data</span> <span class=p>[...]</span>
</code></pre></div> <p>而不是无意义的名称，例如</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>CLASS-METHODS</span> <span class=nv>create_1</span> <span class=k>IMPORTING</span> <span class=nv>p_data</span> <span class=k>TYPE </span><span class=nv>any</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>create_2</span> <span class=k>IMPORTING</span> <span class=nv>p_name</span> <span class=k>TYPE </span><span class=nv>any</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>create_3</span> <span class=k>IMPORTING</span> <span class=nv>p_object_ref</span> <span class=k>TYPE REF TO</span> <span class=k>object</span> <span class=p>[...]</span>
<span class=k>CLASS-METHODS</span> <span class=nv>create_4</span> <span class=k>IMPORTING</span> <span class=nv>p_data_ref</span> <span class=k>TYPE REF TO</span> <span class=k>data</span> <span class=p>[...]</span>
</code></pre></div> <h4 id=_61>仅在多实例无意义的情况下变成单例<a class=headerlink href=#_61 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#classes>类</a> &gt; <a href=#constructors>构造函数</a> &gt; <a href=#make-singletons-only-where-multiple-instances-dont-make-sense>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>new</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>singleton</span> <span class=ow>IS NOT BOUND</span><span class=p>.</span>
    <span class=nv>singleton</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>my_class</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ENDIF</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>singleton</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>在您的面向对象的设计中提到第二个实例没有意义的情况下应用单例模式。该模式可确保每个使用者都以相同的状态和相同的数据处理相同的内容。</p> <p>不要出于习惯或者因为某些性能规则的评分而使用单例模式。该模式最容易被过度使用和错误应用，这会产生意想不到的交叉影响，并为测试增加不必要的复杂性。如果单一对象没有设计驱动原因，可由使用者自己做决定，他仍然可以通过构造函数之外的方式（例如使用工厂）达到相同目的。</p> <h2 id=_62>方法<a class=headerlink href=#_62 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>本节</a></p> </blockquote> <p>这些规则可应用于类和功能模块中的方法。</p> <h3 id=_63>调用<a class=headerlink href=#_63 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#calls>本节</a></p> </blockquote> <h4 id=_64>函数式调用优于过程式调用<a class=headerlink href=#_64 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#calls>调用</a> &gt; <a href=#prefer-functional-to-procedural-calls>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>modify</span><span class=o>-&gt;</span><span class=nf>update</span><span class=p>(</span> <span class=nv>node</span>           <span class=o>=</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>my_bo_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
                <span class=k>key</span>            <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
                <span class=k>data</span>           <span class=o>=</span> <span class=nv>item</span>
                <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>CALL METHOD</span> <span class=k>modify</span><span class=o>-&gt;</span><span class=nv>update</span>
  <span class=k>EXPORTING</span>
    <span class=nv>node</span>           <span class=o>=</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>my_bo_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
    <span class=k>key</span>            <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
    <span class=k>data</span>           <span class=o>=</span> <span class=nv>item</span>
    <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span><span class=p>.</span>
</code></pre></div> <p>如果动态类型禁止函数调用，请使用过程式调用</p> <div class=highlight><pre><span></span><code><span class=k>CALL METHOD</span> <span class=k>modify</span><span class=o>-&gt;</span><span class=p>(</span><span class=nv>method_name</span><span class=p>)</span>
  <span class=k>EXPORTING</span>
    <span class=nv>node</span>           <span class=o>=</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>my_bo_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
    <span class=k>key</span>            <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
    <span class=k>data</span>           <span class=o>=</span> <span class=nv>item</span>
    <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span><span class=p>.</span>
</code></pre></div> <p>以下许多详细规则只是此建议的更具体变式。</p> <h4 id=receiving>省略 RECEIVING<a class=headerlink href=#receiving title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#calls>调用</a> &gt; <a href=#omit-receiving>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>aggregate_values</span><span class=p>(</span> <span class=k>values</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>aggregate_values</span><span class=p>(</span>
  <span class=k>EXPORTING</span>
    <span class=k>values</span> <span class=o>=</span> <span class=k>values</span>
  <span class=nv>RECEIVING</span>
    <span class=nv>result</span> <span class=o>=</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=p>).</span>
</code></pre></div> <h4 id=exporting>省略可选关键字 EXPORTING<a class=headerlink href=#exporting title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#calls>调用</a> &gt; <a href=#omit-the-optional-keyword-exporting>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>modify</span><span class=o>-&gt;</span><span class=nf>update</span><span class=p>(</span> <span class=nv>node</span>           <span class=o>=</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>my_bo_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
                <span class=k>key</span>            <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
                <span class=k>data</span>           <span class=o>=</span> <span class=nv>item</span>
                <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>modify</span><span class=o>-&gt;</span><span class=nf>update</span><span class=p>(</span>
  <span class=k>EXPORTING</span>
    <span class=nv>node</span>           <span class=o>=</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>my_bo_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
    <span class=k>key</span>            <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
    <span class=k>data</span>           <span class=o>=</span> <span class=nv>item</span>
    <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span> <span class=p>).</span>
</code></pre></div> <h4 id=_65>在单参数调用中省略参数名称<a class=headerlink href=#_65 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#calls>调用</a> &gt; <a href=#omit-the-parameter-name-in-single-parameter-calls>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>unique_list</span><span class=p>)</span> <span class=o>=</span> <span class=nv>remove_duplicates</span><span class=p>(</span> <span class=nv>list</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>unique_list</span><span class=p>)</span> <span class=o>=</span> <span class=nv>remove_duplicates</span><span class=p>(</span> <span class=nv>list</span> <span class=o>=</span> <span class=nv>list</span> <span class=p>).</span>
</code></pre></div> <p>但是，在某些情况下，仅方法名称还不够清楚，重复参数名称可能会更易于理解：</p> <div class=highlight><pre><span></span><code><span class=nv>car</span><span class=o>-&gt;</span><span class=nf>drive</span><span class=p>(</span> <span class=nv>speed</span> <span class=o>=</span> <span class=mi>50</span> <span class=p>).</span>
<span class=k>update</span><span class=p>(</span> <span class=nv>asynchronous</span> <span class=o>=</span> <span class=nv>abap_true</span> <span class=p>).</span>
</code></pre></div> <h4 id=me>在调用实例方法时省略自我引用 me<a class=headerlink href=#me title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#calls>调用</a> &gt; <a href=#omit-the-self-reference-me-when-calling-an-instance-method>本节</a></p> </blockquote> <p>由于自我引用 <code>me-&gt;</code> 是由系统隐式设置的，因此可在调用实例方法时将其省略</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>aggregate_values</span><span class=p>(</span> <span class=k>values</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>me</span><span class=o>-&gt;</span><span class=nf>aggregate_values</span><span class=p>(</span> <span class=k>values</span> <span class=p>).</span>
</code></pre></div> <h3 id=_66>方法：面向对象<a class=headerlink href=#_66 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#methods-object-orientation>本节</a></p> </blockquote> <h4 id=_67>实例优于静态方法<a class=headerlink href=#_67 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#methods-object-orientation>方法：面向对象</a> &gt; <a href=#prefer-instance-to-static-methods>本节</a></p> </blockquote> <p>缺省情况下，方法应为实例成员。实例方法可以更好地反映类的“对象本质”。在单元测试中可以更轻松地模拟这些方法。</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>publish</span><span class=p>.</span>
</code></pre></div> <p>方法仅在特殊情况下才是静态的，例如静态创建方法。</p> <div class=highlight><pre><span></span><code><span class=k>CLASS-METHODS</span> <span class=nv>create_instance</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>blog_post</span><span class=p>.</span>
</code></pre></div> <h4 id=_68>公共实例方法应为接口的一部分<a class=headerlink href=#_68 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#methods-object-orientation>方法：面向对象</a> &gt; <a href=#public-instance-methods-should-be-part-of-an-interface>本节</a></p> </blockquote> <p>公有实例方法应始终是接口的一部分。这样可以解耦相关性，并简化单元测试中的模拟过程。</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>blog_post~publish</span><span class=p>.</span>
</code></pre></div> <p>在面向整洁对象的方法中，公开没有接口的方法没有多大意义，枚举类等少数方法除外，这些方法永远不会有备选实施，也永远不会在测试用例中进行模拟。</p> <blockquote> <p><a href=sub-sections/InterfacesVsAbstractClasses>接口与抽象类</a>描述了为什么这也适用于覆盖继承方法的类。</p> </blockquote> <h3 id=_69>参数数目<a class=headerlink href=#_69 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-number>本节</a></p> </blockquote> <h4 id=importing>力图减少 IMPORTING 参数，最好少于三个<a class=headerlink href=#importing title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-number>参数数目</a> &gt; <a href=#aim-for-few-importing-parameters-at-best-less-than-three>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>FUNCTION</span> <span class=nv>seo_class_copy</span>
  <span class=k>IMPORTING</span>
    <span class=nv>clskey</span>      <span class=k>TYPE </span><span class=nv>seoclskey</span>
    <span class=nv>new_clskey</span>  <span class=k>TYPE </span><span class=nv>seoclskey</span>
    <span class=nv>config</span>      <span class=k>TYPE </span><span class=nv>class_copy_config</span>
  <span class=k>EXPORTING</span>
    <span class=p>...</span>
</code></pre></div> <p>整洁程度优于</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>FUNCTION</span> <span class=nv>seo_class_copy</span>
  <span class=k>IMPORTING</span>
    <span class=nv>clskey</span>                 <span class=k>TYPE </span><span class=nv>seoclskey</span>
    <span class=nv>new_clskey</span>             <span class=k>TYPE </span><span class=nv>seoclskey</span>
    <span class=nv>access_permission</span>      <span class=k>TYPE </span><span class=nv>seox_boolean</span> <span class=k>DEFAULT</span> <span class=nv>seox_true</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>save</span><span class=p>)</span>            <span class=k>TYPE </span><span class=nv>seox_boolean</span> <span class=k>DEFAULT</span> <span class=nv>seox_true</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>suppress_corr</span><span class=p>)</span>   <span class=k>TYPE </span><span class=nv>seox_boolean</span> <span class=k>DEFAULT</span> <span class=nv>seox_false</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>suppress_dialog</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>seox_boolean</span> <span class=k>DEFAULT</span> <span class=nv>seox_false</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>authority_check</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>seox_boolean</span> <span class=k>DEFAULT</span> <span class=nv>seox_true</span>
    <span class=nv>lifecycle_manager</span>      <span class=k>TYPE REF TO</span> <span class=nv>if_adt_lifecycle_manager</span> <span class=nv>OPTIONAL</span>
    <span class=nv>lock_handle</span>            <span class=k>TYPE REF TO</span> <span class=nv>if_adt_lock_handle</span> <span class=nv>OPTIONAL</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>suppress_commit</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>seox_boolean</span> <span class=k>DEFAULT</span> <span class=nv>seox_false</span>
  <span class=k>EXPORTING</span>
    <span class=p>...</span>
</code></pre></div> <p>输入参数过多会大幅增加方法的复杂性，因为方法需要处理指数级的组合。有多个参数就说明该方法做了超过一件事。</p> <p>您可以通过结构和对象将参数组合为有意义的集合，从而减少参数的数目。</p> <h4 id=optional>拆分方法而非添加 OPTIONAL 参数<a class=headerlink href=#optional title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-number>参数数目</a> &gt; <a href=#split-methods-instead-of-adding-optional-parameters>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>do_one_thing</span> <span class=k>IMPORTING</span> <span class=nv>what_i_need</span> <span class=k>TYPE </span><span class=nv>string</span><span class=p>.</span>
<span class=k>METHODS</span> <span class=nv>do_another_thing</span> <span class=k>IMPORTING</span> <span class=nv>something_else</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>
</code></pre></div> <p>为了实现ABAP不支持但又需要的语义<a href=https://en.wikipedia.org/wiki/Function_overloading>过载</a>。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>do_one_or_the_other</span>
  <span class=k>IMPORTING</span>
    <span class=nv>what_i_need</span>    <span class=k>TYPE </span><span class=nv>string</span> <span class=nv>OPTIONAL</span>
    <span class=nv>something_else</span> <span class=k>TYPE </span><span class=nv>i</span> <span class=nv>OPTIONAL</span><span class=p>.</span>
</code></pre></div> <p>可选参数使调用者感到困惑：</p> <ul> <li>真正需要哪些参数？</li> <li>哪些参数组合有效？</li> <li>哪些参数互相排斥？</li> </ul> <p>按特定的参数拆分成多个方法可以给人明确的指引，从而避免了这种混淆。</p> <h4 id=preferred-parameter>保守地使用 PREFERRED PARAMETER<a class=headerlink href=#preferred-parameter title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-number>参数数目</a> &gt; <a href=#use-preferred-parameter-sparingly>本节</a></p> </blockquote> <p>额外定义<code>PREFERRED PARAMETER</code> 让人很难知道实际需要提供什么样的参数，理解代码也变得更困难。将参数数目减至最少，尤其是可选参数的数目，可以自动减少对 <code>PREFERRED PARAMETER</code> 的需求。</p> <h4 id=returnexport-change>RETURN、EXPORT 或 CHANGE 恰有一个参数<a class=headerlink href=#returnexport-change title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-number>参数数目</a> &gt; <a href=#return-export-or-change-exactly-one-parameter>本节</a></p> </blockquote> <p>好的方法只做_一件事_，而这也应该反映在方法恰好只返回一个值。如果方法的输出参数相互之间_没有_联系，则说明您的方法做了多件事，则应该对其进行拆分。</p> <p>在某些情况下，输出是由多件事组成的逻辑实体。通过返回结构或对象可以很容易表示：</p> <div class=highlight><pre><span></span><code><span class=k>TYPES</span><span class=p>:</span>
  <span class=k>BEGIN OF</span> <span class=nv>check_result</span><span class=p>,</span>
    <span class=k>result      TYPE </span><span class=nv>result_type</span><span class=p>,</span>
    <span class=nv>failed_keys</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>bobf</span><span class=p>/</span><span class=nv>t_frw_key</span><span class=p>,</span>
    <span class=nv>messages</span>    <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>bobf</span><span class=p>/</span><span class=nv>t_frw_message</span><span class=p>,</span>
  <span class=k>END OF</span> <span class=nv>check_result</span><span class=p>.</span>

<span class=k>METHODS</span> <span class=nv>check_business_partners</span>
  <span class=k>IMPORTING</span>
    <span class=nv>business_partners</span> <span class=k>TYPE </span><span class=nv>business_partners</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span>     <span class=k>TYPE </span><span class=nv>check_result</span><span class=p>.</span>
</code></pre></div> <p>而不是</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>check_business_partners</span>
  <span class=k>IMPORTING</span>
    <span class=nv>business_partners</span> <span class=k>TYPE </span><span class=nv>business_partners</span>
  <span class=k>EXPORTING</span>
    <span class=k>result            TYPE </span><span class=nv>result_type</span>
    <span class=nv>failed_keys</span>       <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>bobf</span><span class=p>/</span><span class=nv>t_frw_key</span>
    <span class=nv>messages</span>          <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>bobf</span><span class=p>/</span><span class=nv>t_frw_message</span><span class=p>.</span>
</code></pre></div> <p>特别是与多个 EXPORTING 参数相比，在该方法中人们可以使用函数式调用，您可以不考虑 <code>IS SUPPLIED</code>，并且避免出现人们意外忘记检索重要的 <code>ERROR_OCCURRED</code> 信息的情况。</p> <p>不使用，而是考虑根据有意义的调用模式拆分方法去替代多个可选的输出参数：</p> <div class=highlight><pre><span></span><code><span class=k>TYPES</span><span class=p>:</span>
  <span class=k>BEGIN OF</span> <span class=nv>check_result</span><span class=p>,</span>
    <span class=k>result      TYPE </span><span class=nv>result_type</span><span class=p>,</span>
    <span class=nv>failed_keys</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>bobf</span><span class=p>/</span><span class=nv>t_frw_key</span><span class=p>,</span>
    <span class=nv>messages</span>    <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>bobf</span><span class=p>/</span><span class=nv>t_frw_message</span><span class=p>,</span>
  <span class=k>END OF</span> <span class=nv>check_result</span><span class=p>.</span>

<span class=k>METHODS</span> <span class=k>check</span>
  <span class=k>IMPORTING</span>
    <span class=nv>business_partners</span> <span class=k>TYPE </span><span class=nv>business_partners</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span>     <span class=k>TYPE </span><span class=nv>result_type</span><span class=p>.</span>

<span class=k>METHODS</span> <span class=nv>check_and_report</span>
  <span class=k>IMPORTING</span>
    <span class=nv>business_partners</span> <span class=k>TYPE </span><span class=nv>business_partners</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span>     <span class=k>TYPE </span><span class=nv>check_result</span><span class=p>.</span>
</code></pre></div> <h3 id=_70>参数类型<a class=headerlink href=#_70 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-types>本节</a></p> </blockquote> <h4 id=returning-exporting>RETURNING 优于 EXPORTING<a class=headerlink href=#returning-exporting title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-types>参数类型</a> &gt; <a href=#prefer-returning-to-exporting>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>square</span>
  <span class=k>IMPORTING</span>
    <span class=k>number</span>        <span class=k>TYPE </span><span class=nv>i</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=o>=</span> <span class=nv>square</span><span class=p>(</span> <span class=mi>42</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>square</span>
  <span class=k>IMPORTING</span>
    <span class=k>number</span> <span class=k>TYPE </span><span class=nv>i</span>
  <span class=k>EXPORTING</span>
    <span class=k>result TYPE </span><span class=nv>i</span><span class=p>.</span>

<span class=nv>square</span><span class=p>(</span>
  <span class=k>EXPORTING</span>
    <span class=k>number</span> <span class=o>=</span> <span class=mi>42</span>
  <span class=k>IMPORTING</span>
    <span class=nv>result</span> <span class=o>=</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=p>).</span>
</code></pre></div> <p><code>RETURNING</code> 不仅可以使调用更短，还允许使用方法链并防止<a href=#take-care-if-input-and-output-could-be-the-same>相同输入和输出错误</a>。</p> <h4 id=returning>RETURNING 大表通常没有问题<a class=headerlink href=#returning title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-types>参数类型</a> &gt; <a href=#returning-large-tables-is-usually-okay>本节</a></p> </blockquote> <p>尽管 ABAP 语言文档和性能指南有不一样的说法，但我们很少遇到在 VALUE 参数中传递大表或深度嵌套表_确实_导致性能问题的情况。因此，我们建议正常使用</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>get_large_table</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_table_type</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>get_large_table</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>me</span><span class=o>-&gt;</span><span class=nv>large_table</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>my_table</span><span class=p>)</span> <span class=o>=</span> <span class=nv>get_large_table</span><span class=p>(</span> <span class=p>).</span>
</code></pre></div> <p>只有在您的个别情况有实际证据（= 不良的性能衡量）时，您才应该使用更繁琐的过程式调用</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>get_large_table</span>
  <span class=k>EXPORTING</span>
    <span class=k>result </span><span class=nv>TYPE</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>some_table_type</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>get_large_table</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>me</span><span class=o>-&gt;</span><span class=nv>large_table</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=nv>get_large_table</span><span class=p>(</span> <span class=k>IMPORTING</span> <span class=nv>result</span> <span class=o>=</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>my_table</span><span class=p>)</span> <span class=p>).</span>
</code></pre></div> <blockquote> <p>本节与 ABAP Programming Guidelines 和代码分析器检查相矛盾，二者都建议应通过引用导出大表，以避免性能下降。但我们始终未能重现任何性能下降和内存不足情况，也未收到有关内核优化（通常可提高 RETURNING 性能）的通知。</p> </blockquote> <h4 id=returning-exporting-changing>单独使用 RETURNING 或 EXPORTING 或 CHANGING，而不要组合使用<a class=headerlink href=#returning-exporting-changing title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-types>参数类型</a> &gt; <a href=#use-either-returning-or-exporting-or-changing-but-not-a-combination>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>copy_class</span>
  <span class=k>IMPORTING</span>
    <span class=nv>old_name</span>      <span class=k>TYPE </span><span class=nv>seoclsname</span>
    <span class=nv>new</span> <span class=nv>name</span>      <span class=k>TYPE </span><span class=nv>secolsname</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>copy_result</span>
  <span class=k>RAISING</span>
    <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>class_copy_failure</span><span class=p>.</span>
</code></pre></div> <p>而不是混合使用，例如</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>copy_class</span>
  <span class=p>...</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span>      <span class=k>TYPE </span><span class=nv>vseoclass</span>
  <span class=k>EXPORTING</span>
    <span class=nv>error_occurred</span>     <span class=k>TYPE </span><span class=nv>abap_bool</span>
  <span class=k>CHANGING</span>
    <span class=nv>correction_request</span> <span class=k>TYPE </span><span class=nv>trkorr</span>
    <span class=nv>package</span>            <span class=k>TYPE </span><span class=nv>devclass</span><span class=p>.</span>
</code></pre></div> <p>不同种类的输出参数表明该方法做了多件事。这使读者感到困惑，并使调用该方法变得不必要的复杂。</p> <p>此规则的可接受的例外情况是使用他们的输入构建他们的输出：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>build_tree</span>
  <span class=k>CHANGING</span>
    <span class=nv>tokens</span>        <span class=k>TYPE </span><span class=nv>tokens</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE REF TO</span> <span class=nv>tree</span><span class=p>.</span>
</code></pre></div> <p>然而，可以把输入对象化参数使这些内容更加清晰：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>build_tree</span>
  <span class=k>IMPORTING</span>
    <span class=nv>tokens</span>        <span class=k>TYPE REF TO</span> <span class=nv>token_stack</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE REF TO</span> <span class=nv>tree</span><span class=p>.</span>
</code></pre></div> <h4 id=changing>在合适时保守地使用 CHANGING<a class=headerlink href=#changing title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-types>参数类型</a> &gt; <a href=#use-changing-sparingly-where-suited>本节</a></p> </blockquote> <p><code>CHANGING</code> 应预留给以下情况：现有局部变量已填充仅在某些位置需要更新：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>update_references</span>
  <span class=k>IMPORTING</span>
    <span class=nv>new_reference</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>bobf</span><span class=p>/</span><span class=nv>conf_key</span>
  <span class=k>CHANGING</span>
    <span class=nv>bo_nodes</span>      <span class=k>TYPE </span><span class=nv>root_nodes</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>update_references</span><span class=p>.</span>
  <span class=k>LOOP AT </span><span class=nv>bo_nodes</span> <span class=k>REFERENCE INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>bo_node</span><span class=p>).</span>
    <span class=nv>bo_node</span><span class=o>-&gt;</span><span class=nv>reference</span> <span class=o>=</span> <span class=nv>new_reference</span><span class=p>.</span>
  <span class=k>ENDLOOP</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>不要强迫调用者仅仅为了提供 <code>CHANGING</code> 参数而引入不必要的局部变量。不要使用 <code>CHANGING</code> 参数来初始填充先前为空的变量。</p> <h4 id=_71>拆分方法而非使用布尔输入参数<a class=headerlink href=#_71 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-types>参数类型</a> &gt; <a href=#split-method-instead-of-boolean-input-parameter>本节</a></p> </blockquote> <p>布尔输入参数通常表示一个方法做_两_件事，而不是一件。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=k>update</span>
  <span class=k>IMPORTING</span>
    <span class=nv>do_save</span> <span class=k>TYPE </span><span class=nv>abap_bool</span><span class=p>.</span>
</code></pre></div> <p>同样，使用单个（因此未命名的）布尔参数的方法调用往往会混淆参数的含义。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>update</span><span class=p>(</span> <span class=nv>abap_true</span> <span class=p>).</span>  <span class=c1>&quot; what does &#39;true&#39; mean? synchronous? simulate? commit?</span>
</code></pre></div> <p>拆分方法可以简化方法的代码并更好地描述不同的意图</p> <div class=highlight><pre><span></span><code><span class=nv>update_without_saving</span><span class=p>(</span> <span class=p>).</span>
<span class=nv>update_and_save</span><span class=p>(</span> <span class=p>).</span>
</code></pre></div> <p>普遍认为，对布尔变量使用 setter 是可以的：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>set_is_deleted</span>
  <span class=k>IMPORTING</span>
    <span class=nv>new_value</span> <span class=k>TYPE </span><span class=nv>abap_bool</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>有关详细信息，请参阅<a href=http://www.beyondcode.org/articles/booleanVariables.html>1</a><a href=https://silkandspinach.net/2004/07/15/avoid-boolean-parameters/ >2</a><a href=http://jlebar.com/2011/12/16/Boolean_parameters_to_API_functions_considered_harmful..html>3</a></p> </blockquote> <h3 id=_72>参数名称<a class=headerlink href=#_72 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-names>本节</a></p> </blockquote> <h4 id=returning-result>考虑调用 RETURNING 参数 RESULT<a class=headerlink href=#returning-result title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-names>参数名称</a> &gt; <a href=#consider-calling-the-returning-parameter-result>本节</a></p> </blockquote> <p>好的方法名称通常可以让<code>RETURNING</code> 参数不需要自己的名称这样的好效果。参数名只需要模仿方法名称或重复一些显而易见的内容。</p> <p>重复成员名称甚至可能产生冲突，需要添加多余的 <code>me-&gt;</code> 才能解决。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>get_name</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>name</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>string</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>get_name</span><span class=p>.</span>
  <span class=nv>name</span> <span class=o>=</span> <span class=nv>me</span><span class=o>-&gt;</span><span class=nv>name</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>在此类情况下，只需把参数命名为 <code>RESULT</code>，或者类似于 <code>RV_RESULT</code> 的名称（如果您喜欢用匈牙利表示法）。</p> <p>例如在针对方法链返回 <code>me</code> 的方法中，或在创建某些对象但不返回创建的实体而仅返回其键值的方法中，如果参数代表的含义_不_明确，则需要为<code>RETURNING</code>参数起个名字。</p> <h3 id=_73>参数初始化<a class=headerlink href=#_73 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-initialization>本节</a></p> </blockquote> <h4 id=exporting_1>清除或覆盖 EXPORTING 引用参数<a class=headerlink href=#exporting_1 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-initialization>参数初始化</a> &gt; <a href=#clear-or-overwrite-exporting-reference-parameters>本节</a></p> </blockquote> <p>引用参数是指可预先填充的现有内存区域。清除或覆盖它们以提供可靠的数据：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>square</span>
  <span class=k>EXPORTING</span>
    <span class=k>result TYPE </span><span class=nv>i</span><span class=p>.</span>

<span class=c1>&quot; clear</span>
<span class=k>METHOD</span> <span class=nf>square</span><span class=p>.</span>
  <span class=k>CLEAR</span> <span class=nv>result</span><span class=p>.</span>
  <span class=c1>&quot; ...</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=c1>&quot; overwrite</span>
<span class=k>METHOD</span> <span class=nf>square</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>cl_abap_math</span><span class=o>=&gt;</span><span class=nf>square</span><span class=p>(</span> <span class=mi>2</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>代码分析器和检查管理器会指出从<code>EXPORTING</code> 变量未写入值。使用这些静态检查来避免这个可能相当模糊的错误源。</p> </blockquote> <h5 id=_74>如果输入和输出可能相同则要当心<a class=headerlink href=#_74 title="Permanent link">&para;</a></h5> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-initialization>参数初始化</a> &gt; <a href=#take-care-if-input-and-output-could-be-the-same>本节</a></p> </blockquote> <p>通常，在方法体里，类型和数据声明之后第一件事把参数清空是一个好主意。这使该语句易于辨别，并避免了后续语句意外使用原来的值。</p> <p>但是，某些参数配置可能会使用相同的变量作为输入和输出。在这种情况下，之前的 <code>CLEAR</code> 语句会在使用输入值之前将其删除，从而产生错误的结果。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span> <span class=k>value</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>

<span class=nv>square_dirty</span><span class=p>(</span>
  <span class=k>EXPORTING</span>
    <span class=k>number</span> <span class=o>=</span> <span class=k>value</span>
  <span class=k>IMPORTING</span>
    <span class=nv>result</span> <span class=o>=</span> <span class=k>value</span> <span class=p>).</span>

<span class=k>METHOD</span> <span class=nf>square_dirty</span><span class=p>.</span>
  <span class=k>CLEAR</span> <span class=nv>result</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=k>number</span> <span class=o>*</span> <span class=k>number</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>考虑用 <code>RETURNING</code> 替换 <code>EXPORTING</code> 来重新设计此类方法。还可以考虑在单个结果计算语句中覆盖 <code>EXPORTING</code> 参数。如果都不适合，只能稍后执行 <code>CLEAR</code>。</p> <h4 id=value>勿清除 VALUE 参数<a class=headerlink href=#value title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#parameter-initialization>参数初始化</a> &gt; <a href=#dont-clear-value-parameters>本节</a></p> </blockquote> <p>通过 <code>VALUE</code> 传递的参数会开辟新的独立内存，这些内存区域定义时为空。不要再清除这些区域：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>square</span>
  <span class=k>EXPORTING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>square</span><span class=p>.</span>
  <span class=c1>&quot; no need to CLEAR result</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p><code>RETURNING</code> 参数始终是 <code>VALUE</code> 参数，因此您永远不需要清除这些参数：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>square</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>square</span><span class=p>.</span>
  <span class=c1>&quot; no need to CLEAR result</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h3 id=_75>方法体<a class=headerlink href=#_75 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#method-body>本节</a></p> </blockquote> <h4 id=_76>做且仅做一件事，把它做好<a class=headerlink href=#_76 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#method-body>方法体</a> &gt; <a href=#do-one-thing-do-it-well-do-it-only>本节</a></p> </blockquote> <p>一个方法应该做一件事，且只能做一件事。应该采用最好的方法做这件事。</p> <p>如果满足以下条件，一个方法可能做一件事：</p> <ul> <li><a href=#aim-for-few-importing-parameters-at-best-less-than-three>输入参数很少</a></li> <li><a href=#split-method-instead-of-boolean-input-parameter>不包含布尔参数</a></li> <li><a href=#return-export-or-change-exactly-one-parameter>只有一个输出参数</a></li> <li><a href=#keep-methods-small>很小</a></li> <li><a href=#descend-one-level-of-abstraction>将抽象降一级</a></li> <li>您无法提取有意义的其他方法</li> <li>您无法将其语句分组为有意义的部分</li> </ul> <h4 id=_77>关注愉快路径或错误处理，但非两者兼顾<a class=headerlink href=#_77 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#method-body>方法体</a> &gt; <a href=#focus-on-the-happy-path-or-error-handling-but-not-both>本节</a></p> </blockquote> <p>由于<a href=#do-one-thing-do-it-well-do-it-only><em>做且仅做一件事，把它做好</em></a>规则的专业化要求，方法应该遵循其建立的愉快路径，或在无法建立愉快路径的情况下采用其他错误处理方式，但也可能出现第三种情况。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>append_xs</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>input</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>.</span>
    <span class=k>DATA</span><span class=p>(</span><span class=nv>remainder</span><span class=p>)</span> <span class=o>=</span> <span class=nv>input</span><span class=p>.</span>
    <span class=k>WHILE</span> <span class=nv>remainder</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>.</span>
      <span class=nv>result</span> <span class=o>=</span> <span class=nv>result</span> <span class=o>&amp;&amp;</span> <span class=s1>`X`</span><span class=p>.</span>
      <span class=nv>remainder</span> <span class=o>=</span> <span class=nv>remainder</span> <span class=o>-</span> <span class=mi>1</span><span class=p>.</span>
    <span class=k>ENDWHILE</span><span class=p>.</span>
  <span class=k>ELSEIF</span> <span class=nv>input</span> <span class=o>=</span> <span class=mi>0</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>sorry_cant_do</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ELSE</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>cx_sy_illegal_argument</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>可以分解为</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>append_xs</span><span class=p>.</span>
  <span class=nv>validate</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>remainder</span><span class=p>)</span> <span class=o>=</span> <span class=nv>input</span><span class=p>.</span>
  <span class=k>WHILE</span> <span class=nv>remainder</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>.</span>
    <span class=nv>result</span> <span class=o>=</span> <span class=nv>result</span> <span class=o>&amp;&amp;</span> <span class=s1>`X`</span><span class=p>.</span>
    <span class=nv>remainder</span> <span class=o>=</span> <span class=nv>remainder</span> <span class=o>-</span> <span class=mi>1</span><span class=p>.</span>
  <span class=k>ENDWHILE</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>validate</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>input</span> <span class=o>=</span> <span class=mi>0</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>sorry_cant_do</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ELSEIF</span> <span class=nv>input</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>cx_sy_illegal_argument</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>或者，强调验证部分</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>append_xs</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>input</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>.</span>
    <span class=nv>result</span> <span class=o>=</span> <span class=nv>append_xs_without_check</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
  <span class=k>ELSEIF</span> <span class=nv>input</span> <span class=o>=</span> <span class=mi>0</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>sorry_cant_do</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ELSE</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>cx_sy_illegal_argument</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>append_xs_without_check</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>remainder</span><span class=p>)</span> <span class=o>=</span> <span class=nv>input</span><span class=p>.</span>
  <span class=k>WHILE</span> <span class=nv>remainder</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>.</span>
    <span class=nv>result</span> <span class=o>=</span> <span class=nv>result</span> <span class=o>&amp;&amp;</span> <span class=s1>`X`</span><span class=p>.</span>
    <span class=nv>remainder</span> <span class=o>=</span> <span class=nv>remainder</span> <span class=o>-</span> <span class=mi>1</span><span class=p>.</span>
  <span class=k>ENDWHILE</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h4 id=_78>将抽象降一级<a class=headerlink href=#_78 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#method-body>方法体</a> &gt; <a href=#descend-one-level-of-abstraction>本节</a></p> </blockquote> <p>方法中的语句应处于方法本身抽象级别的下一级。相应地，这些语句都应处于相同的抽象级别。</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>create_and_publish</span><span class=p>.</span>
  <span class=nv>post</span> <span class=o>=</span> <span class=nv>create_post</span><span class=p>(</span> <span class=nv>user_input</span> <span class=p>).</span>
  <span class=nv>post</span><span class=o>-&gt;</span><span class=nf>publish</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>而不是混合使用低级（<code>trim</code>、<code>to_upper</code>、...）和高级（<code>publish</code>、...）概念，例如</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>create_and_publish</span><span class=p>.</span>
  <span class=nv>post</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=nv>blog_post</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>user_name</span><span class=p>)</span> <span class=o>=</span> <span class=nv>trim</span><span class=p>(</span> <span class=nv>to_upper</span><span class=p>(</span> <span class=nv>sy</span><span class=o>-</span><span class=nv>uname</span> <span class=p>)</span> <span class=p>).</span>
  <span class=nv>post</span><span class=o>-&gt;</span><span class=nf>set_author</span><span class=p>(</span> <span class=nv>user_name</span> <span class=p>).</span>
  <span class=nv>post</span><span class=o>-&gt;</span><span class=nf>publish</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>找出正确抽象级别的可靠方法是：让该方法的作者用简短的几个单词来解释该方法的功能，而不需要查看代码。他列的功能项就应该是方法应调用的子方法或应执行的语句。</p> <h4 id=_79>保持方法精简<a class=headerlink href=#_79 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#method-body>方法体</a> &gt; <a href=#keep-methods-small>本节</a></p> </blockquote> <p>方法应少于 20 条语句，最好为 3 至 5 条语句。</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>read_and_parse_version_filters</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>active_model_version</span><span class=p>)</span> <span class=o>=</span> <span class=nv>read_random_version_under</span><span class=p>(</span> <span class=nv>model_guid</span> <span class=p>).</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>filter_json</span><span class=p>)</span> <span class=o>=</span> <span class=nv>read_model_version_filters</span><span class=p>(</span> <span class=nv>active_model_version</span><span class=o>-</span><span class=nv>guid</span> <span class=p>).</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>parse_model_version_filters</span><span class=p>(</span> <span class=nv>filter_json</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>仅通过下面的 <code>DATA</code> 声明就足以看出相关的方法不止做一件事：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>:</span>
  <span class=k>class</span>           <span class=k>TYPE </span><span class=nv>vseoclass</span><span class=p>,</span>
  <span class=nv>attributes</span>      <span class=k>TYPE </span><span class=nv>seoo_attributes_r</span><span class=p>,</span>
  <span class=k>methods</span>         <span class=k>TYPE </span><span class=nv>seoo_methods_r</span><span class=p>,</span>
  <span class=k>events</span>          <span class=k>TYPE </span><span class=nv>seoo_events_r</span><span class=p>,</span>
  <span class=k>types</span>           <span class=k>TYPE </span><span class=nv>seoo_types_r</span><span class=p>,</span>
  <span class=k>aliases</span>         <span class=k>TYPE </span><span class=nv>seoo_aliases_r</span><span class=p>,</span>
  <span class=nv>implementings</span>   <span class=k>TYPE </span><span class=nv>seor_implementings_r</span><span class=p>,</span>
  <span class=nv>inheritance</span>     <span class=k>TYPE </span><span class=nv>vseoextend</span><span class=p>,</span>
  <span class=nv>friendships</span>     <span class=k>TYPE </span><span class=nv>seof_friendships_r</span><span class=p>,</span>
  <span class=nv>typepusages</span>     <span class=k>TYPE </span><span class=nv>seot_typepusages_r</span><span class=p>,</span>
  <span class=nv>clsdeferrds</span>     <span class=k>TYPE </span><span class=nv>seot_clsdeferrds_r</span><span class=p>,</span>
  <span class=nv>intdeferrds</span>     <span class=k>TYPE </span><span class=nv>seot_intdeferrds_r</span><span class=p>,</span>
  <span class=nv>attribute</span>       <span class=k>TYPE </span><span class=nv>vseoattrib</span><span class=p>,</span>
  <span class=k>method</span>          <span class=nf>TYPE</span> <span class=nv>vseomethod</span><span class=p>,</span>
  <span class=nv>event</span>           <span class=k>TYPE </span><span class=nv>vseoevent</span><span class=p>,</span>
  <span class=k>type            TYPE </span><span class=nv>vseotype</span><span class=p>,</span>
  <span class=nv>alias</span>           <span class=k>TYPE </span><span class=nv>seoaliases</span><span class=p>,</span>
  <span class=nv>implementing</span>    <span class=k>TYPE </span><span class=nv>vseoimplem</span><span class=p>,</span>
  <span class=nv>friendship</span>      <span class=k>TYPE </span><span class=nv>seofriends</span><span class=p>,</span>
  <span class=nv>typepusage</span>      <span class=k>TYPE </span><span class=nv>vseotypep</span><span class=p>,</span>
  <span class=nv>clsdeferrd</span>      <span class=k>TYPE </span><span class=nv>vseocdefer</span><span class=p>,</span>
  <span class=nv>intdeferrd</span>      <span class=k>TYPE </span><span class=nv>vseoidefer</span><span class=p>,</span>
  <span class=nv>new_clskey_save</span> <span class=k>TYPE </span><span class=nv>seoclskey</span><span class=p>.</span>
</code></pre></div> <p>当然，在某些情况下，进一步缩小较大的方法没有任何意义。这是完全可以的，只要该方法始终<a href=#do-one-thing-do-it-well-do-it-only>专注于一件事</a>：</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>decide_what_to_do</span><span class=p>.</span>
  <span class=k>CASE</span> <span class=nv>temperature</span><span class=p>.</span>
    <span class=k>WHEN</span> <span class=nv>burning</span><span class=p>.</span>
      <span class=nv>result</span> <span class=o>=</span> <span class=nv>air_conditioning</span><span class=p>.</span>
    <span class=k>WHEN</span> <span class=nv>hot</span><span class=p>.</span>
      <span class=nv>result</span> <span class=o>=</span> <span class=nv>ice_cream</span><span class=p>.</span>
    <span class=k>WHEN</span> <span class=nv>moderate</span><span class=p>.</span>
      <span class=nv>result</span> <span class=o>=</span> <span class=nv>chill</span><span class=p>.</span>
    <span class=k>WHEN</span> <span class=nv>cold</span><span class=p>.</span>
      <span class=nv>result</span> <span class=o>=</span> <span class=nv>skiing</span><span class=p>.</span>
    <span class=k>WHEN</span> <span class=nv>freezing</span><span class=p>.</span>
      <span class=nv>result</span> <span class=o>=</span> <span class=nv>hot_cocoa</span><span class=p>.</span>
  <span class=k>ENDCASE</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>但是，验证冗长的代码是否隐藏了更合适的模式仍然有意义：</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>decide_what_to_do</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=nv>spare_time_activities</span><span class=p>[</span> <span class=nv>temperature</span> <span class=o>=</span> <span class=nv>temperature</span> <span class=p>]</span> <span class=nv>OPTIONAL</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <blockquote> <p>将方法切割过小可能会对性能产生不良影响，因为这会增加方法调用的次数。<a href=#mind-the-performance>_顾及性能_一节</a>提供了有关如何平衡整洁代码和性能的指南。</p> </blockquote> <h3 id=_80>控制流<a class=headerlink href=#_80 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#control-flow>本节</a></p> </blockquote> <h4 id=_81>快速失败<a class=headerlink href=#_81 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#control-flow>控制流</a> &gt; <a href=#fail-fast>本节</a></p> </blockquote> <p>尽早验证并处理失败情景：</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>input</span> <span class=ow>IS INITIAL</span><span class=p>.</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>cx_sy_illegal_argument</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ENDIF</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>massive_object</span><span class=p>)</span> <span class=o>=</span> <span class=nv>build_expensive_object_from</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>massive_object</span><span class=o>-&gt;</span><span class=nf>do_some_fancy_calculation</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>后面再进行验证更难以辨别和理解，并且可能已经浪费了很多资源。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>massive_object</span><span class=p>)</span> <span class=o>=</span> <span class=nv>build_expensive_object_from</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
  <span class=k>IF</span> <span class=nv>massive_object</span> <span class=ow>IS NOT BOUND</span><span class=p>.</span> <span class=c1>&quot; happens if input is initial</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>cx_sy_illegal_argument</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>ENDIF</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>massive_object</span><span class=o>-&gt;</span><span class=nf>do_some_fancy_calculation</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h4 id=check-return>CHECK 对 RETURN<a class=headerlink href=#check-return title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#control-flow>控制流</a> &gt; <a href=#check-vs-return>本节</a></p> </blockquote> <p>如果输入不符合预期，是否应使用 <code>CHECK</code> 或 <code>RETURN</code> 退出方法，人们对此并未达成共识。</p> <p>尽管 <code>CHECK</code> 显式提供了较短的语法，</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>read_customizing</span><span class=p>.</span>
  <span class=k>CHECK</span> <span class=nv>keys</span> <span class=ow>IS NOT INITIAL</span><span class=p>.</span>
  <span class=c1>&quot; do whatever needs doing</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>该语句的名称未能说明条件失败时会发生什么情况，因此长格式可能更易于人们理解：</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>read_customizing</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>keys</span> <span class=ow>IS INITIAL</span><span class=p>.</span>
    <span class=k>RETURN</span><span class=p>.</span>
  <span class=k>ENDIF</span><span class=p>.</span>
  <span class=c1>&quot; do whatever needs doing</span>
<span class=k>ENDMETHOD</span><span class=p>:</span>
</code></pre></div> <p>通过反向验证并采用单向控制流，完全可以避免此类问题</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>read_customizing</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>keys</span> <span class=ow>IS NOT INITIAL</span><span class=p>.</span>
    <span class=c1>&quot; do whatever needs doing</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>:</span>
</code></pre></div> <p>无论如何，请考虑不返回任何内容是否真的合适。方法应该提供有意义的结果，即已填充的返回参数或异常。在许多情况下，不返回任何内容都类似于返回 <code>null</code>，应该避免这种情况。</p> <blockquote> <p><a href="https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/index.htm?file=abenexit_procedure_guidl.htm">ABAP Programming Guidelines 中的_退出过程_一节</a>建议在此实例中使用 <code>CHECK</code>。社区讨论表明该语句如此不清晰，许多人无法理解程序的行为。</p> </blockquote> <h4 id=check>避免在其他位置使用 CHECK<a class=headerlink href=#check title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#methods>方法</a> &gt; <a href=#control-flow>控制流</a> &gt; <a href=#avoid-check-in-other-positions>本节</a></p> </blockquote> <p>不要在方法的初始化部分以外使用 <code>CHECK</code>。该语句在不同位置的行为方式不同，可能会造成不明确、意想不到的影响。</p> <p>例如，<a href=https://help.sap.com/doc/abapdocu_752_index_htm/7.52/en-US/abapcheck_loop.htm><code>LOOP</code> 中的 <code>CHECK</code> 结束当前迭代并继续下一个</a>；人们原本可能期望它结束方法或退出循环。</p> <blockquote> <p>基于 <a href="https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/index.htm?file=abenexit_procedure_guidl.htm">ABAP Programming Guidelines 中的_退出过程_一节</a>。请注意，这与<a href=https://help.sap.com/doc/abapdocu_752_index_htm/7.52/en-US/abapcheck_loop.htm>循环中 <code>CHECK</code> 的关键字引用</a>相矛盾。</p> </blockquote> <h2 id=_82>错误处理<a class=headerlink href=#_82 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>本节</a></p> </blockquote> <h3 id=_83>消息<a class=headerlink href=#_83 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#messages>本节</a></p> </blockquote> <h4 id=_84>使消息易于查找<a class=headerlink href=#_84 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#messages>消息</a> &gt; <a href=#make-messages-easy-to-find>本节</a></p> </blockquote> <p>要使通过事务 SE91 的使用位置搜索更容易找到消息，请使用以下模式：</p> <div class=highlight><pre><span></span><code><span class=k>MESSAGE</span> <span class=nv>e001</span><span class=p>(</span><span class=nv>ad</span><span class=p>)</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>message</span><span class=p>).</span>
</code></pre></div> <p>如果不需要变量 <code>message</code>，请添加编译指示 <code>##NEEDED</code>：</p> <div class=highlight><pre><span></span><code><span class=k>MESSAGE</span> <span class=nv>e001</span><span class=p>(</span><span class=nv>ad</span><span class=p>)</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>message</span><span class=p>)</span> <span class=cs>##NEEDED</span><span class=p>.</span>
</code></pre></div> <p>避免使用以下模式：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=mi>1</span> <span class=o>=</span> <span class=mi>2</span><span class=p>.</span> <span class=k>MESSAGE</span> <span class=nv>e001</span><span class=p>(</span><span class=nv>ad</span><span class=p>).</span> <span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <p>这是一种反面模式，因为： - 其中包含不可达代码。 - 其测试的条件永远不可能真正实现对等。</p> <h3 id=_85>返回代码<a class=headerlink href=#_85 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#return-codes>本节</a></p> </blockquote> <h4 id=_86>异常优于返回代码<a class=headerlink href=#_86 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#return-codes>返回代码</a> &gt; <a href=#prefer-exceptions-to-return-codes>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>try_this_and_that</span><span class=p>.</span>
  <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=nv>cx_failed</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>而不是</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>try_this_and_that</span><span class=p>.</span>
  <span class=nv>error_occurred</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>与返回代码相比，异常有许多优点：</p> <ul> <li> <p>异常能保持方法签名的干净整洁：以 <code>RETURNING</code> 参数形式返回方法结果，同时仍抛出异常。返回代码使用其他参数进行错误处理，会污染您的签名。</p> </li> <li> <p>调用者不必立即做出反应，只需按愉快的路径写下代码。异常处理 <code>CATCH</code> 可在方法的末尾执行，也可以完全在外部执行。</p> </li> <li> <p>异常可以通过其属性和方法提供有关错误的详细信息。而返回代码则要求您自行设计另一个解决方案，例如还要返回日志。</p> </li> <li> <p>开发环境通过语法错误提醒调用者处理异常。而在没有任何人注意的情况下，返回代码可能会被不小心忽略。</p> </li> </ul> <h4 id=_87>别让故障溜走<a class=headerlink href=#_87 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#return-codes>返回代码</a> &gt; <a href=#dont-let-failures-slip-through>本节</a></p> </blockquote> <p>如果确实必须使用返回代码，例如因为调用了不在自己控制范围内的函数和较旧的代码，务必确保别让故障溜走。</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>:</span>
  <span class=nv>current_date</span> <span class=k>TYPE </span><span class=nv>string</span><span class=p>,</span>
  <span class=nv>response</span>     <span class=k>TYPE </span><span class=nv>bapiret2</span><span class=p>.</span>

<span class=k>CALL FUNCTION</span> <span class=s1>&#39;BAPI_GET_CURRENT_DATE&#39;</span>
  <span class=k>IMPORTING</span>
    <span class=nv>current_date</span> <span class=o>=</span> <span class=nv>current_date</span>
  <span class=k>CHANGING</span>
    <span class=nv>response</span>     <span class=o>=</span> <span class=nv>response</span><span class=p>.</span>

<span class=k>IF</span> <span class=nv>response</span><span class=o>-</span><span class=nv>type</span> <span class=o>=</span> <span class=s1>&#39;E&#39;</span><span class=p>.</span>
  <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_error</span><span class=p>(</span> <span class=p>);</span>
<span class=k>ENDIF</span><span class=p>.</span>
</code></pre></div> <h3 id=_88>异常<a class=headerlink href=#_88 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#exceptions>本节</a></p> </blockquote> <h4 id=_89>异常针对的是错误，而不是正常情况<a class=headerlink href=#_89 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#exceptions>异常</a> &gt; <a href=#exceptions-are-for-errors-not-for-regular-cases>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>entry_exists_in_db</span>
  <span class=k>IMPORTING</span>
    <span class=k>key</span> <span class=k>TYPE </span><span class=nv>char10</span>
  <span class=k>RAISING</span>
    <span class=nv>cx_not_found_exception</span><span class=p>.</span>
</code></pre></div> <p>如果情况是正常、有效的，应该使用常规的结果参数进行处理。</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>entry_exists_in_db</span>
  <span class=k>IMPORTING</span>
    <span class=k>key</span>           <span class=k>TYPE </span><span class=nv>char10</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=k>TYPE </span><span class=nv>abap_bool</span><span class=p>.</span>
</code></pre></div> <p>异常应该反映错误情况，留到您不希望看到的情况下使用。</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>assert_user_input_is_valid</span>
  <span class=k>IMPORTING</span>
    <span class=nv>user_input</span> <span class=k>TYPE </span><span class=nv>string</span>
  <span class=k>RAISING</span>
    <span class=nv>cx_bad_user_input</span><span class=p>.</span>
</code></pre></div> <p>误用异常会误导读者认为实际上一切都顺利的地方出了问题。异常也比正常代码慢得多，因为它们需要进行构建，往往要收集大量上下文信息。</p> <h4 id=_90>使用基于类的异常<a class=headerlink href=#_90 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#exceptions>异常</a> &gt; <a href=#use-class-based-exceptions>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>TRY</span><span class=p>.</span>
    <span class=nv>get_component_types</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>CATCH</span> <span class=nv>cx_has_deep_components_error</span><span class=p>.</span>
<span class=k>ENDTRY</span><span class=p>.</span>
</code></pre></div> <p>过时的非基于类的异常与返回代码具有相同的功能，不应再使用。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>get_component_types</span><span class=p>(</span>
  <span class=k>EXCEPTIONS</span>
    <span class=nv>has_deep_components</span> <span class=o>=</span> <span class=mi>1</span>
    <span class=k>OTHERS</span>              <span class=o>=</span> <span class=mi>2</span> <span class=p>).</span>
</code></pre></div> <h3 id=_91>抛出<a class=headerlink href=#_91 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>本节</a></p> </blockquote> <h4 id=_92>使用各自的超类<a class=headerlink href=#_92 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>抛出</a> &gt; <a href=#use-own-super-classes>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=nv>cx_fra_static_check</span> <span class=k>DEFINITION</span> <span class=k>ABSTRACT</span> <span class=k>INHERITING FROM</span> <span class=nv>cx_static_check</span><span class=p>.</span>
<span class=k>CLASS</span> <span class=nv>cx_fra_no_check</span> <span class=k>DEFINITION</span> <span class=k>ABSTRACT</span> <span class=k>INHERITING FROM</span> <span class=nv>cx_no_check</span><span class=p>.</span>
</code></pre></div> <p>考虑为应用程序的每种异常类型创建抽象超类，而不是直接对基础类进行子类化。允许您对_自己的_所有异常执行 <code>CATCH</code>。使您可以向所有异常添加通用功能，例如特殊文本处理。<code>ABSTRACT</code> 防止人们意外地直接使用这些非描述性错误。</p> <h4 id=_93>抛出一种类型的异常<a class=headerlink href=#_93 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>抛出</a> &gt; <a href=#throw-one-type-of-exception>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>generate</span>
  <span class=k>RAISING</span>
    <span class=nv>cx_generation_error</span><span class=p>.</span>
</code></pre></div> <p>在绝大多数情况下，抛出多种类型的异常没有任何用处。调用者通常既不感兴趣，也没法区分错误情况，因此经常会以相同的方式处理它们——既然如此，为什么一开始要区分它们呢？</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>generate</span>
  <span class=k>RAISING</span>
    <span class=nv>cx_abap_generation</span>
    <span class=nv>cx_hdbr_access_error</span>
    <span class=nv>cx_model_read_error</span><span class=p>.</span>
</code></pre></div> <p>识别不同错误情况的更好解决方案是使用一种异常类型，但添加允许（但不要求）对个别错误情况做出反应的子类，如<a href=#use-sub-classes-to-enable-callers-to-distinguish-error-situations>使用子类以便调用者能够区分错误情况</a>中所述。</p> <h4 id=_94>使用子类以便调用者能够区分错误情况<a class=headerlink href=#_94 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>抛出</a> &gt; <a href=#use-sub-classes-to-enable-callers-to-distinguish-error-situations>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=nv>cx_bad_generation_variable</span> <span class=k>DEFINITION</span> <span class=k>INHERITING FROM</span> <span class=nv>cx_generation_error</span><span class=p>.</span>
<span class=k>CLASS</span> <span class=nv>cx_bad_code_composer_template</span> <span class=k>DEFINITION</span> <span class=k>INHERITING FROM</span> <span class=nv>cx_generation_error</span><span class=p>.</span>

<span class=k>TRY</span><span class=p>.</span>
    <span class=nv>generator</span><span class=o>-&gt;</span><span class=nf>generate</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>CATCH</span> <span class=nv>cx_bad_generation_variable</span><span class=p>.</span>
    <span class=nv>log_failure</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>CATCH</span> <span class=nv>cx_bad_code_composer_template</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>bad_template_exception</span><span class=p>).</span>
    <span class=nv>show_error_to_user</span><span class=p>(</span> <span class=nv>bad_template_exception</span> <span class=p>).</span>
  <span class=k>CATCH</span> <span class=nv>cx_generation_error</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>other_exception</span><span class=p>).</span>
    <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=nv>cx_application_error</span><span class=p>(</span> <span class=nv>previous</span> <span class=o>=</span>  <span class=nv>other_exception</span> <span class=p>).</span>
<span class=k>ENDTRY</span><span class=p>.</span>
</code></pre></div> <p>如果有许多不同的错误情况，则改用错误代码：</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=nv>cx_generation_error</span> <span class=k>DEFINITION</span> <span class=p>...</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>TYPES</span> <span class=nv>error_code_type</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>
    <span class=k>CONSTANTS</span><span class=p>:</span>
      <span class=k>BEGIN OF</span> <span class=nv>error_code_enum</span><span class=p>,</span>
        <span class=nv>bad_generation_variable</span>    <span class=k>TYPE </span><span class=nv>error_code_type</span> <span class=k>VALUE</span> <span class=mi>1</span><span class=p>,</span>
        <span class=nv>bad_code_composer_template</span> <span class=k>TYPE </span><span class=nv>error_code_type</span> <span class=k>VALUE</span> <span class=mi>2</span><span class=p>,</span>
        <span class=p>...</span>
      <span class=k>END OF</span> <span class=nv>error_code_enum</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>error_code</span> <span class=k>TYPE </span><span class=nv>error_code_type</span><span class=p>.</span>

<span class=k>TRY</span><span class=p>.</span>
    <span class=nv>generator</span><span class=o>-&gt;</span><span class=nf>generate</span><span class=p>(</span> <span class=p>).</span>
  <span class=k>CATCH</span> <span class=nv>cx_generation_error</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>exception</span><span class=p>).</span>
    <span class=k>CASE</span> <span class=k>exception</span><span class=o>-&gt;</span><span class=nv>error_code</span><span class=p>.</span>
      <span class=k>WHEN</span> <span class=nv>cx_generation_error</span><span class=o>=&gt;</span><span class=nv>error_code_enum</span><span class=o>-</span><span class=nv>bad_generation_variable</span><span class=p>.</span>
      <span class=k>WHEN</span> <span class=nv>cx_generation_error</span><span class=o>=&gt;</span><span class=nv>error_code_enum</span><span class=o>-</span><span class=nv>bad_code_composer_variable</span><span class=p>.</span>
      <span class=p>...</span>
    <span class=k>ENDCASE</span><span class=p>.</span>
<span class=k>ENDTRY</span><span class=p>.</span>
</code></pre></div> <h4 id=cx_static_check>针对可应对的异常抛出 CX_STATIC_CHECK<a class=headerlink href=#cx_static_check title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>抛出</a> &gt; <a href=#throw-cx_static_check-for-manageable-exceptions>本节</a></p> </blockquote> <p>如果预期会出现异常并可由接收者合理处理，则抛出继承自 <code>CX_STATIC_CHECK</code> 的可控异常：用户输入验证失败，缺少存在后备的资源，等等。</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=nv>cx_file_not_found</span> <span class=k>DEFINITION</span> <span class=k>INHERITING FROM</span> <span class=nv>cx_static_check</span><span class=p>.</span>

<span class=k>METHODS</span> <span class=nv>read_file</span>
  <span class=k>IMPORTING</span>
    <span class=nv>file_name_enterd_by_user</span> <span class=k>TYPE </span><span class=nv>string</span>
  <span class=k>RAISING</span>
    <span class=nv>cx_file_not_found</span><span class=p>.</span>
</code></pre></div> <p>这种异常类型_必须_在方法签名中给出，并且_必须_被捕获或转发以避免语法错误。这样，用户便能够清楚看到这种异常类型，确保其不会因意外的异常而感到惊讶，并负责对错误情况做出反应。</p> <blockquote> <p>这与 <a href=https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/abenexception_category_guidl.htm>ABAP Programming Guidelines</a> 一致，但与 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a>（其中建议优先使用不可控异常）相矛盾；<a href=sub-sections/Exceptions>异常</a>说明了其中的原因。</p> </blockquote> <h4 id=cx_no_check>针对通常不可恢复的情况抛出 CX_NO_CHECK<a class=headerlink href=#cx_no_check title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>抛出</a> &gt; <a href=#throw-cx_no_check-for-usually-unrecoverable-situations>本节</a></p> </blockquote> <p>如果异常严重到使接收端不太可能恢复正常工作，则使用 <code>CX_NO_CHECK</code>：无法读取必备资源，无法解决请求的依赖项等。</p> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=nv>cx_out_of_memory</span> <span class=k>DEFINITION</span> <span class=k>INHERITING FROM</span> <span class=nv>cx_no_check</span><span class=p>.</span>

<span class=k>METHODS</span> <span class=nv>create_guid</span>
  <span class=k>RETURNING</span>
    <span class=k>VALUE</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>bobf</span><span class=p>/</span><span class=nv>conf_key</span><span class=p>.</span>
</code></pre></div> <p><code>CX_NO_CHECK</code> _不能_在方法签名中声明，因此它的出现会使用户感到意外。在无法恢复的情况下，这是可以接受的，因为用户无论如何都无法采取有效的操作。</p> <p>但是，在某些情况下，用户实际上_可能_希望识别并应对这种故障。例如，如果依赖的管理器无法为请求的接口提供一个实现，则会抛出 <code>CX_NO_CHECK</code>，因为常规应用程序代码将无法继续执行。但是，可能某个测试报告试图实例化所有事物，以查看其是否有效，并且会简单地将失败报告为列表中的红色条目——该服务应该能够捕获并忽略异常，而不是被强制转储。</p> <h4 id=cx_dynamic_check>针对可避免的异常考虑 CX_DYNAMIC_CHECK<a class=headerlink href=#cx_dynamic_check title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>抛出</a> &gt; <a href=#consider-cx_dynamic_check-for-avoidable-exceptions>本节</a></p> </blockquote> <p><code>CX_DYNAMIC_CHECK</code> 的用例很少见，通常我们建议使用其他异常类型。但是，如果调用者对是否可能发生异常完全自主控制，您可能要考虑使用这种异常来代替 <code>CX_STATIC_CHECK</code>。</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=k>value</span> <span class=k>TYPE </span><span class=nv>decfloat</span><span class=p>.</span>
<span class=k>value</span> <span class=o>=</span> <span class=s1>&#39;7.13&#39;</span><span class=p>.</span>
<span class=nv>cl_abap_math</span><span class=o>=&gt;</span><span class=nf>get_db_length_decs</span><span class=p>(</span>
  <span class=k>EXPORTING</span>
    <span class=k>in</span>     <span class=o>=</span> <span class=k>value</span>
  <span class=k>IMPORTING</span>
    <span class=k>length</span> <span class=o>=</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>length</span><span class=p>)</span> <span class=p>).</span>
</code></pre></div> <p>例如，使用 <code>cl_abap_math</code> 类的 <code>get_db_length_decs</code> 方法，它告诉您十进制浮点数的位数和小数位数。如果输入参数未反映十进制浮点数，此方法会引发动态异常 <code>cx_parameter_invalid_type</code>。通常，将为完全静态类型的变量调用此方法，以便开发人员知道该异常是否会发生。在这种情况下，动态异常能够让调用者省略不必要的 <code>CATCH</code> 子句。</p> <h4 id=_95>针对完全不可恢复的情况进行转储<a class=headerlink href=#_95 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>抛出</a> &gt; <a href=#dump-for-totally-unrecoverable-situations>本节</a></p> </blockquote> <p>如果情况严重到可以完全确定接收者不太可能从中恢复，或者清楚地表明了编程错误，请转储而不是抛出异常：获取内存失败，对必须填充的表读取索引失败等。</p> <div class=highlight><pre><span></span><code><span class=k>RAISE</span> <span class=nv>SHORTDUMP</span> <span class=k>TYPE </span><span class=nv>cx_sy_create_object_error</span><span class=p>.</span>  <span class=c1>&quot; &gt;= NW 7.53</span>
<span class=k>MESSAGE</span> <span class=nv>x666</span><span class=p>(</span><span class=nv>general</span><span class=p>).</span>                           <span class=c1>&quot; &lt; NW 7.53</span>
</code></pre></div> <p>这种行为将阻止任何类型的用户事后执行任何有用的操作。请仅在确定时使用此功能。</p> <h4 id=raise-exception-new-raise-exception-type>RAISE EXCEPTION NEW 优于 RAISE EXCEPTION TYPE<a class=headerlink href=#raise-exception-new-raise-exception-type title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#throwing>抛出</a> &gt; <a href=#prefer-raise-exception-new-to-raise-exception-type>本节</a></p> </blockquote> <p>注：自 NW 7.52 起可用。</p> <div class=highlight><pre><span></span><code><span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=nv>cx_generation_error</span><span class=p>(</span> <span class=nv>previous</span> <span class=o>=</span> <span class=k>exception</span> <span class=p>).</span>
</code></pre></div> <p>通常短于毫无必要加长的</p> <div class=highlight><pre><span></span><code><span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=k>TYPE </span><span class=nv>cx_generation_error</span>
  <span class=k>EXPORTING</span>
    <span class=nv>previous</span> <span class=o>=</span> <span class=k>exception</span><span class=p>.</span>
</code></pre></div> <p>但是，如果大量添加 <code>MESSAGE</code>，可能需要坚持使用 <code>TYPE</code> 变式：</p> <div class=highlight><pre><span></span><code><span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=k>TYPE </span><span class=nv>cx_generation_error</span>
  <span class=k>EXPORTING</span>
    <span class=nv>previous</span> <span class=o>=</span> <span class=k>exception</span>
  <span class=k>MESSAGE</span> <span class=nv>e136</span><span class=p>(</span><span class=nv>messages</span><span class=p>).</span>
</code></pre></div> <h3 id=_96>捕获<a class=headerlink href=#_96 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#catching>本节</a></p> </blockquote> <h4 id=_97>包裹外来异常而非任其侵入代码<a class=headerlink href=#_97 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#error-handling>错误处理</a> &gt; <a href=#catching>捕获</a> &gt; <a href=#wrap-foreign-exceptions-instead-of-letting-them-invade-your-code>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>generate</span> <span class=k>RAISING</span> <span class=nv>cx_generation_failure</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>generate</span><span class=p>.</span>
  <span class=k>TRY</span><span class=p>.</span>
      <span class=nv>generator</span><span class=o>-&gt;</span><span class=nf>generate</span><span class=p>(</span> <span class=p>).</span>
    <span class=k>CATCH</span> <span class=nv>cx_amdp_generation_failure</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>exception</span><span class=p>).</span>
      <span class=k>RAISE</span> <span class=k>EXCEPTION</span> <span class=nv>NEW</span> <span class=nv>cx_generation_failure</span><span class=p>(</span> <span class=nv>previous</span> <span class=o>=</span> <span class=k>exception</span> <span class=p>).</span>
  <span class=k>ENDTRY</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p><a href=https://en.wikipedia.org/wiki/Law_of_Demeter>得墨忒耳律</a>建议将事物解耦，而转发来自其他组件的异常是违反了这一原则的。通过捕获这些异常并将其封装在自己的异常类型中，使自己独立于外部代码。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>generate</span> <span class=k>RAISING</span> <span class=nv>cx_sy_gateway_failure</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>generate</span><span class=p>.</span>
  <span class=nv>generator</span><span class=o>-&gt;</span><span class=nf>generate</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h2 id=_98>注释<a class=headerlink href=#_98 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>本节</a></p> </blockquote> <h3 id=_99>用代码表达自己而不是靠注释<a class=headerlink href=#_99 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#express-yourself-in-code-not-in-comments>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>correct_day_to_last_in_month</span><span class=p>.</span>
  <span class=k>WHILE</span> <span class=nv>is_invalid</span><span class=p>(</span> <span class=k>date</span> <span class=p>).</span>
    <span class=nv>reduce_day_by_one</span><span class=p>(</span> <span class=k>CHANGING</span> <span class=k>date</span> <span class=o>=</span> <span class=k>date</span> <span class=p>).</span>
  <span class=k>ENDWHILE</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>is_invalid</span><span class=p>.</span>
  <span class=k>DATA</span> <span class=nv>zero_if_invalid</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>
  <span class=nv>zero_if_invalid</span> <span class=o>=</span> <span class=k>date</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>zero_if_invalid</span> <span class=o>=</span> <span class=mi>0</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>reduce_day_by_one</span><span class=p>.</span>
  <span class=k>date</span><span class=o>+</span><span class=mi>6</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=o>=</span> <span class=k>date</span><span class=o>+</span><span class=mi>6</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>而不是</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=c1>&quot; correct e.g. 29.02. in non-leap years as well as result of a date calculation would be</span>
<span class=c1>&quot; something like e.g. the 31.06. that example has to be corrected to 30.06.</span>
<span class=k>METHOD</span> <span class=nf>fix_day_overflow</span><span class=p>.</span>
  <span class=k>DO</span> <span class=mi>3</span> <span class=k>TIMES</span><span class=p>.</span>
    <span class=c1>&quot; 31 - 28 = 3 =&gt; this correction is required not more than 3 times</span>
    <span class=nv>lv_dummy</span> <span class=o>=</span> <span class=nv>cv_date</span><span class=p>.</span>
    <span class=c1>&quot; lv_dummy is 0 if the date value is a not existing date - ABAP specific implementation</span>
    <span class=k>IF</span> <span class=p>(</span> <span class=nv>lv_dummy</span> <span class=ow>EQ</span> <span class=mi>0</span> <span class=p>).</span>
      <span class=nv>cv_date</span><span class=o>+</span><span class=mi>6</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=o>=</span> <span class=nv>cv_date</span><span class=o>+</span><span class=mi>6</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>.</span> <span class=c1>&quot; subtract 1 day from the given date</span>
    <span class=k>ELSE</span><span class=p>.</span>
      <span class=c1>&quot; date exists =&gt; no correction required</span>
      <span class=k>EXIT</span><span class=p>.</span>
    <span class=k>ENDIF</span><span class=p>.</span>
  <span class=k>ENDDO</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>整洁代码_并不是_禁止您为代码写注释，而是鼓励您想出_更好的_替代方法。只有想不出替代方法时才使用注释。</p> <blockquote> <p>从性能的角度来看，这个例子受到了质疑，因为将方法缩减到如此之短会严重降低性能。样本测量表明，在运行速度上，重构代码要比原始的脏代码慢 2.13 倍。整洁代码修复输入 <code>31-02-2018</code> 需要 9.6 微秒，而脏代码只需 4.5 微秒。当频繁在高性能应用程序中运行此方法时，可能会对性能造成影响；但对于常规用户输入验证，应该是可以接受的。请参阅<a href=#mind-the-performance>顾及性能</a>一节以处理整洁代码和性能问题。</p> </blockquote> <h3 id=_100>注释绝非坏名称的借口<a class=headerlink href=#_100 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#comments-are-no-excuse-for-bad-names>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>input_has_entries</span><span class=p>)</span> <span class=o>=</span> <span class=nv>has_entries</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
</code></pre></div> <p>与其解释那些坏名称的真正含义或者您选择坏名称的原因，不如去实际改良名称。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=c1>&quot; checks whether the table input contains entries</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=o>=</span> <span class=nv>check_table</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
</code></pre></div> <h3 id=_101>使用方法而非注释来对代码分段<a class=headerlink href=#_101 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#use-methods-instead-of-comments-to-segment-your-code>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>statement</span><span class=p>)</span> <span class=o>=</span> <span class=nv>build_statement</span><span class=p>(</span> <span class=p>).</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>data</span><span class=p>)</span> <span class=o>=</span> <span class=nv>execute_statement</span><span class=p>(</span> <span class=nv>statement</span> <span class=p>).</span>
</code></pre></div> <p>这样不但能够更加清晰地体现代码的意图、结构和依赖关系，同时还能避免在块与块之间因临时变量未清空引起的错误。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=c1>&quot; -----------------</span>
<span class=c1>&quot; Build statement</span>
<span class=c1>&quot; -----------------</span>
<span class=k>DATA</span> <span class=nv>statement</span> <span class=k>TYPE </span><span class=nv>string</span><span class=p>.</span>
<span class=nv>statement</span> <span class=o>=</span> <span class=p>|</span><span class=s1>SELECT * FROM d_document_roots</span><span class=p>|.</span>

<span class=c1>&quot; -----------------</span>
<span class=c1>&quot; Execute statement</span>
<span class=c1>&quot; -----------------</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>result_set</span><span class=p>)</span> <span class=o>=</span> <span class=nv>adbc</span><span class=o>-&gt;</span><span class=nf>execute_sql_query</span><span class=p>(</span> <span class=nv>statement</span> <span class=p>).</span>
<span class=nv>result_set</span><span class=o>-&gt;</span><span class=nf>next_package</span><span class=p>(</span> <span class=k>IMPORTING</span> <span class=k>data</span> <span class=o>=</span> <span class=k>data</span> <span class=p>).</span>
</code></pre></div> <h3 id=_102>写注释是要解释为什么而非是什么<a class=headerlink href=#_102 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#write-comments-to-explain-the-why-not-the-what>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; can&#39;t fail, existence of &gt;= 1 row asserted above</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>first_line</span><span class=p>)</span> <span class=o>=</span> <span class=k>table</span><span class=p>[</span> <span class=mi>1</span> <span class=p>].</span>
</code></pre></div> <p>没人需要用自然语言重复代码</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=c1>&quot; select alert root from database by key</span>
<span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=nv>d_alert_root</span> <span class=k>WHERE</span> <span class=k>key</span> <span class=o>=</span> <span class=k>key</span><span class=p>.</span>
</code></pre></div> <h3 id=_103>设计应放到设计文档里而不是代码里<a class=headerlink href=#_103 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#design-goes-into-the-design-documents-not-the-code>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=c1>&quot; This class serves a double purpose. First, it does one thing. Then, it does another thing.</span>
<span class=c1>&quot; It does so by executing a lot of code that is distributed over the local helper classes.</span>
<span class=c1>&quot; To understand what&#39;s going on, let us at first ponder the nature of the universe as such.</span>
<span class=c1>&quot; Have a look at this and that to get the details.</span>
</code></pre></div> <p>没人会认真读——真的。如果人们需要阅读教科书才能使用代码，这可能说明您的代码存在严重的设计问题，应通过其他方式解决。有些代码_确实_需要解释，而不仅仅是一行注释；在这种情况下，请考虑链接设计文档。</p> <h3 id=_104>用 " 而非 * 加注释<a class=headerlink href=#_104 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#comment-with--not-with->本节</a></p> </blockquote> <p>加引号的注释及其注释语句一同缩进</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>do_it</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>input</span> <span class=ow>IS NOT INITIAL</span><span class=p>.</span>
    <span class=c1>&quot; delegate pattern</span>
    <span class=nv>output</span> <span class=o>=</span> <span class=nv>calculate_result</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>加星号的注释往往造成缩进异常</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>do_it</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>input</span> <span class=ow>IS NOT INITIAL</span><span class=p>.</span>
<span class=c1>* delegate pattern</span>
    <span class=nv>output</span> <span class=o>=</span> <span class=nv>calculate_result</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
  <span class=k>ENDIF</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h3 id=_105>将注释放在与其相关的语句前面<a class=headerlink href=#_105 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#put-comments-before-the-statement-they-relate-to>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; delegate pattern</span>
<span class=nv>output</span> <span class=o>=</span> <span class=nv>calculate_result</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
</code></pre></div> <p>整洁性强于</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>output</span> <span class=o>=</span> <span class=nv>calculate_result</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>
<span class=c1>&quot; delegate pattern</span>
</code></pre></div> <p>且唐突的程度低于</p> <div class=highlight><pre><span></span><code><span class=nv>output</span> <span class=o>=</span> <span class=nv>calculate_result</span><span class=p>(</span> <span class=nv>input</span> <span class=p>).</span>  <span class=c1>&quot; delegate pattern</span>
</code></pre></div> <h3 id=_106>删除代码而非将其注释掉<a class=headerlink href=#_106 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#delete-code-instead-of-commenting-it>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=c1>* output = calculate_result( input ).</span>
</code></pre></div> <p>当您发现类似内容时，请将其删除。这里显然不需要代码，因为应用程序顺利运行并且所有测试都通过了。以后可根据版本历史记录再生删除的代码。如果需要永久保留某一段代码，请将其复制到文件或 <code>$TMP</code> 或 <code>HOME</code> 对象中。</p> <h3 id=fixmetodo-xxx>使用 FIXME、TODO 和 XXX 并添加自己的标识<a class=headerlink href=#fixmetodo-xxx title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#use-fixme-todo-and-xxx-and-add-your-id>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>
  <span class=c1>&quot; XXX FH delete this method - it does nothing</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <ul> <li><code>FIXME</code> 指向内部事件正在形成的过小或过大的错误。</li> <li><code>TODO</code> 是您要在不久之后编写代码的地方。</li> <li><code>XXX</code> 标记出有效但还可以进一步优化的代码。</li> </ul> <p>输入这类注释时，请添加昵称、姓名缩写或用户，这样可方便共同开发者与您联系并可以在不清楚注释的意图时向您询问问题。</p> <h3 id=_107>勿添加方法签名和注释结尾<a class=headerlink href=#_107 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#dont-add-method-signature-and-end-of-comments>本节</a></p> </blockquote> <p>方法签名注释对任何人都没有帮助。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=c1>* &lt;SIGNATURE&gt;---------------------------------------------------------------------------------------+</span>
<span class=c1>* | Static Public Method CALIBRATION_KPIS=&gt;CALCULATE_KPI</span>
<span class=c1>* +-------------------------------------------------------------------------------------------------+</span>
<span class=c1>* | [---&gt;] STRATEGY_ID                 TYPE        STRATEGY_ID</span>
<span class=c1>* | [---&gt;] THRESHOLD                   TYPE        STRATEGY_THRESHOLD</span>
<span class=c1>* | [---&gt;] DETECTION_OBJECT_SCORE      TYPE        T_HIT_RESULT</span>
<span class=c1>* | [&lt;---] KPI                         TYPE        T_SIMULATED_KPI</span>
<span class=c1>* +--------------------------------------------------------------------------------------&lt;/SIGNATURE&gt;</span>
</code></pre></div> <p>几十年前，当在检查代码或处理数十页的打印输出内容时，如果看不到方法签名，这些注释可能会对您大有帮助。但现在，所有 ABAP IDE（SE24、SE80、ADT）都可以轻松显示方法签名，因此这些注释只是干扰而已。</p> <blockquote> <p>在基于表单的编辑器 SE24/SE80 中，按_签名_按钮。在 ABAP 开发工具中，选中方法名称然后按 F2，或将 _ABAP 元素信息_视图添加到您的透视图中。</p> </blockquote> <p>同样，注释结尾也是多余的。几十年前，当程序和函数以及内部嵌套的 IF 长度达到数百行代码时，这些注释可能很有用。但如今的编码风格发生了变化，方法非常简短，可以轻松看到 <code>ENDIF</code> 或 <code>ENDMETHOD</code> 属于哪个开头语句：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>get_kpi_calc</span><span class=p>.</span>
  <span class=k>IF</span> <span class=nv>has_entries</span> <span class=o>=</span> <span class=nv>abap_false</span><span class=p>.</span>
    <span class=nv>result</span> <span class=o>=</span> <span class=mi>42</span><span class=p>.</span>
  <span class=k>ENDIF</span><span class=p>.</span>  <span class=c1>&quot; IF has_entries = abap_false</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>   <span class=c1>&quot; get_kpi_calc</span>
</code></pre></div> <h3 id=_108>勿复制消息文本作为注释<a class=headerlink href=#_108 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#dont-duplicate-message-texts-as-comments>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=c1>&quot; alert category not filled</span>
<span class=k>MESSAGE</span> <span class=nv>e003</span> <span class=k>INTO</span> <span class=k>dummy</span><span class=p>.</span>
</code></pre></div> <p>消息独立于您的代码而变化，没有人会记得调整注释，这样注释将很快过时甚至变得有误导性，却没有引起任何人注意。</p> <p>在现代 IDE 中，您可以轻松查看消息背后的文本，例如在 ABAP 开发工具中，选中消息标识并按 Shift+F2。</p> <p>如果您希望消息更准确，请考虑将消息提取到其自身的方法。</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>create_alert_not_found_message</span><span class=p>.</span>
  <span class=k>MESSAGE</span> <span class=nv>e003</span> <span class=k>INTO</span> <span class=k>dummy</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h3 id=abap-api>ABAP 文档仅适用于公共 API<a class=headerlink href=#abap-api title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#abap-doc-only-for-public-apis>本节</a></p> </blockquote> <p>编写 ABAP 文档来记录公共 API，这意味着这些 API 可供其他团队或应用程序的开发人员使用。不要为内部内容编写 ABAP 文档。</p> <p>ABAP 文档与所有注释一样都有相同的弱点，也就是说，它很快会过时，然后会变得有误导性。因此，您应该只在有意义的情况下使用，而不要为一切内容强制编写 ABAP 文档。</p> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 4: Good Comments: Javadocs in Public APIs</em> 和 <em>Chapter 4: Bad Comments: Javadocs in Nonpublic Code</em>。</p> </blockquote> <h3 id=_109>编译指示优于伪注释<a class=headerlink href=#_109 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#comments>注释</a> &gt; <a href=#prefer-pragmas-to-pseudo-comments>本节</a></p> </blockquote> <p>优先使用编译指示而不是伪注释来抑制 ATC 识别的无关警告和错误。伪注释大部分已过时，并已替换为编译指示。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; pattern</span>
<span class=k>MESSAGE</span> <span class=nv>e001</span><span class=p>(</span><span class=nv>ad</span><span class=p>)</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>message</span><span class=p>)</span> <span class=cs>##NEEDED</span><span class=p>.</span>

<span class=c1>&quot; anti-pattern</span>
<span class=k>MESSAGE</span> <span class=nv>e001</span><span class=p>(</span><span class=nv>ad</span><span class=p>)</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>message</span><span class=p>).</span> <span class=c1>&quot;#EC NEEDED</span>
</code></pre></div> <p>使用 <code>ABAP_SLIN_PRAGMAS</code> 程序或 <code>SLIN_DESC</code> 表查找过时伪注释与已替换这些伪注释的编译指示之间的映射。</p> <h2 id=_110>格式化<a class=headerlink href=#_110 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>本节</a></p> </blockquote> <p>下面的建议<a href=#optimize-for-reading-not-for-writing>为阅读而不是书写进行优化</a>。由于 ABAP 的格式优化器没有涵盖它们，其中的部分建议会产生额外的人工工作，以在名称长度等发生变化时重新格式化语句；如果要避免这种情况，请考虑放弃这些规则，例如<a href=#align-assignments-to-the-same-object-but-not-to-different-ones>对齐同一对象而非不同对象的赋值</a>。</p> <h3 id=_111>保持一致<a class=headerlink href=#_111 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#be-consistent>本节</a></p> </blockquote> <p>以相同的方式格式化项目的所有代码。让所有团队成员使用相同的格式化风格。</p> <p>如果要编辑外来代码，请遵循该项目的格式化风格，而不要坚持自己的个人风格。</p> <p>如果要随时间更改格式化规则，请使用<a href=#how-to-refactor-legacy-code>重构最佳实践</a>随时间更新代码。</p> <h3 id=_112>为阅读而不是书写进行优化<a class=headerlink href=#_112 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#optimize-for-reading-not-for-writing>本节</a></p> </blockquote> <p>开发人员花费大量时间_阅读_代码。实际上，一天中_编写_代码所占的比例要小得多。</p> <p>因此，应针对读取和调试（而非编写）来优化代码格式。</p> <p>例如，应该优先采用</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>:</span>
  <span class=nv>a</span> <span class=k>TYPE </span><span class=nv>b</span><span class=p>,</span>
  <span class=nv>c</span> <span class=k>TYPE </span><span class=nv>d</span><span class=p>,</span>
  <span class=nv>e</span> <span class=k>TYPE </span><span class=nv>f</span><span class=p>.</span>
</code></pre></div> <p>而不是</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>:</span>
  <span class=nv>a</span> <span class=k>TYPE </span><span class=nv>b</span>
  <span class=p>,</span><span class=nv>c</span> <span class=k>TYPE </span><span class=nv>d</span>
  <span class=p>,</span><span class=nv>e</span> <span class=k>TYPE </span><span class=nv>f</span><span class=p>.</span>
</code></pre></div> <h3 id=_113>激活前使用格式优化器<a class=headerlink href=#_113 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#use-the-pretty-printer-before-activating>本节</a></p> </blockquote> <p>在激活对象前应用格式优化器——SE80、SE24 和 ADT 中的 Shift+F1。</p> <p>如果修改一个大型未格式化旧代码库，可能需要仅对选定行应用格式优化器，以避免产生大量的变更项和传输依赖项。请考虑在单独的传输请求或注释中整齐打印完整的开发对象。</p> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 5: Formatting: Team Rules</em>。</p> </blockquote> <h3 id=_114>使用格式优化器团队设置<a class=headerlink href=#_114 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#use-your-pretty-printer-team-settings>本节</a></p> </blockquote> <p>始终使用团队设置。在_菜单_ &gt; <em>实用程序</em> &gt; <em>设置 ...</em> &gt; <em>ABAP 编辑器</em> &gt; _格式优化器_下进行指定。</p> <p>按照团队的协商设置_缩进_和_转换大写/小写_ &gt; <em>大写关键字</em>。</p> <blockquote> <p><a href=sub-sections/UpperVsLowerCase>大写字母与小写字母</a>解释了为什么我们没有为关键字的大小写提供明确的指导。 更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 5: Formatting: Team Rules</em>。</p> </blockquote> <h3 id=_115>每行只有一条语句<a class=headerlink href=#_115 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#no-more-than-one-statement-per-line>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>do_this</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span>
<span class=nv>do_this</span> <span class=o>=</span> <span class=nv>input</span> <span class=o>+</span> <span class=mi>3</span><span class=p>.</span>
</code></pre></div> <p>即使某些情况可能使您误以为这是可读的：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span> <span class=nv>do_this</span> <span class=k>TYPE </span><span class=nv>i</span><span class=p>.</span> <span class=nv>do_this</span> <span class=o>=</span> <span class=nv>input</span> <span class=o>+</span> <span class=mi>3</span><span class=p>.</span>
</code></pre></div> <h3 id=_116>恪守合理的行长度<a class=headerlink href=#_116 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#stick-to-a-reasonable-line-length>本节</a></p> </blockquote> <p>遵守最多 120 个字符的行长度。</p> <p>如果行距不是很宽，人眼可以更舒适地阅读文字——请在UI 设计师或眼动研究人员建议下做出您的选择。在调试或比较相邻的两行源代码时，如果代码行更窄一些，您会心生感激之情的。</p> <p>老的终端设备的 80 个甚至 72 个字符的限制太过严格了。虽然通常建议使用 100 个字符（这是一个可行的选择），但对于 ABAP 来说，最好使用 120 个字符，这可能是因为这种语言一般较为冗长。</p> <blockquote> <p>提醒一下，您可以在 ADT 中将打印边距配置为 120 个字符，然后在代码视图中将其显示为垂直线。在_菜单_ &gt; <em>窗口</em> &gt; <em>首选项</em> &gt; <em>常规</em> &gt; <em>编辑器</em> &gt; _文本编辑器_下进行配置。</p> </blockquote> <h3 id=_117>紧缩代码<a class=headerlink href=#_117 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#condense-your-code>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=o>=</span> <span class=nv>calculate</span><span class=p>(</span> <span class=nv>items</span> <span class=p>).</span>
</code></pre></div> <p>而不是添加不必要的空格</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span>        <span class=o>=</span>      <span class=nv>calculate</span><span class=p>(</span>    <span class=nv>items</span> <span class=o>=</span>   <span class=nv>items</span> <span class=p>)</span>   <span class=p>.</span>
</code></pre></div> <h3 id=_118>添加单一空行来分隔内容，而不要添加多行<a class=headerlink href=#_118 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#add-a-single-blank-line-to-separate-things-but-not-more>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=o>=</span> <span class=nv>do_something</span><span class=p>(</span> <span class=p>).</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>else</span><span class=p>)</span> <span class=o>=</span> <span class=nv>calculate_this</span><span class=p>(</span> <span class=nv>result</span> <span class=p>).</span>
</code></pre></div> <p>强调这两条语句做的是不同的事情。但没必要 <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=o>=</span> <span class=nv>do_something</span><span class=p>(</span> <span class=p>).</span>



<span class=k>DATA</span><span class=p>(</span><span class=nv>else</span><span class=p>)</span> <span class=o>=</span> <span class=nv>calculate_this</span><span class=p>(</span> <span class=nv>result</span> <span class=p>).</span>
</code></pre></div></p> <p>添加分隔空行可能表明您的方法没有在<a href=#do-one-thing-do-it-well-do-it-only>做一件事</a>。</p> <h3 id=_119>勿因分隔空行产生困扰<a class=headerlink href=#_119 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#dont-obsess-with-separating-blank-lines>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>
  <span class=nv>do_this</span><span class=p>(</span> <span class=p>).</span>
  <span class=nv>then_that</span><span class=p>(</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>没有理由养成用空行将代码分开的坏习惯 </p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>

  <span class=nv>do_this</span><span class=p>(</span> <span class=p>).</span>

  <span class=nv>then_that</span><span class=p>(</span> <span class=p>).</span>

<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>空行实际上仅在您有跨越多行的语句时才有意义</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>

  <span class=nv>do_this</span><span class=p>(</span> <span class=p>).</span>

  <span class=nv>then_that</span><span class=p>(</span>
    <span class=k>EXPORTING</span>
      <span class=nv>variable</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span>
    <span class=k>IMPORTING</span>
      <span class=nv>result</span>   <span class=o>=</span> <span class=nv>result</span> <span class=p>).</span>

<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h3 id=_120>对齐同一对象而非不同对象的赋值<a class=headerlink href=#_120 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#align-assignments-to-the-same-object-but-not-to-different-ones>本节</a></p> </blockquote> <p>为了强调这些事物在某种程度上是属于一起的</p> <div class=highlight><pre><span></span><code><span class=nv>structure</span><span class=o>-</span><span class=nv>type</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span><span class=p>.</span>
<span class=nv>structure</span><span class=o>-</span><span class=nv>id</span>   <span class=o>=</span> <span class=s1>&#39;4711&#39;</span><span class=p>.</span>
</code></pre></div> <p>或者这样更好</p> <div class=highlight><pre><span></span><code><span class=nv>structure</span> <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=nv>type</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span>
                     <span class=k>id</span>   <span class=o>=</span> <span class=s1>&#39;4711&#39;</span> <span class=p>).</span>
</code></pre></div> <p>而对于那些彼此无关的事物，仍保留参差不齐的状态：</p> <div class=highlight><pre><span></span><code><span class=nv>customizing_reader</span> <span class=o>=</span> <span class=nv>fra_cust_obj_model_reader</span><span class=o>=&gt;</span><span class=nf>s_get_instance</span><span class=p>(</span> <span class=p>).</span>
<span class=nv>hdb_access</span> <span class=o>=</span> <span class=nv>fra_hdbr_access</span><span class=o>=&gt;</span><span class=nf>s_get_instance</span><span class=p>(</span> <span class=p>).</span>
</code></pre></div> <blockquote> <p>更多信息参阅 <a href=https://www.oreilly.com/library/view/clean-code/9780136083238/ >Robert C. Martin 所著的 <em>Clean Code</em></a> 中的 <em>Chapter 5: Formatting: Horizontal Alignment</em>。</p> </blockquote> <h3 id=_121>在行尾关闭括号<a class=headerlink href=#_121 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#close-brackets-at-line-end>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>modify</span><span class=o>-&gt;</span><span class=nf>update</span><span class=p>(</span> <span class=nv>node</span>           <span class=o>=</span> <span class=nv>if_fra_alert_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
                <span class=k>key</span>            <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
                <span class=k>data</span>           <span class=o>=</span> <span class=nv>item</span>
                <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>modify</span><span class=o>-&gt;</span><span class=nf>update</span><span class=p>(</span> <span class=nv>node</span>           <span class=o>=</span> <span class=nv>if_fra_alert_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
                <span class=k>key</span>            <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
                <span class=k>data</span>           <span class=o>=</span> <span class=nv>item</span>
                <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span>
<span class=p>).</span>
</code></pre></div> <h3 id=_122>保持单参数调用于一行<a class=headerlink href=#_122 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#keep-single-parameter-calls-on-one-line>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>unique_list</span><span class=p>)</span> <span class=o>=</span> <span class=nv>remove_duplicates</span><span class=p>(</span> <span class=nv>list</span> <span class=p>).</span>
<span class=nv>remove_duplicates</span><span class=p>(</span> <span class=k>CHANGING</span> <span class=nv>list</span> <span class=o>=</span> <span class=nv>list</span> <span class=p>).</span>
</code></pre></div> <p>而不是毫无必要地加长</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>unique_list</span><span class=p>)</span> <span class=o>=</span> <span class=nv>remove_duplicates</span><span class=p>(</span>
                           <span class=nv>list</span> <span class=p>).</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>unique_list</span><span class=p>)</span> <span class=o>=</span> <span class=nv>remove_duplicates</span><span class=p>(</span>
                         <span class=k>CHANGING</span>
                           <span class=nv>list</span> <span class=o>=</span> <span class=nv>list</span> <span class=p>).</span>
</code></pre></div> <h3 id=_123>保持参数在调用后面<a class=headerlink href=#_123 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#keep-parameters-behind-the-call>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>add_two_numbers</span><span class=p>(</span> <span class=nv>value_1</span> <span class=o>=</span> <span class=mi>5</span>
                             <span class=nv>value_2</span> <span class=o>=</span> <span class=mi>6</span> <span class=p>).</span>
</code></pre></div> <p>如果这造成行很长，可以换行，将参数转到下一行：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>add_two_numbers</span><span class=p>(</span>
                   <span class=nv>value_1</span> <span class=o>=</span> <span class=nv>round_up</span><span class=p>(</span> <span class=nv>input</span> <span class=nv>DIV</span> <span class=mi>7</span> <span class=p>)</span> <span class=o>*</span> <span class=mi>42</span> <span class=o>+</span> <span class=nv>round_down</span><span class=p>(</span> <span class=mi>19</span> <span class=o>*</span> <span class=nv>step_size</span> <span class=p>)</span>
                   <span class=nv>value_2</span> <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=p>(</span> <span class=s1>`Calculation failed with a very weird result`</span> <span class=p>)</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <h3 id=_124>如果换行，则在调用下缩进参数<a class=headerlink href=#_124 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#if-you-break-indent-parameters-under-the-call>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>add_two_numbers</span><span class=p>(</span>
                   <span class=nv>value_1</span> <span class=o>=</span> <span class=mi>5</span>
                   <span class=nv>value_2</span> <span class=o>=</span> <span class=mi>6</span> <span class=p>).</span>
</code></pre></div> <p>在其他地方对齐参数将导致很难发现它们所属的对象：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>add_two_numbers</span><span class=p>(</span>
    <span class=nv>value_1</span> <span class=o>=</span> <span class=mi>5</span>
    <span class=nv>value_2</span> <span class=o>=</span> <span class=mi>6</span> <span class=p>).</span>
</code></pre></div> <p>但是，如果要避免因名称长度更改而破坏格式，这就是最佳模式了。</p> <h3 id=_125>将多个参数换行<a class=headerlink href=#_125 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#line-break-multiple-parameters>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>add_two_numbers</span><span class=p>(</span> <span class=nv>value_1</span> <span class=o>=</span> <span class=mi>5</span>
                             <span class=nv>value_2</span> <span class=o>=</span> <span class=mi>6</span> <span class=p>).</span>
</code></pre></div> <p>是的，这浪费了空间。但是如果不这样，就很难确定一个参数在哪里结束而下一个在哪里开始：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>add_two_numbers</span><span class=p>(</span> <span class=nv>value_1</span> <span class=o>=</span> <span class=mi>5</span> <span class=nv>value_2</span> <span class=o>=</span> <span class=mi>6</span> <span class=p>).</span>
</code></pre></div> <h3 id=_126>对齐参数<a class=headerlink href=#_126 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#align-parameters>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>modify</span><span class=o>-&gt;</span><span class=nf>update</span><span class=p>(</span> <span class=nv>node</span>           <span class=o>=</span> <span class=nv>if_fra_alert_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
                <span class=k>key</span>            <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
                <span class=k>data</span>           <span class=o>=</span> <span class=nv>item</span>
                <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span> <span class=p>).</span>
</code></pre></div> <p>边距参差不齐，使得很难看到参数的结束位置以及参数值的开始位置：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>modify</span><span class=o>-&gt;</span><span class=nf>update</span><span class=p>(</span> <span class=nv>node</span> <span class=o>=</span> <span class=nv>if_fra_alert_c</span><span class=o>=&gt;</span><span class=nv>node</span><span class=o>-</span><span class=nv>item</span>
                <span class=k>key</span> <span class=o>=</span> <span class=nv>item</span><span class=o>-&gt;</span><span class=nv>key</span>
                <span class=k>data</span> <span class=o>=</span> <span class=nv>item</span>
                <span class=nv>changed_fields</span> <span class=o>=</span> <span class=nv>changed_fields</span> <span class=p>).</span>
</code></pre></div> <blockquote> <p>如果要避免因名称长度更改而破坏格式，这就是另一种最佳模式了。</p> </blockquote> <h3 id=_127>如果调用行过长则将其换行<a class=headerlink href=#_127 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#break-the-call-to-a-new-line-if-the-line-gets-too-long>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>some_super_long_param_name</span><span class=p>)</span> <span class=o>=</span>
  <span class=nv>if_some_annoying_interface~add_two_numbers_in_a_long_name</span><span class=p>(</span>
      <span class=nv>value_1</span> <span class=o>=</span> <span class=mi>5</span>
      <span class=nv>value_2</span> <span class=o>=</span> <span class=mi>6</span> <span class=p>).</span>
</code></pre></div> <h3 id=_128>缩进并卡到制表位<a class=headerlink href=#_128 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#indent-and-snap-to-tab>本节</a></p> </blockquote> <p>将参数关键字缩进 2 个空格，并将参数缩进 4 个空格：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>add_two_numbers</span><span class=p>(</span>
              <span class=k>EXPORTING</span>
                <span class=nv>value_1</span> <span class=o>=</span> <span class=mi>5</span>
                <span class=nv>value_2</span> <span class=o>=</span> <span class=mi>6</span>
              <span class=k>CHANGING</span>
                <span class=nv>errors</span>  <span class=o>=</span> <span class=nv>errors</span> <span class=p>).</span>
</code></pre></div> <p>如果没有关键字，则将参数缩进 4 个空格。</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>sum</span><span class=p>)</span> <span class=o>=</span> <span class=nv>add_two_numbers</span><span class=p>(</span>
                <span class=nv>value_1</span> <span class=o>=</span> <span class=mi>5</span>
                <span class=nv>value_2</span> <span class=o>=</span> <span class=mi>6</span> <span class=p>).</span>
</code></pre></div> <p>使用 Tab 键缩进。就算多加了一个空格也没有关系。（如果左侧 <code>DATA(sum) =</code> 部分的字符数非偶数，则会发生这种情况。）</p> <h3 id=_129>如同方法调用那样缩进内联声明<a class=headerlink href=#_129 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#indent-in-line-declarations-like-method-calls>本节</a></p> </blockquote> <p>按照与方法调用相同的方式，使用 VALUE 或 NEW 缩进内联声明：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>result</span><span class=p>)</span> <span class=o>=</span> <span class=nv>merge_structures</span><span class=p>(</span> <span class=nv>a</span> <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=nv>field_1</span> <span class=o>=</span> <span class=s1>&#39;X&#39;</span>
                                              <span class=nv>field_2</span> <span class=o>=</span> <span class=s1>&#39;A&#39;</span> <span class=p>)</span>
                                 <span class=nv>b</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>structure_type</span><span class=p>(</span> <span class=nv>field_3</span> <span class=o>=</span> <span class=s1>&#39;C&#39;</span>
                                                                <span class=nv>field_4</span> <span class=o>=</span> <span class=s1>&#39;D&#39;</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <h3 id=_130>勿对齐类型子句<a class=headerlink href=#_130 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#formatting>格式化</a> &gt; <a href=#dont-align-type-clauses>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>name</span> <span class=k>TYPE </span><span class=nv>seoclsname</span><span class=p>.</span>
<span class=k>DATA</span> <span class=nv>reader</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>reader</span><span class=p>.</span>
</code></pre></div> <p>变量及其类型属于同一类，因此从视觉上来说应将其分为一组。将 <code>TYPE</code> 子句对齐会使人们的分心，并建议这些变量形成一个垂直组，而它们的类型形成一个垂直组。对齐还会产生不必要的编辑开销，当最长变量名的长度发生变化时，需要调整所有的缩进。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span> <span class=nv>name</span>   <span class=k>TYPE </span><span class=nv>seoclsname</span><span class=p>.</span>
<span class=k>DATA</span> <span class=nv>reader</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>reader</span><span class=p>.</span>
</code></pre></div> <h2 id=_131>测试<a class=headerlink href=#_131 title="Permanent link">&para;</a></h2> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>本节</a></p> </blockquote> <h3 id=_132>原则<a class=headerlink href=#_132 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#principles>本节</a></p> </blockquote> <h4 id=_133>编写可测试的代码<a class=headerlink href=#_133 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#principles>原则</a> &gt; <a href=#write-testable-code>本节</a></p> </blockquote> <p>编写的所有代码应该允许您以自动方式测试。</p> <p>如果需要重构您的代码，那就重构。并在开始添加其他功能之前重构。</p> <p>如果添加到的旧代码结构过于混乱而无法测试，那么至少要对其进行重构到您新添加部分能够测试。</p> <h4 id=_134>让他人能够进行模拟<a class=headerlink href=#_134 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#principles>原则</a> &gt; <a href=#enable-others-to-mock-you>本节</a></p> </blockquote> <p>如果要编写供其他人使用的代码，请让他们能够为自己的代码编写单元测试，例如通过在所有对外交互的位置添加接口，提供有助于促进集成测试的测试替身，或应用依赖倒置使他们能够用测试配置替代生产配置。</p> <h4 id=_135>可读性规则<a class=headerlink href=#_135 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#principles>原则</a> &gt; <a href=#readability-rules>本节</a></p> </blockquote> <p>让您的测试代码比生产代码更具可读性。您可以通过有效的测试来处理糟糕的生产代码，但是，可能您甚至还未进行测试，就已经把自己弄懵了。</p> <p>保持您的测试代码保持简单、傻瓜，这样您一年后仍然能够理解它。</p> <p>遵守标准和模式，使您的同事能够快速了解代码。</p> <h4 id=_136>勿制作副本或写测试报告<a class=headerlink href=#_136 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#principles>原则</a> &gt; <a href=#dont-make-copies-or-write-test-reports>本节</a></p> </blockquote> <p>不要通过制作一个开发对象的 <code>$TMP</code> 副本并反复研究来处理开发项。其他人不会注意到这些对象，因此不会知道您的工作状态。您可能会在一开始就浪费大量的时间来制作工作副本，之后您也可能会忘记删除副本，这些副本对于系统和依赖项来说是没用的垃圾。（不相信？立刻看看开发系统并检查一下 <code>$TMP</code>。）</p> <p>另外，不要一开始就编写以特定方式调用某些内容的测试报告，并重复此操作以验证您在运行代码时是否一切正常。这是糟糕的手动测试：手动重复测试报告，目视验证一切是否正常。往前迈一步，在单元测试中自动执行此报告，使用自动断言告诉您代码是否仍然正常运行。这样的好处有，，您不需要进行之后必须编写单元测试的工作。其次，您可以节省进行手动重复所用的大量时间，另外还可以避免感到无聊和疲劳。</p> <h4 id=_137>测试公共项而非私有内部项<a class=headerlink href=#_137 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#principles>原则</a> &gt; <a href=#test-publics-not-private-internals>本节</a></p> </blockquote> <p>类的公共项部分，尤其是它们实现的接口，相当稳定并且不太可能发生更改。让您的单元测试仅验证公共项，使其稳定可靠，并最大程度地减少重构类时所需的工作量。相比之下，受保护的和私有的内部项可能会通过重构而快速变化，这样，每次重构都会不必要地中断您的测试。</p> <p>测试私有方法或受保护方法的迫切需求可能是几个早期设计缺陷的警告信号。问问您自己以下问题：</p> <ul> <li> <p>您是否意外地在您的类中埋没了一个概念，这个概念本该公开到其自己的类并使用其专用测试套件？</p> </li> <li> <p>您是否忘记将域逻辑与粘合代码分开？例如，直接在类中实施作为操作、确定或验证插入到 BOPF 的域逻辑，或者由 SAP Gateway 作为 <code>*_DPC_EXT</code> 数据提供者生成的域逻辑，可能不是上策。</p> </li> <li> <p>接口是不是太过复杂、请求过多无关的数据或者无法轻松进行模拟？</p> </li> </ul> <h4 id=_138>勿困扰于覆盖范围<a class=headerlink href=#_138 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#principles>原则</a> &gt; <a href=#dont-obsess-about-coverage>本节</a></p> </blockquote> <p>代码覆盖范围可以帮助您找到忘记测试的代码，而不是满足某些随机的 KPI：</p> <p>不要仅为了达到覆盖范围而在包含或不含虚拟断言的情况下编写测试。最好保留未经测试的内容，以表明您不能安全地进行重构。您可以拥有小于 100％ 的覆盖范围，并且仍然可以进行完美的测试。在某些情况下，例如在构造函数中使用 IF 插入测试替身时，可能无法达到 100％。好的测试往往会针对不同的分支和条件多次覆盖同一条语句。实际上，这些测试的假想覆盖率大于 100％。</p> <h3 id=_139>测试类<a class=headerlink href=#_139 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-classes>本节</a></p> </blockquote> <h4 id=_140>按用途调用局部测试类<a class=headerlink href=#_140 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-classes>测试类</a> &gt; <a href=#call-local-test-classes-by-their-purpose>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=nv>ltc_unit_tests</span> <span class=k>DEFINITION</span> <span class=k>FOR</span> <span class=nv>TESTING</span> <span class=p>...</span> <span class=p>.</span>
<span class=k>CLASS</span> <span class=nv>ltc_integration_tests</span> <span class=k>DEFINITION</span> <span class=k>FOR</span> <span class=nv>TESTING</span> <span class=p>...</span> <span class=p>.</span>
<span class=k>CLASS</span> <span class=nv>ltc_unit_tests_with_mocks</span> <span class=k>DEFINITION</span> <span class=k>FOR</span> <span class=nv>TESTING</span> <span class=p>...</span> <span class=p>.</span>
</code></pre></div> <p>良好的名称可以揭示测试的级别以及公有设置部分。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-patterns</span>
<span class=k>CLASS</span> <span class=nv>ltc_fra_online_detection_api</span> <span class=k>DEFINITION</span> <span class=k>FOR</span> <span class=nv>TESTING</span> <span class=p>...</span> <span class=p>.</span> <span class=c1>&quot; We know that&#39;s the class under test - why repeat it?</span>
<span class=k>CLASS</span> <span class=nv>ltc_test</span> <span class=k>DEFINITION</span> <span class=k>FOR</span> <span class=nv>TESTING</span> <span class=p>....</span>                      <span class=c1>&quot; Of course it&#39;s a test, what else should it be?</span>
</code></pre></div> <h4 id=_141>将测试放在局部类<a class=headerlink href=#_141 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-classes>测试类</a> &gt; <a href=#put-tests-in-local-classes>本节</a></p> </blockquote> <p>将单元测试放入被测类的局部测试包含文件中。这样可以确保人们在重构该类时能够找到这些测试，并允许他们通过按一次按键运行所有相关的测试，如<a href=#how-to-execute-test-classes>如何执行测试类</a>中所述。</p> <p>将组件测试、集成测试和系统测试放入包含单独全局类的局部测试中。它们与被测的单个类没有直接关系，因此不应随意将它们放在某个相关类中，而是应放在一个单独的类中。将此全局测试类标记为 <code>FOR TESTING</code> 和 <code>ABSTRACT</code>，以避免在生产代码中意外地引用该类。将测试放到其他类中存在这样的危险，即人们在重构所涉及的类时忽略并忘记运行这些测试。</p> <p>因此，使用*测试关系*来记录已测试的对象是有好处的。在下面的例子中，可以在类 <code>recruting</code> 或 <code>candidate</code> 中或通过快捷键 <code>Shift-Crtl-F12</code> (Windows) 或 <code>Cmd-Shift-F12</code> (macOS) 执行测试类 <code>hiring_test</code>。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot;! @testing recruting</span>
<span class=c1>&quot;! @testing candidate</span>
<span class=k>class</span> <span class=nv>hiring_test</span> <span class=nv>defintion</span>
  <span class=k>for</span> <span class=nv>testing</span> <span class=nv>risk</span> <span class=nv>level</span> <span class=nv>dangerous</span> <span class=nv>duration</span> <span class=nv>medium</span>
  <span class=k>abstract</span><span class=p>.</span>
  <span class=p>...</span>
<span class=k>endclass</span><span class=p>.</span>
</code></pre></div> <h4 id=_142>将帮助方法放在帮助类<a class=headerlink href=#_142 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-classes>测试类</a> &gt; <a href=#put-help-methods-in-help-classes>本节</a></p> </blockquote> <p>将若干测试类使用的帮助方法放在帮助类中。通过继承（关系）或委托（具有关系）使帮助方法可用。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; inheritance example</span>

<span class=k>CLASS</span> <span class=nv>lth_unit_tests</span> <span class=k>DEFINITION</span> <span class=k>ABSTRACT</span> <span class=k>FOR</span> <span class=nv>TESTING</span>
  <span class=nv>DURATION</span> <span class=nv>SHORT</span>
  <span class=nv>RISK</span> <span class=nv>LEVEL</span> <span class=nv>HARMLESS</span><span class=p>.</span>

  <span class=k>PROTECTED SECTION</span><span class=p>.</span>
    <span class=k>CLASS-METHODS</span> <span class=nv>assert_activity_entity</span>
      <span class=k>IMPORTING</span>
        <span class=nv>actual_activity_entity</span> <span class=k>TYPE REF TO</span> <span class=nv>zcl_activity_entity</span>
        <span class=nv>expected_activity_entity</span> <span class=k>TYPE REF TO</span> <span class=nv>zcl_activity_entity</span><span class=p>.</span>
    <span class=p>...</span>
<span class=k>ENDCLASS</span><span class=p>.</span>

<span class=k>CLASS</span> <span class=nv>lth_unit_tests</span> <span class=k>IMPLEMENTATION</span><span class=p>.</span>

  <span class=k>METHOD</span> <span class=nf>assert_activity_entity</span><span class=p>.</span>
    <span class=p>...</span>
  <span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=k>ENDCLASS</span><span class=p>.</span>

<span class=k>CLASS</span> <span class=nv>ltc_unit_tests</span> <span class=k>DEFINITION</span> <span class=k>INHERITING FROM</span> <span class=nv>lth_unit_tests</span> <span class=nv>FINAL</span> <span class=k>FOR</span> <span class=nv>TESTING</span>
  <span class=nv>DURATION</span> <span class=nv>SHORT</span>
  <span class=nv>RISK</span> <span class=nv>LEVEL</span> <span class=nv>HARMLESS</span><span class=p>.</span>
  <span class=p>...</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <h4 id=_143>如何执行测试类<a class=headerlink href=#_143 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-classes>测试类</a> &gt; <a href=#how-to-execute-test-classes>本节</a></p> </blockquote> <p>在 ABAP 开发工具中，按 Ctrl+Shift+F10 运行某个类中的所有测试。按 Ctrl+Shift+F11 以包括覆盖范围测量。按 Ctrl+Shift+F12 还可运行作为测试关系维护的其他类中的测试。</p> <blockquote> <p>在 macOS 中，使用 <code>Cmd</code> 而不是 <code>Ctrl</code>。</p> </blockquote> <h3 id=_144>被测代码<a class=headerlink href=#_144 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#code-under-test>本节</a></p> </blockquote> <h4 id=cut>赋予被测代码有意义的名称，或使用缺省名称 CUT<a class=headerlink href=#cut title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#code-under-test>被测代码</a> &gt; <a href=#name-the-code-under-test-meaningfully-or-default-to-cut>本节</a></p> </blockquote> <p>为被测代码的变量提供一个有意义的名称：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>blog_post</span> <span class=k>TYPE REF TO</span> <span class=p>...</span>
</code></pre></div> <p>不要只使用类名称的所有无价值的命名空间和前缀来重复类名称：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span> <span class=nv>clean_fra_blog_post</span> <span class=k>TYPE REF TO</span> <span class=p>...</span>
</code></pre></div> <p>如果您具有不同的测试设置，且对描述对象的变化状态可能会有所帮助：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>empty_blog_post</span> <span class=k>TYPE REF TO</span> <span class=p>...</span>
<span class=k>DATA</span> <span class=nv>simple_blog_post</span> <span class=k>TYPE REF TO</span> <span class=p>...</span>
<span class=k>DATA</span> <span class=nv>very_long_blog_post</span> <span class=k>TYPE REF TO</span> <span class=p>...</span>
</code></pre></div> <p>如果想不到起什么名称有意义，请使用缺省名称 <code>cut</code>。该缩写代表“code under test”。</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>cut</span> <span class=k>TYPE REF TO</span> <span class=p>...</span>
</code></pre></div> <p>特别是在不整洁且令人困惑的测试中，调用变量 <code>cut</code> 可以暂时帮助读者查看实际测试的内容。然而，从长远来看，整理测试才是真正有效的方法。</p> <h4 id=_145>测试接口而非类<a class=headerlink href=#_145 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#code-under-test>被测代码</a> &gt; <a href=#test-interfaces-not-classes>本节</a></p> </blockquote> <p><a href=#test-publics-not-private-internals><em>测试公共项而非私有内部项</em></a>的实际结果是，使用_接口_输入您的被测代码</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span> <span class=nv>code_under_test</span> <span class=k>TYPE REF TO</span> <span class=nv>some_interface</span><span class=p>.</span>
</code></pre></div> <p>而不是_类_</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span> <span class=nv>code_under_test</span> <span class=k>TYPE REF TO</span> <span class=nv>some_class</span><span class=p>.</span>
</code></pre></div> <h4 id=_146>将被测代码的调用提取到自身的方法<a class=headerlink href=#_146 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#code-under-test>被测代码</a> &gt; <a href=#extract-the-call-to-the-code-under-test-to-its-own-method>本节</a></p> </blockquote> <p>如果要测试的方法需要大量参数或准备好的数据，有必要将对它的调用提取到它自己的帮助方法中，该方法预设了不那么重要的参数：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>map_xml_to_itab</span>
  <span class=k>IMPORTING</span>
    <span class=nv>xml_string</span> <span class=k>TYPE </span><span class=nv>string</span>
    <span class=nv>config</span>     <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>xml2itab_config</span> <span class=k>DEFAULT</span> <span class=nv>default_config</span>
    <span class=k>format</span>     <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>xml2itab_format</span> <span class=k>DEFAULT</span> <span class=nv>default_format</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>map_xml_to_itab</span><span class=p>.</span>
  <span class=nv>result</span> <span class=o>=</span> <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>map_xml_to_itab</span><span class=p>(</span> <span class=nv>xml_string</span> <span class=o>=</span> <span class=nv>xml_string</span>
                                 <span class=nv>config</span>     <span class=o>=</span> <span class=nv>config</span>
                                 <span class=k>format</span>     <span class=o>=</span> <span class=k>format</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=k>DATA</span><span class=p>(</span><span class=nv>itab</span><span class=p>)</span> <span class=o>=</span> <span class=nv>map_xml_to_itab</span><span class=p>(</span> <span class=s1>&#39;&lt;xml&gt;&lt;/xml&gt;&#39;</span> <span class=p>).</span>
</code></pre></div> <p>直接调用原始方法会让您的测试陷入很多无意义的细枝末节：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>itab</span><span class=p>)</span> <span class=o>=</span> <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>map_xml_to_itab</span><span class=p>(</span> <span class=nv>xml_string</span> <span class=o>=</span> <span class=s1>&#39;&lt;xml&gt;&lt;/xml&gt;&#39;</span>
                                   <span class=nv>config</span>     <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=s1>&#39;some meaningless stuff&#39;</span> <span class=p>)</span>
                                   <span class=k>format</span>     <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=s1>&#39;more meaningless stuff&#39;</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <h3 id=_147>注入<a class=headerlink href=#_147 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>本节</a></p> </blockquote> <h4 id=_148>使用依赖倒置注入测试替身<a class=headerlink href=#_148 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#use-dependency-inversion-to-inject-test-doubles>本节</a></p> </blockquote> <p>依赖倒置意味着您将所有依赖项传递给构造函数：</p> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>constructor</span>
  <span class=k>IMPORTING</span>
    <span class=nv>customizing_reader</span> <span class=k>TYPE REF TO</span> <span class=nv>if_fra_cust_obj_model_reader</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>constructor</span><span class=p>.</span>
  <span class=nv>me</span><span class=o>-&gt;</span><span class=nv>customizing_reader</span> <span class=o>=</span> <span class=nv>customizing_reader</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>不要使用 setter 注入，这样做会以非预期方式使用生产代码：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHODS</span> <span class=nv>set_customizing_reader</span>
  <span class=k>IMPORTING</span>
    <span class=nv>customizing_reader</span> <span class=k>TYPE REF TO</span> <span class=nv>if_fra_cust_obj_model_reader</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>do_something</span><span class=p>.</span>
  <span class=k>object</span><span class=o>-&gt;</span><span class=nf>set_customizing_reader</span><span class=p>(</span> <span class=nv>a</span> <span class=p>).</span>
  <span class=k>object</span><span class=o>-&gt;</span><span class=nf>set_customizing_reader</span><span class=p>(</span> <span class=nv>b</span> <span class=p>).</span> <span class=c1>&quot; would you expect that somebody does this?</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>不要使用 FRIENDS 注入，这会在替换生产依赖项之前对其进行初始化，产生意想不到的后果。当您重命名内部项后，它将立即中断。它还会绕过构造函数中的初始化。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>setup</span><span class=p>.</span>
  <span class=nv>cut</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=nv>fra_my_class</span><span class=p>(</span> <span class=p>).</span> <span class=c1>&quot; &lt;- builds a productive customizing_reader first - what will it break with that?</span>
  <span class=nv>cut</span><span class=o>-&gt;</span><span class=nv>customizing_reader</span> <span class=o>?=</span> <span class=nv>cl_abap_testdouble</span><span class=o>=&gt;</span><span class=nf>create</span><span class=p>(</span> <span class=s1>&#39;if_fra_cust_obj_model_reader&#39;</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>constructor</span><span class=p>.</span>
  <span class=nv>customizing_reader</span> <span class=o>=</span> <span class=nv>fra_cust_obj_model_reader</span><span class=o>=&gt;</span><span class=nf>s_get_instance</span><span class=p>(</span> <span class=p>).</span>
  <span class=nv>customizing_reader</span><span class=o>-&gt;</span><span class=nf>fill_buffer</span><span class=p>(</span> <span class=p>).</span> <span class=c1>&quot; &lt;- won&#39;t be called on your test double, so no chance to test this</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h4 id=abap_1>考虑使用 ABAP 测试替身工具<a class=headerlink href=#abap_1 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#consider-to-use-the-tool-abap-test-double>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>customizing_reader</span><span class=p>)</span> <span class=o>=</span> <span class=nv>CAST</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>customizing_reader</span><span class=p>(</span> <span class=nv>cl_abap_testdouble</span><span class=o>=&gt;</span><span class=nf>create</span><span class=p>(</span> <span class=s1>&#39;/clean/default_custom_reader&#39;</span> <span class=p>)</span> <span class=p>).</span>
<span class=nv>cl_abap_testdouble</span><span class=o>=&gt;</span><span class=nf>configure_call</span><span class=p>(</span> <span class=nv>customizing_reader</span> <span class=p>)</span><span class=o>-&gt;</span><span class=nf>returning</span><span class=p>(</span> <span class=nv>sub_claim_customizing</span> <span class=p>).</span>
<span class=nv>customizing_reader</span><span class=o>-&gt;</span><span class=nf>read</span><span class=p>(</span> <span class=s1>&#39;SOME_ID&#39;</span> <span class=p>).</span>
</code></pre></div> <p>与自定义测试替身相比，更短、更容易理解：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>CLASS</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>default_custom_reader</span> <span class=k>DEFINITION</span> <span class=k>FOR</span> <span class=nv>TESTING</span> <span class=k>CREATE PUBLIC</span><span class=p>.</span>
  <span class=k>PUBLIC SECTION</span><span class=p>.</span>
    <span class=k>INTERFACES</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>customizing_reader</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>customizing</span> <span class=nv>TYPE</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>customizing_table</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>

<span class=k>CLASS</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>default_custom_reader</span> <span class=k>IMPLEMENTATION</span><span class=p>.</span>
  <span class=k>METHOD</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>customizing_reader~read</span><span class=p>.</span>
    <span class=nv>result</span> <span class=o>=</span> <span class=nv>customizing</span><span class=p>.</span>
  <span class=k>ENDMETHOD</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>test_something</span><span class=p>.</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>customizing_reader</span><span class=p>)</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>customizing_reader</span><span class=p>(</span> <span class=p>).</span>
  <span class=nv>customizing_reader</span><span class=o>-&gt;</span><span class=nv>customizing</span> <span class=o>=</span> <span class=nv>sub_claim_customizing</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h4 id=_149>利用测试工具<a class=headerlink href=#_149 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#exploit-the-test-tools>本节</a></p> </blockquote> <p>一般来说，整洁的编程风格可以让您使用标准 ABAP 单元测试和测试替身完成大部分工作。但是，有些工具可以让您以优雅的方式处理更棘手的情况:</p> <ul> <li> <p>使用 <code>CL_OSQL_REPLACE</code> 服务测试复杂的 OpenSQL 语句，方法是将这些语句重定向到可在不影响系统其余部分的情况下填充测试数据的测试数据仓。</p> </li> <li> <p>使用 CDS 测试框架来测试您的 CDS 视图。</p> </li> </ul> <h4 id=_150>使用测试缝隙作为临时解决办法<a class=headerlink href=#_150 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#use-test-seams-as-temporary-workaround>本节</a></p> </blockquote> <p>如果所有其他技术都失败了，或者处于旧代码可能无法正常运行的情况下，应避免使用<a href="https://help.sap.com/doc/abapdocu_751_index_htm/7.51/en-US/index.htm?file=abendyn_access_data_obj_guidl.htm">测试缝隙</a>来增加可测试性。</p> <p>尽管第一眼看上去很舒服，但测试接缝是侵入性的，而且容易与私有依赖项纠缠在一起，从长远来看，它们很难保持活性和稳定性。</p> <p>因此，我们建议避免仅将测试接缝作为一种临时解决方法以将代码重构为更易于测试的形式。</p> <h4 id=local-friends>使用 LOCAL FRIENDS 访问依赖倒置的构造函数<a class=headerlink href=#local-friends title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#use-local-friends-to-access-the-dependency-inverting-constructor>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>unit_tests</span> <span class=k>DEFINITION</span><span class=p>.</span>
  <span class=k>PRIVATE SECTION</span><span class=p>.</span>
    <span class=k>DATA</span> <span class=nv>cut</span> <span class=k>TYPE REF TO</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>interface_under_test</span><span class=p>.</span>
    <span class=k>METHODS</span> <span class=nv>setup</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>

<span class=k>CLASS</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>class_under_test</span> <span class=k>DEFINITION</span> <span class=k>LOCAL</span> <span class=nv>FRIENDS</span> <span class=nv>unit_tests</span><span class=p>.</span>

<span class=k>CLASS</span> <span class=nv>unit_tests</span> <span class=k>IMPLEMENTATION</span><span class=p>.</span>
  <span class=k>METHOD</span> <span class=nf>setup</span><span class=p>.</span>
    <span class=k>DATA</span><span class=p>(</span><span class=nv>mock</span><span class=p>)</span> <span class=o>=</span> <span class=nv>cl_abap_testdouble</span><span class=o>=&gt;</span><span class=nf>create</span><span class=p>(</span> <span class=s1>&#39;/clean/some_mock&#39;</span> <span class=p>).</span>
    <span class=c1>&quot; /clean/class_under_test is CREATE PRIVATE</span>
     <span class=c1>&quot; so this only works because of the LOCAL FRIENDS</span>
    <span class=nv>cut</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>class_under_test</span><span class=p>(</span> <span class=nv>mock</span> <span class=p>).</span>
  <span class=k>ENDMETHOD</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <h4 id=local-friends_1>勿滥用 LOCAL FRIENDS 侵入被测代码<a class=headerlink href=#local-friends_1 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#dont-misuse-local-friends-to-invade-the-tested-code>本节</a></p> </blockquote> <p>访问私有成员和受保护成员以插入模拟数据的单元测试很脆弱：当测试代码的内部结构发生变化时，它们会中断。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>CLASS</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>class_under_test</span> <span class=k>DEFINITION</span> <span class=k>LOCAL</span> <span class=nv>FRIENDS</span> <span class=nv>unit_tests</span><span class=p>.</span>
<span class=k>CLASS</span> <span class=nv>unit_tests</span> <span class=k>IMPLEMENTATION</span><span class=p>.</span>
  <span class=k>METHOD</span> <span class=nf>returns_right_result</span><span class=p>.</span>
    <span class=nv>cut</span><span class=o>-&gt;</span><span class=nv>some_private_member</span> <span class=o>=</span> <span class=s1>&#39;AUNIT_DUMMY&#39;</span><span class=p>.</span>
  <span class=k>ENDMETHOD</span><span class=p>.</span>
<span class=k>ENDCLASS</span><span class=p>.</span>
</code></pre></div> <h4 id=_151>勿更改生产代码来使代码可测试<a class=headerlink href=#_151 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#dont-change-the-productive-code-to-make-the-code-testable>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>IF</span> <span class=nv>me</span><span class=o>-&gt;</span><span class=nv>in_test_mode</span> <span class=o>=</span> <span class=nv>abap_true</span><span class=p>.</span>
</code></pre></div> <h4 id=_152>勿子类化来模拟方法<a class=headerlink href=#_152 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#dont-sub-class-to-mock-methods>本节</a></p> </blockquote> <p>不要在单元测试中通过子类化和覆盖方法来模拟方法。尽管这是可行的，但这样的方法很脆弱，在重构代码时测试很容易中断。而且真正的使用者还可能继承您的类，<a href=#final-if-not-designed-for-inheritance>如果没有明确设计此功能，这可能会令您措手不及</a>。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>CLASS</span> <span class=nv>unit_tests</span> <span class=k>DEFINITION</span> <span class=k>INHERITING FROM</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>real_class</span> <span class=k>FOR</span> <span class=nv>TESTING</span> <span class=p>[...].</span>
  <span class=k>PROTECTED SECTION</span><span class=p>.</span>
    <span class=k>METHODS</span> <span class=nv>needs_to_be_mocked</span> <span class=k>REDEFINITION</span><span class=p>.</span>
</code></pre></div> <p>要获取旧被测代码，请<a href=#use-test-seams-as-temporary-workaround>改用测试接缝</a>。测试接缝同样脆弱，但至少不会改变类的生产行为（如通过删除先前的 <code>FINAL</code> 标志或将方法的作用域从 <code>PRIVATE</code> 更改为 <code>PROTECTED</code> 来启用继承时可能发生的行为），仍不失为一种更为整洁的方式。</p> <p>在编写新代码时，在设计类时应直接考虑此可测试性问题，并找到其他更好的方法。常见的最佳做法包括<a href=#exploit-the-test-tools>求助于其他测试工具</a>并将问题方法提取到本身具有接口的单独类中。</p> <blockquote> <p><a href=#dont-change-the-productive-code-to-make-the-code-testable>勿更改生产代码来使代码可测试</a>的更具体的变化形式。</p> </blockquote> <h4 id=_153>勿模拟不需要的东西<a class=headerlink href=#_153 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#dont-mock-stuff-thats-not-needed>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=nv>cut</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>class_under_test</span><span class=p>(</span> <span class=nv>db_reader</span> <span class=o>=</span> <span class=nv>db_reader</span>
                                   <span class=nv>config</span>    <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=p>)</span>
                                   <span class=nv>writer</span>    <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <p>尽可能精确地定义给定条件：不要设置测试不需要的数据，也不要模拟永远不会调用的对象。这些内容会分散读者对真实运行情况的注意力。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>cut</span> <span class=o>=</span> <span class=nv>NEW</span> <span class=p>/</span><span class=nv>dirty</span><span class=p>/</span><span class=nv>class_under_test</span><span class=p>(</span> <span class=nv>db_reader</span> <span class=o>=</span> <span class=nv>db_reader</span>
                                   <span class=nv>config</span>    <span class=o>=</span> <span class=nv>config</span>
                                   <span class=nv>writer</span>    <span class=o>=</span> <span class=nv>writer</span> <span class=p>).</span>
</code></pre></div> <p>在某些情况下，根本不需要模拟某些内容，数据结构和数据容器通常就是这种情况。例如，您的单元测试可以使用 <code>transient_log</code> 生产版本正常运行，因为该版本只存储数据而不会产生其他影响。</p> <h4 id=_154>勿构建测试框架<a class=headerlink href=#_154 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#injection>注入</a> &gt; <a href=#dont-build-test-frameworks>本节</a></p> </blockquote> <p>与集成测试不同，单元测试涉及数据输入和数据输出，所有测试数据都是根据需要动态定义的。</p> <div class=highlight><pre><span></span><code><span class=nv>cl_abap_testdouble</span><span class=o>=&gt;</span><span class=nf>configure_call</span><span class=p>(</span> <span class=nv>test_double</span> <span class=p>)</span><span class=o>-&gt;</span><span class=nf>returning</span><span class=p>(</span> <span class=k>data</span> <span class=p>).</span>
</code></pre></div> <p>不要开始构建用于区分“<em>测试案例标识</em>”的框架来决定要提供的数据。生成的代码将会如此冗长而复杂，以至于您无法长期保留这些测试。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>

<span class=nv>test_double</span><span class=o>-&gt;</span><span class=nf>set_test_case</span><span class=p>(</span> <span class=mi>1</span> <span class=p>).</span>

<span class=k>CASE</span> <span class=nv>me</span><span class=o>-&gt;</span><span class=nv>test_case</span><span class=p>.</span>
  <span class=k>WHEN</span> <span class=mi>1</span><span class=p>.</span>
  <span class=k>WHEN</span> <span class=mi>2</span><span class=p>.</span>
<span class=k>ENDCASE</span><span class=p>.</span>
</code></pre></div> <h3 id=_155>测试方法<a class=headerlink href=#_155 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-methods>本节</a></p> </blockquote> <h4 id=_156>测试方法名称：反映出设想和预期的情形<a class=headerlink href=#_156 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-methods>测试方法</a> &gt; <a href=#test-method-names-reflect-whats-given-and-expected>本节</a></p> </blockquote> <p>好的名称可以反映出测试的设想内容和预期结果：</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>reads_existing_entry</span><span class=p>.</span>
<span class=k>METHOD</span> <span class=nf>throws_on_invalid_key</span><span class=p>.</span>
<span class=k>METHOD</span> <span class=nf>detects_invalid_input</span><span class=p>.</span>
</code></pre></div> <p>不恰当的名称则反映操作内容，重复无意义的事实或含糊不清：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-patterns</span>

<span class=c1>&quot; What&#39;s expected, success or failure?</span>
<span class=k>METHOD</span> <span class=nf>get_conversion_exits</span><span class=p>.</span>

<span class=c1>&quot; It&#39;s a test method, what else should it do but &quot;test&quot;?</span>
<span class=k>METHOD</span> <span class=nf>test_loop</span><span class=p>.</span>

<span class=c1>&quot; So it&#39;s parameterized, but what is its aim?</span>
<span class=k>METHOD</span> <span class=nf>parameterized_test</span><span class=p>.</span>

<span class=c1>&quot; What&#39;s &quot;_wo_w&quot; supposed to mean and will you still remember that in a year from now?</span>
<span class=k>METHOD</span> <span class=nf>get_attributes_wo_w</span><span class=p>.</span>
</code></pre></div> <p>由于 ABAP 只允许方法名称使用 30 个字符，如果名称过短而无法表达足够的含义，那么添加注释是合理的。在 ABAP 文档中或在测试方法的第一行添加注释都是不错的选择。</p> <p>如果有很多名称过长的测试方法，这可能意味着您应该将单个测试类拆分为多个测试类，并在类名称中的给定部分予以区别。</p> <h4 id=given-when-then>使用 given-when-then<a class=headerlink href=#given-when-then title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-methods>测试方法</a> &gt; <a href=#use-given-when-then>本节</a></p> </blockquote> <p>按照 given-when-then 范式组织测试代码：首先，初始化给定部分中的内容 ("given")，其次调用实际测试的内容 ("when")，再次验证结果 ("then")。</p> <p>如果 given 或 then 部分过长，您无法再从视觉上区分这三个部分，请提取子方法。空行或注释作为分隔符乍一看可能还不错，但并不能真正减少视觉混乱。尽管如此，空行或注释对于读者和测试新手区分这三个部分还是有所帮助的。</p> <h4 id=when>"When" 恰为一个调用<a class=headerlink href=#when title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-methods>测试方法</a> &gt; <a href=#when-is-exactly-one-call>本节</a></p> </blockquote> <p>确保测试方法的 "when" 部分仅包含对被测类的一次调用：</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>rejects_invalid_input</span><span class=p>.</span>
  <span class=c1>&quot; when</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>is_valid</span><span class=p>)</span> <span class=o>=</span> <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>is_valid_input</span><span class=p>(</span> <span class=s1>&#39;SOME_RANDOM_ENTRY&#39;</span> <span class=p>).</span>
  <span class=c1>&quot; then</span>
  <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_false</span><span class=p>(</span> <span class=nv>is_valid</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>调用多个对象表明该方法没有明确的焦点，测试内容过多。这使得测试失败时更难以找到原因：是第一次、第二次还是第三次调用导致了失败？这也使读者感到困惑，因为他不确定确切的被测功能是什么。</p> <h4 id=teardown>除非真正需要否则勿添加 TEARDOWN<a class=headerlink href=#teardown title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-methods>测试方法</a> &gt; <a href=#dont-add-a-teardown-unless-you-really-need-it>本节</a></p> </blockquote> <p>通常只需要使用 <code>teardown</code> 方法来清除数据库条目或集成测试中的其他外部资源。</p> <p>重置测试类的成员（尤其是 <code>cut</code> 和所用的测试替身）是多余的操作；在启动下一个测试方法之前，这些成员就会由 <code>setup</code> 方法覆盖。</p> <h3 id=_157>测试数据<a class=headerlink href=#_157 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-data>本节</a></p> </blockquote> <h4 id=_158>使其易于辨明含义<a class=headerlink href=#_158 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-data>测试数据</a> &gt; <a href=#make-it-easy-to-spot-meaning>本节</a></p> </blockquote> <p>在单元测试中，您希望能够快速判断出哪些数据和替身是需要关注的内容，哪些内容的作用只是为了防止代码崩溃。通过为没有含义的内容起一个显眼的名称和值来支持此功能，例如：</p> <div class=highlight><pre><span></span><code><span class=k>DATA</span><span class=p>(</span><span class=nv>alert_id</span><span class=p>)</span> <span class=o>=</span> <span class=s1>&#39;42&#39;</span><span class=p>.</span>                             <span class=c1>&quot; well-known meaningless numbers</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>detection_object_type</span><span class=p>)</span> <span class=o>=</span> <span class=s1>&#39;?=/&quot;&amp;&#39;</span><span class=p>.</span>             <span class=c1>&quot; &#39;keyboard accidents&#39;</span>
<span class=k>CONSTANTS</span> <span class=nv>some_random_number</span> <span class=k>TYPE </span><span class=nv>i</span> <span class=k>VALUE</span> <span class=mi>782346</span><span class=p>.</span>  <span class=c1>&quot; revealing variable names</span>
</code></pre></div> <p>不要欺骗人们相信某些内容可以与真实的对象或真实的定制联系起来（如果没有联系）：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>alert_id</span><span class=p>)</span> <span class=o>=</span> <span class=s1>&#39;00000001223678871&#39;</span><span class=p>.</span>        <span class=c1>&quot; this alert really exists</span>
<span class=k>DATA</span><span class=p>(</span><span class=nv>detection_object_type</span><span class=p>)</span> <span class=o>=</span> <span class=s1>&#39;FRA_SCLAIM&#39;</span><span class=p>.</span>  <span class=c1>&quot; this detection object type, too</span>
<span class=k>CONSTANTS</span> <span class=nv>memory_limit</span> <span class=k>TYPE </span><span class=nv>i</span> <span class=k>VALUE</span> <span class=mi>4096</span><span class=p>.</span>    <span class=c1>&quot; this number looks carefully chosen</span>
</code></pre></div> <h4 id=_159>使其易于辨明差异<a class=headerlink href=#_159 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-data>测试数据</a> &gt; <a href=#make-it-easy-to-spot-differences>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=nv>exp_parameter_in</span> <span class=o>=</span> <span class=k>VALUE</span> <span class=err>#</span><span class=p>(</span> <span class=p>(</span> <span class=nv>parameter_name</span> <span class=o>=</span> <span class=s1>&#39;45678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789END1&#39;</span> <span class=p>)</span>
                            <span class=p>(</span> <span class=nv>parameter_name</span> <span class=o>=</span> <span class=s1>&#39;45678901234567890123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789END2&#39;</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <p>不要强迫读者去比较长且无意义的字符串来发现细微的差别。</p> <h4 id=_160>使用常量描述测试数据的用途和重要性<a class=headerlink href=#_160 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#test-data>测试数据</a> &gt; <a href=#use-constants-to-describe-purpose-and-importance-of-test-data>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>CONSTANTS</span> <span class=nv>some_nonsense_key</span> <span class=k>TYPE </span><span class=nv>char8</span> <span class=k>VALUE</span> <span class=s1>&#39;ABCDEFGH&#39;</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>throws_on_invalid_entry</span><span class=p>.</span>
  <span class=k>TRY</span><span class=p>.</span>
      <span class=c1>&quot; when</span>
      <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>read_entry</span><span class=p>(</span> <span class=nv>some_nonsense_key</span> <span class=p>).</span>
      <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>fail</span><span class=p>(</span> <span class=p>).</span>
    <span class=k>CATCH</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>customizing_reader_error</span><span class=p>.</span>
      <span class=c1>&quot; then</span>
  <span class=k>ENDTRY</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h3 id=_161>断言<a class=headerlink href=#_161 title="Permanent link">&para;</a></h3> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#assertions>本节</a></p> </blockquote> <h4 id=_162>少而精的断言<a class=headerlink href=#_162 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#assertions>断言</a> &gt; <a href=#few-focused-assertions>本节</a></p> </blockquote> <p>仅使用少量断言，准确地断言测试方法的内容。</p> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>rejects_invalid_input</span><span class=p>.</span>
  <span class=c1>&quot; when</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>is_valid</span><span class=p>)</span> <span class=o>=</span> <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>is_valid_input</span><span class=p>(</span> <span class=s1>&#39;SOME_RANDOM_ENTRY&#39;</span> <span class=p>).</span>
  <span class=c1>&quot; then</span>
  <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_false</span><span class=p>(</span> <span class=nv>is_valid</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>断言过多表明该方法没有明确的重点。这会在很多地方将生产和测试代码耦合在一起：更改功能将需要重写大量的测试，尽管它们实际上并未涉及更改后的功能。各种各样的断言使读者感到困惑，难以辨别其中最重要的那个断言。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>rejects_invalid_input</span><span class=p>.</span>
  <span class=c1>&quot; when</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>is_valid</span><span class=p>)</span> <span class=o>=</span> <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>is_valid_input</span><span class=p>(</span> <span class=s1>&#39;SOME_RANDOM_ENTRY&#39;</span> <span class=p>).</span>
  <span class=c1>&quot; then</span>
  <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_false</span><span class=p>(</span> <span class=nv>is_valid</span> <span class=p>).</span>
  <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_not_initial</span><span class=p>(</span> <span class=nv>log</span><span class=o>-&gt;</span><span class=nf>get_messages</span><span class=p>(</span> <span class=p>)</span> <span class=p>).</span>
  <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_equals</span><span class=p>(</span> <span class=nv>act</span> <span class=o>=</span> <span class=nv>sy</span><span class=o>-</span><span class=nv>langu</span>
                                      <span class=nv>exp</span> <span class=o>=</span> <span class=s1>&#39;E&#39;</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h4 id=_163>使用恰当的断言类型<a class=headerlink href=#_163 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#assertions>断言</a> &gt; <a href=#use-the-right-assert-type>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_equals</span><span class=p>(</span> <span class=nv>act</span> <span class=o>=</span> <span class=k>table</span>
                                    <span class=nv>exp</span> <span class=o>=</span> <span class=nv>test_data</span> <span class=p>).</span>
</code></pre></div> <p>断言的作用往往不止表面看到的那些，例如 <code>assert_equals</code> 包括类型匹配，如果值不同，还能提供准确的描述。使用错误的、过于常见的断言将迫使您立即进入调试器，而不是让您直接从错误消息中看到问题所在。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_true</span><span class=p>(</span> <span class=nv>xsdbool</span><span class=p>(</span> <span class=nv>act</span> <span class=o>=</span> <span class=nv>exp</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <h4 id=_164>断言内容而非数量<a class=headerlink href=#_164 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#assertions>断言</a> &gt; <a href=#assert-content-not-quantity>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=nv>assert_contains_exactly</span><span class=p>(</span> <span class=nv>actual</span>   <span class=o>=</span> <span class=k>table</span>
                         <span class=nv>expected</span> <span class=o>=</span> <span class=k>VALUE</span> <span class=nv>string_table</span><span class=p>(</span> <span class=p>(</span> <span class=s1>`ABC`</span> <span class=p>)</span> <span class=p>(</span> <span class=s1>`DEF`</span> <span class=p>)</span> <span class=p>(</span> <span class=s1>`GHI`</span> <span class=p>)</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <p>如果可以表达期望的实际内容，就不要编写幻数数量断言。尽管仍然可以达到预期，但数字可能会有所不同。相反，尽管内容完全出乎意料，但数字可能会匹配。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>assert_equals</span><span class=p>(</span> <span class=nv>act</span> <span class=o>=</span> <span class=k>lines</span><span class=p>(</span> <span class=nv>log_messages</span> <span class=p>)</span>
               <span class=nv>exp</span> <span class=o>=</span> <span class=mi>3</span> <span class=p>).</span>
</code></pre></div> <h4 id=_165>断言质量而非内容<a class=headerlink href=#_165 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#assertions>断言</a> &gt; <a href=#assert-quality-not-content>本节</a></p> </blockquote> <p>如果您对结果的元质量感兴趣，但对实际内容本身不感兴趣，请使用合适的断言来表达：</p> <div class=highlight><pre><span></span><code><span class=nv>assert_all_lines_shorter_than</span><span class=p>(</span> <span class=nv>actual_lines</span>        <span class=o>=</span> <span class=k>table</span>
                               <span class=nv>expected_max_length</span> <span class=o>=</span> <span class=mi>80</span> <span class=p>).</span>
</code></pre></div> <p>断言精确的内容会掩盖您实际想要测试的内容。它还很脆弱，因为重构可能会产生一个不同但完全可以接受的结果，尽管它会中断所有过于精确的单元测试。</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=nv>assert_equals</span><span class=p>(</span> <span class=nv>act</span> <span class=o>=</span> <span class=k>table</span>
               <span class=nv>exp</span> <span class=o>=</span> <span class=k>VALUE</span> <span class=nv>string_table</span><span class=p>(</span> <span class=p>(</span> <span class=s1>`ABC`</span> <span class=p>)</span> <span class=p>(</span> <span class=s1>`DEF`</span> <span class=p>)</span> <span class=p>(</span> <span class=s1>`GHI`</span> <span class=p>)</span> <span class=p>)</span> <span class=p>).</span>
</code></pre></div> <h4 id=fail>使用 FAIL 检查是否出现预期异常<a class=headerlink href=#fail title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#assertions>断言</a> &gt; <a href=#use-fail-to-check-for-expected-exceptions>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHOD</span> <span class=nf>throws_on_empty_input</span><span class=p>.</span>
  <span class=k>TRY</span><span class=p>.</span>
      <span class=c1>&quot; when</span>
      <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>do_something</span><span class=p>(</span> <span class=s1>&#39;&#39;</span> <span class=p>).</span>
      <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>fail</span><span class=p>(</span> <span class=p>).</span>
    <span class=k>CATCH</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_exception</span><span class=p>.</span>
      <span class=c1>&quot; then</span>
  <span class=k>ENDTRY</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h4 id=_166>转发意外异常而非捕获就失败<a class=headerlink href=#_166 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#assertions>断言</a> &gt; <a href=#forward-unexpected-exceptions-instead-of-catching-and-failing>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>reads_entry</span> <span class=k>FOR</span> <span class=nv>TESTING</span> <span class=k>RAISING</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_exception</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>reads_entry</span><span class=p>.</span>
  <span class=c1>&quot;when</span>
  <span class=k>DATA</span><span class=p>(</span><span class=nv>entry</span><span class=p>)</span> <span class=o>=</span> <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>read_something</span><span class=p>(</span> <span class=p>).</span>
  <span class=c1>&quot;then</span>
  <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_not_initial</span><span class=p>(</span> <span class=nv>entry</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>与以下代码相比，您的测试代码始终专注于愉快路径，因此更易于阅读和理解：</p> <div class=highlight><pre><span></span><code><span class=c1>&quot; anti-pattern</span>
<span class=k>METHOD</span> <span class=nf>reads_entry</span><span class=p>.</span>
  <span class=k>TRY</span><span class=p>.</span>
      <span class=k>DATA</span><span class=p>(</span><span class=nv>entry</span><span class=p>)</span> <span class=o>=</span> <span class=nv>cut</span><span class=o>-&gt;</span><span class=nf>read_something</span><span class=p>(</span> <span class=p>).</span>
    <span class=k>CATCH</span> <span class=p>/</span><span class=nv>clean</span><span class=p>/</span><span class=nv>some_exception</span> <span class=k>INTO</span> <span class=k>DATA</span><span class=p>(</span><span class=nv>unexpected_exception</span><span class=p>).</span>
      <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>fail</span><span class=p>(</span> <span class=nv>unexpected_exception</span><span class=o>-&gt;</span><span class=nf>get_text</span><span class=p>(</span> <span class=p>)</span> <span class=p>).</span>
  <span class=k>ENDTRY</span><span class=p>.</span>
  <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>assert_not_initial</span><span class=p>(</span> <span class=nv>entry</span> <span class=p>).</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <h4 id=_167>编写自定义断言以缩短代码和避免重复<a class=headerlink href=#_167 title="Permanent link">&para;</a></h4> <blockquote> <p><a href=#clean-abap>ABAP 整洁之道</a> &gt; <a href=#content>目录</a> &gt; <a href=#testing>测试</a> &gt; <a href=#assertions>断言</a> &gt; <a href=#write-custom-asserts-to-shorten-code-and-avoid-duplication>本节</a></p> </blockquote> <div class=highlight><pre><span></span><code><span class=k>METHODS</span> <span class=nv>assert_contains</span>
  <span class=k>IMPORTING</span>
    <span class=nv>actual_entries</span> <span class=k>TYPE STANDARD TABLE OF</span> <span class=nv>entries_tab</span>
    <span class=nv>expected_key</span>   <span class=k>TYPE </span><span class=nv>key_structure</span><span class=p>.</span>

<span class=k>METHOD</span> <span class=nf>assert_contains</span><span class=p>.</span>
  <span class=k>TRY</span><span class=p>.</span>
      <span class=nv>actual_entries</span><span class=p>[</span> <span class=k>key</span> <span class=o>=</span> <span class=nv>expected_key</span> <span class=p>].</span>
    <span class=k>CATCH</span> <span class=nv>cx_sy_itab_line_not_found</span><span class=p>.</span>
      <span class=nv>cl_abap_unit_assert</span><span class=o>=&gt;</span><span class=nf>fail</span><span class=p>(</span> <span class=p>|</span><span class=s1>Couldn&#39;t find the key </span><span class=p>{</span> <span class=nv>expected_key</span> <span class=p>}|</span> <span class=p>).</span>
  <span class=k>ENDTRY</span><span class=p>.</span>
<span class=k>ENDMETHOD</span><span class=p>.</span>
</code></pre></div> <p>而不是一遍又一遍地复制粘贴。</p> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../../2020/0914/awosome-command-line-slide/ title="Command line interface" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> 上一页 </span> Command line interface </div> </div> </a> <a href=../archives/ title=Archives class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Archives </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2018 - 2020 </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/hackettyu target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/ target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=spotify:user:12glou9s4691jdz6arkbb8zmn target=_blank rel=noopener title class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><path d="M248 8C111.1 8 0 119.1 0 256s111.1 248 248 248 248-111.1 248-248S384.9 8 248 8zm100.7 364.9c-4.2 0-6.8-1.3-10.7-3.6-62.4-37.6-135-39.2-206.7-24.5-3.9 1-9 2.6-11.9 2.6-9.7 0-15.8-7.7-15.8-15.8 0-10.3 6.1-15.2 13.6-16.8 81.9-18.1 165.6-16.5 237 26.2 6.1 3.9 9.7 7.4 9.7 16.5s-7.1 15.4-15.2 15.4zm26.9-65.6c-5.2 0-8.7-2.3-12.3-4.2-62.5-37-155.7-51.9-238.6-29.4-4.8 1.3-7.4 2.6-11.9 2.6-10.7 0-19.4-8.7-19.4-19.4s5.2-17.8 15.5-20.7c27.8-7.8 56.2-13.6 97.8-13.6 64.9 0 127.6 16.1 177 45.5 8.1 4.8 11.3 11 11.3 19.7-.1 10.8-8.5 19.5-19.4 19.5zm31-76.2c-5.2 0-8.4-1.3-12.9-3.9-71.2-42.5-198.5-52.7-280.9-29.7-3.6 1-8.1 2.6-12.9 2.6-13.2 0-23.3-10.3-23.3-23.6 0-13.6 8.4-21.3 17.4-23.9 35.2-10.3 74.6-15.2 117.5-15.2 73 0 149.5 15.2 205.4 47.8 7.8 4.5 12.9 10.7 12.9 22.6 0 13.6-11 23.3-23.2 23.3z"/></svg> </a> <a href=https://hackettyu.substack.com/p/coming-soon target=_blank rel=noopener title=hackettyu.substack.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg> </a> </div> <a href=http://creativecommons.org/licenses/by-nc/4.0/ rel=license><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by-nc/4.0/80x15.png></a><br>本作品采用<a href=http://creativecommons.org/licenses/by-nc/4.0/ rel=license>知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可。 </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.de50e36d.min.js></script> <script src=../../assets/javascripts/bundle.5ad6861d.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "\u590d\u5236", "clipboard.copied": "\u5df2\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\uff0c\\u3002]+", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c"}</script> <script>
        app = initialize({
          base: "../..",
          features: ["tabs", {"instant": true}, "search.highlight"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.7a2ea5ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> <script src=../../js/baidu-stat.js></script> </body> </html>